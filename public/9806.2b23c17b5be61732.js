"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[9806],{9806:(J,y,p)=>{p.r(y),p.d(y,{ArticlesPageModule:()=>F});var m=p(6814),g=p(95),d=p(7027),v=p(9801),l=p(5861),x=p(3009),t=p(6689),_=p(5423),C=p(5512),b=p(202),Z=p(6419),A=p(6815),P=p(1934);function B(o,f){1&o&&t._UZ(0,"ion-icon",12)}function S(o,f){if(1&o){const u=t.EpF();t.TgZ(0,"div")(1,"ion-item",10),t.NdJ("click",function(){t.CHM(u);const r=t.oxw().$implicit,s=t.oxw(2);return t.KtG(s.put(r))}),t.YNc(2,B,1,0,"ion-icon",11),t.TgZ(3,"ion-label")(4,"h3"),t._uU(5),t.qZA()()()()}if(2&o){const u=t.oxw().$implicit;t.xp6(1),t.Q6J("disabled","DELETE"===u.firebaseMethod),t.xp6(1),t.Q6J("ngIf",null!=u.codeBarre||null!=u.codeBarre),t.xp6(3),t.Oqu(u.libelle)}}function N(o,f){if(1&o&&(t.TgZ(0,"div"),t.YNc(1,S,6,3,"div",9),t.qZA()),2&o){const u=f.$implicit,e=t.oxw().$implicit;t.xp6(1),t.Q6J("ngIf",u.familleId===e.id)}}function M(o,f){if(1&o&&(t.TgZ(0,"ion-list")(1,"ion-item")(2,"ion-label")(3,"h3"),t._uU(4),t.qZA(),t.TgZ(5,"ion-list"),t.YNc(6,N,2,1,"div",4),t.qZA()()()()),2&o){const u=f.$implicit,e=t.oxw();t.xp6(4),t.Oqu(u.libelle),t.xp6(2),t.Q6J("ngForOf",e.articles)}}const I=[{path:"",component:(()=>{var o;class f{constructor(e,r,s,i,n,a,c){this.storageService=e,this.articlesService=r,this.magasinsService=s,this.famillesService=i,this.utility=n,this.barreCode=a,this.alertController=c,this.articles=[],this.familles=[],this.magasins=[],this.content_visibility=""}ngOnInit(){this.refresh()}handleRefresh(e){this.storageService.synchroniser(x.K.Articles).then(()=>{this.refresh(),e.target.complete()})}scanne(){var e=this;return(0,l.Z)(function*(){const r=yield e.barreCode.STEP1EnableCameraReturnVisility();e.content_visibility=r;const s=yield e.barreCode.STEP2ScanneBarCodeAndReturnContent(),i=yield e.barreCode.STEP3disableCameraReturnVisility();return e.content_visibility=i,yield s})()}postArticleByCodeBarre(){var e=this;return(0,l.Z)(function*(){const r=yield e.scanne(),s=yield e.articlesService.getArticleByCodeBarre(r);s.length>0?yield e.putPrix(s[0]):yield e.setArticleByCodeBarre(r)})()}setArticleByCodeBarre(e){var r=this;return(0,l.Z)(function*(){var i;yield(yield r.alertController.create({cssClass:"my-custom-class",header:"Nouvelle article",inputs:[{type:"text",name:"libelle",label:"Nom de l'article"}],buttons:[{text:"Annuler",role:"cancel",cssClass:"secondary",handler:()=>{}},{text:"Valider",handler:(i=(0,l.Z)(function*(n){n.codeBarre=yield e,yield r.postChooseMagasin(n)}),function(a){return i.apply(this,arguments)})}]})).present().then(()=>{document.querySelector("ion-alert input").focus()})})()}refresh(){var e=this;return(0,l.Z)(function*(){const r=yield e.getArticles();e.articles=r;const s=yield e.getFamilles();e.familles=s;const i=yield e.getMagasins();e.magasins=i})()}getArticles(){var e=this;return(0,l.Z)(function*(){return yield e.articlesService.get()})()}getFamilles(){var e=this;return(0,l.Z)(function*(){return yield e.famillesService.get()})()}getMagasins(){var e=this;return(0,l.Z)(function*(){return yield e.magasinsService.get()})()}post(){var e=this;return(0,l.Z)(function*(){var s;yield(yield e.alertController.create({cssClass:"my-custom-class",header:"Nouvelle article",inputs:[{type:"text",name:"libelle",label:"Nom de l'article"}],buttons:[{text:"Annuler",role:"cancel",cssClass:"secondary",handler:()=>{}},{text:"Valider",handler:(s=(0,l.Z)(function*(i){e.postChooseMagasin(i)}),function(n){return s.apply(this,arguments)})}]})).present().then(()=>{document.querySelector("ion-alert input").focus()})})()}postChooseMagasin(e){var r=this;return(0,l.Z)(function*(){var n,s=[];r.magasins.map(n=>s.push({type:"radio",value:n.id,label:n.libelle})),yield(yield r.alertController.create({cssClass:"my-custom-class",header:"S\xe9lectionner un magasin",inputs:s,buttons:[{text:"Annuler",role:"cancel",cssClass:"secondary",handler:()=>{}},{text:"Valider",handler:(n=(0,l.Z)(function*(a){var c={libelle:e.libelle,magasinId:a,codeBarre:void 0===e.codeBarre?null:e.codeBarre};yield r.postChoosePrix(c)}),function(c){return n.apply(this,arguments)})}]})).present()})()}postChoosePrix(e){var r=this;return(0,l.Z)(function*(){var i;yield(yield r.alertController.create({cssClass:"my-custom-class",header:"Renseigner un prix",inputs:[{type:"number",name:"prix"}],buttons:[{text:"Annuler",role:"cancel",cssClass:"secondary",handler:()=>{}},{text:"Valider",handler:(i=(0,l.Z)(function*(n){e.prix=n.prix,yield r.postChooseFamille(e)}),function(a){return i.apply(this,arguments)})}]})).present().then(()=>{document.querySelector("ion-alert input").focus()})})()}postChooseFamille(e){var r=this;return(0,l.Z)(function*(){var n,s=[];r.familles.map(n=>s.push({type:"radio",value:n.id,label:n.libelle})),yield(yield r.alertController.create({cssClass:"my-custom-class",header:"Nouvelle article",inputs:s,buttons:[{text:"Annuler",role:"cancel",cssClass:"secondary",handler:()=>{}},{text:"Valider",handler:(n=(0,l.Z)(function*(a){var c={id:Date.now(),libelle:e.libelle,prix:[{magasin:e.magasinId,prix:Number(e.prix)}],createdOn:new Date,groupeId:[(yield r.utility.getConnexionInfo()).groupeId],familleId:a,codeBarre:e.codeBarre,isFirebase:!1};yield r.articlesService.post(c),r.refresh()}),function(c){return n.apply(this,arguments)})}]})).present()})()}put(e){var r=this;return(0,l.Z)(function*(){var i;yield(yield r.alertController.create({cssClass:"my-custom-class",header:"Nouvelle article",inputs:[{type:"text",name:"libelle",label:"Nom de l'article",value:e.libelle}],buttons:[{text:"Annuler",role:"cancel",cssClass:"secondary",handler:()=>{}},{text:"Voir les prix",cssClass:"secondary",handler:(i=(0,l.Z)(function*(){yield r.putPrix(e)}),function(){return i.apply(this,arguments)})},{text:"Associer un code barre",cssClass:"secondary",handler:function(){var i=(0,l.Z)(function*(){yield r.putCodeBarre(e)});return function(){return i.apply(this,arguments)}}()},{text:"Renseigner le code barre",cssClass:"secondary",handler:function(){var i=(0,l.Z)(function*(){yield r.setCodeBarre(e)});return function(){return i.apply(this,arguments)}}()},{text:"Modifier la famille",cssClass:"secondary",handler:function(){var i=(0,l.Z)(function*(){yield r.putFamilleArticleOfArticle(e)});return function(){return i.apply(this,arguments)}}()},{text:"Supprimer d\xe9finitivement",cssClass:"secondary",handler:function(){var i=(0,l.Z)(function*(){yield r.supprimerDefinitivement(e)});return function(){return i.apply(this,arguments)}}()},{text:"Valider",handler:function(){var i=(0,l.Z)(function*(n){e.libelle=n.libelle,yield r.articlesService.put(e)});return function(a){return i.apply(this,arguments)}}()}]})).present()})()}setCodeBarre(e){var r=this;return(0,l.Z)(function*(){var i;yield(yield r.alertController.create({cssClass:"my-custom-class",header:"Renseigner le code barre",inputs:[{type:"text",value:void 0===e.codeBarre?null:e.codeBarre,name:"codeBarre"}],buttons:[{text:"Annuler",role:"cancel",cssClass:"secondary",handler:()=>{}},{text:"Valider",handler:(i=(0,l.Z)(function*(n){e.codeBarre=""===n.codeBarre?null:n.codeBarre,yield r.articlesService.put(e),yield r.refresh()}),function(a){return i.apply(this,arguments)})}]})).present()})()}putFamilleArticleOfArticle(e){var r=this;return(0,l.Z)(function*(){const s=yield r.famillesService.get(),i=[];var a;s.map(a=>{i.push({type:"radio",label:a.libelle,value:a})}),yield(yield r.alertController.create({cssClass:"my-custom-class",header:"Nouvelle article",inputs:i,buttons:[{text:"Annuler",role:"cancel",cssClass:"secondary",handler:()=>{}},{text:"Valider",handler:(a=(0,l.Z)(function*(c){e.familleId=c.id,yield r.articlesService.put(e),yield r.refresh()}),function(h){return a.apply(this,arguments)})}]})).present()})()}putCodeBarre(e){var r=this;return(0,l.Z)(function*(){var s=yield r.scanne();e.codeBarre=s,yield r.articlesService.put(e)})()}putPrix(e){var r=this;return(0,l.Z)(function*(){const s=[];var n;e.prix.map(function(){var n=(0,l.Z)(function*(a){var c=yield r.magasins.find(h=>h.id==a.magasin);s.push({type:"radio",label:a.prix+"F "+(null==c?void 0:c.libelle),value:{prix:a.prix,article:e,magasinId:a.magasin}})});return function(a){return n.apply(this,arguments)}}()),yield(yield r.alertController.create({cssClass:"my-custom-class",header:"Les prix appliqu\xe9es",inputs:s,buttons:[{text:"Annuler",role:"cancel",cssClass:"secondary",handler:()=>{}},{text:"Ajouter un prix",cssClass:"secondary",handler:(n=(0,l.Z)(function*(){yield r.postNouveauPrixChooseMagasin(e)}),function(){return n.apply(this,arguments)})},{text:"Modifier le prix",handler:function(){var n=(0,l.Z)(function*(a){yield r.updatePrixArticleMagasin(a)});return function(c){return n.apply(this,arguments)}}()}]})).present()})()}updatePrixArticleMagasin(e){var r=this;return(0,l.Z)(function*(){var i;yield(yield r.alertController.create({cssClass:"my-custom-class",header:"Modifier le prix",inputs:[{type:"number",name:"prix",value:e.prix}],buttons:[{text:"Annuler",role:"cancel",cssClass:"secondary",handler:()=>{}},{text:"Valider",handler:(i=(0,l.Z)(function*(n){const a=e.article,c=yield a.prix.findIndex(h=>h.magasin===e.magasinId);a.prix[c].prix=Number(n.prix),yield r.articlesService.put(a),yield r.refresh()}),function(a){return i.apply(this,arguments)})}]})).present()})()}postNouveauPrixChooseMagasin(e){var r=this;return(0,l.Z)(function*(){const s=[],i=yield r.magasinsService.get(),n=[];var c;yield i.filter(c=>{for(let h of e.prix)h.magasin!==c.id&&n.push(c)}),n.map(c=>s.push({type:"radio",label:c.libelle,value:{magasin:c,article:e}})),yield(yield r.alertController.create({cssClass:"my-custom-class",header:"Nouvelle article",inputs:s,buttons:[{text:"Annuler",role:"cancel",cssClass:"secondary",handler:()=>{}},{text:"Valider",handler:(c=(0,l.Z)(function*(h){yield r.postNouveauPrixChoosePrix(h)}),function(R){return c.apply(this,arguments)})}]})).present()})()}postNouveauPrixChoosePrix(e){var r=this;return(0,l.Z)(function*(){var i;yield(yield r.alertController.create({cssClass:"my-custom-class",header:"Nouvelle article",inputs:[{type:"number",name:"prix"}],buttons:[{text:"Annuler",role:"cancel",cssClass:"secondary",handler:()=>{}},{text:"Valider",handler:(i=(0,l.Z)(function*(n){e.article.prix.push({magasin:e.magasin.id,prix:Number(n.prix)}),yield r.articlesService.put(e.article)}),function(a){return i.apply(this,arguments)})}]})).present()})()}supprimerDefinitivement(e){var r=this;return(0,l.Z)(function*(){yield r.articlesService.deleteDefinitivement(e),yield r.refresh()})()}}return(o=f).\u0275fac=function(e){return new(e||o)(t.Y36(_.V),t.Y36(C.J),t.Y36(b.t),t.Y36(Z.X),t.Y36(A.t),t.Y36(P.k),t.Y36(d.Br))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-articles"]],decls:15,vars:8,consts:[[3,"translucent"],["slot","start"],[3,"fullscreen"],["slot","fixed",3,"pullFactor","pullMin","pullMax","ionRefresh"],[4,"ngFor","ngForOf"],["slot","fixed","horizontal","end","vertical","bottom"],["size","small",3,"click"],["name","barcode"],["name","add"],[4,"ngIf"],["button","","detail","true",3,"disabled","click"],["name","barcode-outline",4,"ngIf"],["name","barcode-outline"]],template:function(e,r){1&e&&(t.TgZ(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-buttons",1),t._UZ(3,"ion-menu-button"),t.qZA(),t.TgZ(4,"ion-title"),t._uU(5,"Configurer vos articles"),t.qZA()()(),t.TgZ(6,"ion-content",2)(7,"ion-refresher",3),t.NdJ("ionRefresh",function(i){return r.handleRefresh(i)}),t._UZ(8,"ion-refresher-content"),t.qZA(),t.YNc(9,M,7,2,"ion-list",4),t.TgZ(10,"ion-fab",5)(11,"ion-fab-button",6),t.NdJ("click",function(){return r.postArticleByCodeBarre()}),t._UZ(12,"ion-icon",7),t.qZA(),t.TgZ(13,"ion-fab-button",6),t.NdJ("click",function(){return r.post()}),t._UZ(14,"ion-icon",8),t.qZA()()()),2&e&&(t.Q6J("translucent",!0),t.xp6(6),t.Udp("visibility",r.content_visibility),t.Q6J("fullscreen",!0),t.xp6(1),t.Q6J("pullFactor",.5)("pullMin",100)("pullMax",200),t.xp6(2),t.Q6J("ngForOf",r.familles))},dependencies:[m.sg,m.O5,d.Sm,d.W2,d.IJ,d.W4,d.Gu,d.gu,d.Ie,d.Q$,d.q_,d.fG,d.nJ,d.Wo,d.wd,d.sr]}),f})()}];let T=(()=>{var o;class f{}return(o=f).\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({imports:[v.Bz.forChild(I),v.Bz]}),f})(),F=(()=>{var o;class f{}return(o=f).\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({imports:[m.ez,g.u5,d.Pc,T]}),f})()}}]);