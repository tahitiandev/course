"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[9806],{9806:(J,y,p)=>{p.r(y),p.d(y,{ArticlesPageModule:()=>F});var m=p(6814),g=p(95),d=p(7027),v=p(9801),l=p(5861),x=p(3009),r=p(6689),_=p(5423),C=p(5512),b=p(202),Z=p(6419),A=p(6815),P=p(1934);function B(o,f){1&o&&r._UZ(0,"ion-icon",12)}function S(o,f){if(1&o){const u=r.EpF();r.TgZ(0,"div")(1,"ion-item",10),r.NdJ("click",function(){r.CHM(u);const t=r.oxw().$implicit,s=r.oxw(2);return r.KtG(s.put(t))}),r.YNc(2,B,1,0,"ion-icon",11),r.TgZ(3,"ion-label")(4,"h3"),r._uU(5),r.qZA()()()()}if(2&o){const u=r.oxw().$implicit;r.xp6(1),r.Q6J("disabled","DELETE"===u.firebaseMethod),r.xp6(1),r.Q6J("ngIf",null!=u.codeBarre||null!=u.codeBarre),r.xp6(3),r.Oqu(u.libelle)}}function N(o,f){if(1&o&&(r.TgZ(0,"div"),r.YNc(1,S,6,3,"div",9),r.qZA()),2&o){const u=f.$implicit,e=r.oxw().$implicit;r.xp6(1),r.Q6J("ngIf",u.familleId===e.id)}}function M(o,f){if(1&o&&(r.TgZ(0,"ion-list")(1,"ion-item")(2,"ion-label")(3,"h3"),r._uU(4),r.qZA(),r.TgZ(5,"ion-list"),r.YNc(6,N,2,1,"div",4),r.qZA()()()()),2&o){const u=f.$implicit,e=r.oxw();r.xp6(4),r.Oqu(u.libelle),r.xp6(2),r.Q6J("ngForOf",e.articles)}}const I=[{path:"",component:(()=>{var o;class f{constructor(e,t,s,i,n,a,c){this.storageService=e,this.articlesService=t,this.magasinsService=s,this.famillesService=i,this.utility=n,this.barreCode=a,this.alertController=c,this.articles=[],this.familles=[],this.magasins=[],this.content_visibility=""}ngOnInit(){this.refresh()}handleRefresh(e){var t=this;this.storageService.synchroniser(x.K.Articles).then((0,l.Z)(function*(){t.refresh(),e.target.complete(),yield t.utility.popUp("Synchronisation des articles termin\xe9e")}))}scanne(){var e=this;return(0,l.Z)(function*(){const t=yield e.barreCode.STEP1EnableCameraReturnVisility();e.content_visibility=t;const s=yield e.barreCode.STEP2ScanneBarCodeAndReturnContent(),i=yield e.barreCode.STEP3disableCameraReturnVisility();return e.content_visibility=i,yield s})()}postArticleByCodeBarre(){var e=this;return(0,l.Z)(function*(){const t=yield e.scanne(),s=yield e.articlesService.getArticleByCodeBarre(t);s.length>0?yield e.putPrix(s[0]):yield e.setArticleByCodeBarre(t)})()}setArticleByCodeBarre(e){var t=this;return(0,l.Z)(function*(){var i;yield(yield t.alertController.create({cssClass:"my-custom-class",header:"Nouvelle article",inputs:[{type:"text",name:"libelle",label:"Nom de l'article"}],buttons:[{text:"Annuler",role:"cancel",cssClass:"secondary",handler:()=>{}},{text:"Valider",handler:(i=(0,l.Z)(function*(n){n.codeBarre=yield e,yield t.postChooseMagasin(n)}),function(a){return i.apply(this,arguments)})}]})).present().then(()=>{document.querySelector("ion-alert input").focus()})})()}refresh(){var e=this;return(0,l.Z)(function*(){const t=yield e.getArticles();e.articles=t;const s=yield e.getFamilles();e.familles=s;const i=yield e.getMagasins();e.magasins=i})()}getArticles(){var e=this;return(0,l.Z)(function*(){return yield e.articlesService.get()})()}getFamilles(){var e=this;return(0,l.Z)(function*(){return yield e.famillesService.get()})()}getMagasins(){var e=this;return(0,l.Z)(function*(){return yield e.magasinsService.get()})()}post(){var e=this;return(0,l.Z)(function*(){var s;yield(yield e.alertController.create({cssClass:"my-custom-class",header:"Nouvelle article",inputs:[{type:"text",name:"libelle",label:"Nom de l'article"}],buttons:[{text:"Annuler",role:"cancel",cssClass:"secondary",handler:()=>{}},{text:"Valider",handler:(s=(0,l.Z)(function*(i){e.postChooseMagasin(i)}),function(n){return s.apply(this,arguments)})}]})).present().then(()=>{document.querySelector("ion-alert input").focus()})})()}postChooseMagasin(e){var t=this;return(0,l.Z)(function*(){var n,s=[];t.magasins.map(n=>s.push({type:"radio",value:n.id,label:n.libelle})),yield(yield t.alertController.create({cssClass:"my-custom-class",header:"S\xe9lectionner un magasin",inputs:s,buttons:[{text:"Annuler",role:"cancel",cssClass:"secondary",handler:()=>{}},{text:"Valider",handler:(n=(0,l.Z)(function*(a){var c={libelle:e.libelle,magasinId:a,codeBarre:void 0===e.codeBarre?null:e.codeBarre};yield t.postChoosePrix(c)}),function(c){return n.apply(this,arguments)})}]})).present()})()}postChoosePrix(e){var t=this;return(0,l.Z)(function*(){var i;yield(yield t.alertController.create({cssClass:"my-custom-class",header:"Renseigner un prix",inputs:[{type:"number",name:"prix"}],buttons:[{text:"Annuler",role:"cancel",cssClass:"secondary",handler:()=>{}},{text:"Valider",handler:(i=(0,l.Z)(function*(n){e.prix=n.prix,yield t.postChooseFamille(e)}),function(a){return i.apply(this,arguments)})}]})).present().then(()=>{document.querySelector("ion-alert input").focus()})})()}postChooseFamille(e){var t=this;return(0,l.Z)(function*(){var n,s=[];t.familles.map(n=>s.push({type:"radio",value:n.id,label:n.libelle})),yield(yield t.alertController.create({cssClass:"my-custom-class",header:"Nouvelle article",inputs:s,buttons:[{text:"Annuler",role:"cancel",cssClass:"secondary",handler:()=>{}},{text:"Valider",handler:(n=(0,l.Z)(function*(a){var c={id:Date.now(),libelle:e.libelle,prix:[{magasin:e.magasinId,prix:Number(e.prix)}],createdOn:new Date,groupeId:[(yield t.utility.getConnexionInfo()).groupeId],familleId:a,codeBarre:e.codeBarre,isFirebase:!1};yield t.articlesService.post(c),t.refresh()}),function(c){return n.apply(this,arguments)})}]})).present()})()}put(e){var t=this;return(0,l.Z)(function*(){var i;yield(yield t.alertController.create({cssClass:"my-custom-class",header:"Nouvelle article",inputs:[{type:"text",name:"libelle",label:"Nom de l'article",value:e.libelle}],buttons:[{text:"Annuler",role:"cancel",cssClass:"secondary",handler:()=>{}},{text:"Voir les prix",cssClass:"secondary",handler:(i=(0,l.Z)(function*(){yield t.putPrix(e)}),function(){return i.apply(this,arguments)})},{text:"Associer un code barre",cssClass:"secondary",handler:function(){var i=(0,l.Z)(function*(){yield t.putCodeBarre(e)});return function(){return i.apply(this,arguments)}}()},{text:"Renseigner le code barre",cssClass:"secondary",handler:function(){var i=(0,l.Z)(function*(){yield t.setCodeBarre(e)});return function(){return i.apply(this,arguments)}}()},{text:"Modifier la famille",cssClass:"secondary",handler:function(){var i=(0,l.Z)(function*(){yield t.putFamilleArticleOfArticle(e)});return function(){return i.apply(this,arguments)}}()},{text:"Supprimer d\xe9finitivement",cssClass:"secondary",handler:function(){var i=(0,l.Z)(function*(){yield t.supprimerDefinitivement(e)});return function(){return i.apply(this,arguments)}}()},{text:"Valider",handler:function(){var i=(0,l.Z)(function*(n){e.libelle=n.libelle,yield t.articlesService.put(e)});return function(a){return i.apply(this,arguments)}}()}]})).present()})()}setCodeBarre(e){var t=this;return(0,l.Z)(function*(){var i;yield(yield t.alertController.create({cssClass:"my-custom-class",header:"Renseigner le code barre",inputs:[{type:"text",value:void 0===e.codeBarre?null:e.codeBarre,name:"codeBarre"}],buttons:[{text:"Annuler",role:"cancel",cssClass:"secondary",handler:()=>{}},{text:"Valider",handler:(i=(0,l.Z)(function*(n){e.codeBarre=""===n.codeBarre?null:n.codeBarre,yield t.articlesService.put(e),yield t.refresh()}),function(a){return i.apply(this,arguments)})}]})).present()})()}putFamilleArticleOfArticle(e){var t=this;return(0,l.Z)(function*(){const s=yield t.famillesService.get(),i=[];var a;s.map(a=>{i.push({type:"radio",label:a.libelle,value:a})}),yield(yield t.alertController.create({cssClass:"my-custom-class",header:"Nouvelle article",inputs:i,buttons:[{text:"Annuler",role:"cancel",cssClass:"secondary",handler:()=>{}},{text:"Valider",handler:(a=(0,l.Z)(function*(c){e.familleId=c.id,yield t.articlesService.put(e),yield t.refresh()}),function(h){return a.apply(this,arguments)})}]})).present()})()}putCodeBarre(e){var t=this;return(0,l.Z)(function*(){var s=yield t.scanne();e.codeBarre=s,yield t.articlesService.put(e)})()}putPrix(e){var t=this;return(0,l.Z)(function*(){const s=[];var n;e.prix.map(function(){var n=(0,l.Z)(function*(a){var c=yield t.magasins.find(h=>h.id==a.magasin);s.push({type:"radio",label:a.prix+"F "+(null==c?void 0:c.libelle),value:{prix:a.prix,article:e,magasinId:a.magasin}})});return function(a){return n.apply(this,arguments)}}()),yield(yield t.alertController.create({cssClass:"my-custom-class",header:"Les prix appliqu\xe9es",inputs:s,buttons:[{text:"Annuler",role:"cancel",cssClass:"secondary",handler:()=>{}},{text:"Ajouter un prix",cssClass:"secondary",handler:(n=(0,l.Z)(function*(){yield t.postNouveauPrixChooseMagasin(e)}),function(){return n.apply(this,arguments)})},{text:"Modifier le prix",handler:function(){var n=(0,l.Z)(function*(a){yield t.updatePrixArticleMagasin(a)});return function(c){return n.apply(this,arguments)}}()}]})).present()})()}updatePrixArticleMagasin(e){var t=this;return(0,l.Z)(function*(){var i;yield(yield t.alertController.create({cssClass:"my-custom-class",header:"Modifier le prix",inputs:[{type:"number",name:"prix",value:e.prix}],buttons:[{text:"Annuler",role:"cancel",cssClass:"secondary",handler:()=>{}},{text:"Valider",handler:(i=(0,l.Z)(function*(n){const a=e.article,c=yield a.prix.findIndex(h=>h.magasin===e.magasinId);a.prix[c].prix=Number(n.prix),yield t.articlesService.put(a),yield t.refresh()}),function(a){return i.apply(this,arguments)})}]})).present()})()}postNouveauPrixChooseMagasin(e){var t=this;return(0,l.Z)(function*(){const s=[],i=yield t.magasinsService.get(),n=[];var c;yield i.filter(c=>{for(let h of e.prix)h.magasin!==c.id&&n.push(c)}),n.map(c=>s.push({type:"radio",label:c.libelle,value:{magasin:c,article:e}})),yield(yield t.alertController.create({cssClass:"my-custom-class",header:"Nouvelle article",inputs:s,buttons:[{text:"Annuler",role:"cancel",cssClass:"secondary",handler:()=>{}},{text:"Valider",handler:(c=(0,l.Z)(function*(h){yield t.postNouveauPrixChoosePrix(h)}),function(R){return c.apply(this,arguments)})}]})).present()})()}postNouveauPrixChoosePrix(e){var t=this;return(0,l.Z)(function*(){var i;yield(yield t.alertController.create({cssClass:"my-custom-class",header:"Nouvelle article",inputs:[{type:"number",name:"prix"}],buttons:[{text:"Annuler",role:"cancel",cssClass:"secondary",handler:()=>{}},{text:"Valider",handler:(i=(0,l.Z)(function*(n){e.article.prix.push({magasin:e.magasin.id,prix:Number(n.prix)}),yield t.articlesService.put(e.article)}),function(a){return i.apply(this,arguments)})}]})).present()})()}supprimerDefinitivement(e){var t=this;return(0,l.Z)(function*(){yield t.articlesService.deleteDefinitivement(e),yield t.refresh()})()}}return(o=f).\u0275fac=function(e){return new(e||o)(r.Y36(_.V),r.Y36(C.J),r.Y36(b.t),r.Y36(Z.X),r.Y36(A.t),r.Y36(P.k),r.Y36(d.Br))},o.\u0275cmp=r.Xpm({type:o,selectors:[["app-articles"]],decls:15,vars:8,consts:[[3,"translucent"],["slot","start"],[3,"fullscreen"],["slot","fixed",3,"pullFactor","pullMin","pullMax","ionRefresh"],[4,"ngFor","ngForOf"],["slot","fixed","horizontal","end","vertical","bottom"],["size","small",3,"click"],["name","barcode"],["name","add"],[4,"ngIf"],["button","","detail","true",3,"disabled","click"],["name","barcode-outline",4,"ngIf"],["name","barcode-outline"]],template:function(e,t){1&e&&(r.TgZ(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-buttons",1),r._UZ(3,"ion-menu-button"),r.qZA(),r.TgZ(4,"ion-title"),r._uU(5,"Configurer vos articles"),r.qZA()()(),r.TgZ(6,"ion-content",2)(7,"ion-refresher",3),r.NdJ("ionRefresh",function(i){return t.handleRefresh(i)}),r._UZ(8,"ion-refresher-content"),r.qZA(),r.YNc(9,M,7,2,"ion-list",4),r.TgZ(10,"ion-fab",5)(11,"ion-fab-button",6),r.NdJ("click",function(){return t.postArticleByCodeBarre()}),r._UZ(12,"ion-icon",7),r.qZA(),r.TgZ(13,"ion-fab-button",6),r.NdJ("click",function(){return t.post()}),r._UZ(14,"ion-icon",8),r.qZA()()()),2&e&&(r.Q6J("translucent",!0),r.xp6(6),r.Udp("visibility",t.content_visibility),r.Q6J("fullscreen",!0),r.xp6(1),r.Q6J("pullFactor",.5)("pullMin",100)("pullMax",200),r.xp6(2),r.Q6J("ngForOf",t.familles))},dependencies:[m.sg,m.O5,d.Sm,d.W2,d.IJ,d.W4,d.Gu,d.gu,d.Ie,d.Q$,d.q_,d.fG,d.nJ,d.Wo,d.wd,d.sr]}),f})()}];let T=(()=>{var o;class f{}return(o=f).\u0275fac=function(e){return new(e||o)},o.\u0275mod=r.oAB({type:o}),o.\u0275inj=r.cJS({imports:[v.Bz.forChild(I),v.Bz]}),f})(),F=(()=>{var o;class f{}return(o=f).\u0275fac=function(e){return new(e||o)},o.\u0275mod=r.oAB({type:o}),o.\u0275inj=r.cJS({imports:[m.ez,g.u5,d.Pc,T]}),f})()}}]);