"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[5011],{5011:(D,F,f)=>{f.r(F),f.d(F,{CoursesPageModule:()=>I});var g=f(6814),v=f(95),u=f(7027),A=f(9801),p=f(5861),C=f(3009),e=f(6689),S=f(6199),M=f(202),O=f(849),J=f(2014),y=f(6815);function b(c,x){1&c&&e._UZ(0,"ion-icon",21)}function P(c,x){if(1&c&&(e.TgZ(0,"ion-chip",22),e._uU(1),e.qZA()),2&c){const a=e.oxw().$implicit,t=e.oxw();e.xp6(1),e.Oqu(t.getLibellePayeur(a.payeurId))}}function i(c,x){1&c&&e._UZ(0,"ion-icon",23)}function s(c,x){if(1&c){const a=e.EpF();e.TgZ(0,"ion-item-option",24),e.NdJ("click",function(){e.CHM(a);const n=e.oxw().$implicit,o=e.oxw();return e.KtG(o.activer(n))}),e._uU(1," Cl\xf4turer "),e.qZA()}}function r(c,x){if(1&c){const a=e.EpF();e.TgZ(0,"ion-item-option",25),e.NdJ("click",function(){e.CHM(a);const n=e.oxw().$implicit,o=e.oxw();return e.KtG(o.activer(n))}),e._uU(1," D\xe9cl\xf4turer "),e.qZA()}}function l(c,x){if(1&c){const a=e.EpF();e.TgZ(0,"ion-item-sliding")(1,"ion-item",11),e.NdJ("click",function(){const o=e.CHM(a).$implicit,h=e.oxw();return e.KtG(h.put(o.id))}),e.YNc(2,b,1,0,"ion-icon",12),e.TgZ(3,"ion-label")(4,"h3")(5,"ion-chip"),e._uU(6),e.qZA(),e._uU(7),e.qZA(),e.YNc(8,P,2,1,"ion-chip",13),e.qZA(),e.YNc(9,i,1,0,"ion-icon",14),e.qZA(),e.TgZ(10,"ion-item-options",15),e.YNc(11,s,2,0,"ion-item-option",16),e.YNc(12,r,2,0,"ion-item-option",17),e.TgZ(13,"ion-item-option",18),e.NdJ("click",function(){const o=e.CHM(a).$implicit,h=e.oxw();return e.KtG(h.supprimer(o))}),e._uU(14," Supprimer "),e.qZA()(),e.TgZ(15,"ion-item-options",19)(16,"ion-item-option",20),e.NdJ("click",function(){const o=e.CHM(a).$implicit,h=e.oxw();return e.KtG(h.setIsFocus(o))}),e._uU(17," Focus "),e.qZA(),e.TgZ(18,"ion-item-option",20),e.NdJ("click",function(){const o=e.CHM(a).$implicit,h=e.oxw();return e.KtG(h.setPayeur(o))}),e._uU(19," Payeur "),e.qZA()()()}if(2&c){const a=x.$implicit,t=e.oxw();e.xp6(1),e.Q6J("disabled",!a.actif||"DELETE"===a.firebaseMethod),e.xp6(1),e.Q6J("ngIf",a.isFocus),e.xp6(4),e.Oqu(a.date),e.xp6(1),e.AsE(" ",t.getLibelleMagasin(a.magasinId)," - ",a.montantTheorique," XPF"),e.xp6(1),e.Q6J("ngIf",void 0!==a.payeurId),e.xp6(1),e.Q6J("ngIf",!a.actif),e.xp6(2),e.Q6J("ngIf",a.actif),e.xp6(1),e.Q6J("ngIf",!a.actif)}}const T=[{path:"",component:(()=>{var c;class x{constructor(t,n,o,h,m,Z){this.coursesService=t,this.magasinsService=n,this.storageService=o,this.storage=h,this.utility=m,this.alertController=Z,this.courses=[],this.magasins=[],this.isActif=!0,this.payeurs=[],this.isAfficherCourseCloturer=!0}ngOnInit(){var t=this;return(0,p.Z)(function*(){yield t.refresh()})()}handleRefresh(t){this.storageService.synchroniser(C.K.Courses).then(()=>{this.storageService.synchroniser(C.K.CourseDetails).then(()=>{t.target.complete(),this.refresh()})})}getPayeurs(){var t=this;return(0,p.Z)(function*(){return yield t.storage.get(C.K.Utilisateurs)})()}setPayeur(t){var n=this;return(0,p.Z)(function*(){const o=yield n.getPayeurs(),h=[];var Z;o.map(Z=>h.push({type:"radio",value:Z.id,label:Z.libelle})),yield(yield n.alertController.create({cssClass:"my-custom-class",header:"D\xe9finir le payeur",inputs:h,buttons:[{text:"Annuler",role:"cancel",cssClass:"secondary",handler:()=>{}},{text:"Valider",handler:(Z=(0,p.Z)(function*(K){t.payeurId=K,yield n.coursesService.putCourse(t),n.refresh()}),function(E){return Z.apply(this,arguments)})}]})).present()})()}getLibellePayeur(t){var n;return null===(n=this.payeurs.find(o=>o.id===t))||void 0===n?void 0:n.libelle}get(){var t=this;return(0,p.Z)(function*(){const n=yield t.coursesService.getCourse();return t.isAfficherCourseCloturer?n:n.filter(o=>o.actif)})()}setIsAfficherCourseMasquer(){var t=this;return(0,p.Z)(function*(){t.isAfficherCourseCloturer=!t.isAfficherCourseCloturer;const n=yield t.utility.getConnexionInfo();n.isCourseAfficher=t.isAfficherCourseCloturer,yield t.utility.putConnexionInfo(n),yield t.refresh()})()}refresh(){var t=this;return(0,p.Z)(function*(){const n=yield t.utility.getConnexionInfo();t.isAfficherCourseCloturer=n.isCourseAfficher;const o=yield t.get();t.courses=o.filter(Z=>null==Z.deletedOn);const h=yield t.getMagasin();t.magasins=h;const m=yield t.getPayeurs();t.payeurs=m})()}getMagasin(){var t=this;return(0,p.Z)(function*(){return yield t.storage.get(C.K.Magasins)})()}getLibelleMagasin(t){var n;return null===(n=this.magasins.find(o=>o.id==t))||void 0===n?void 0:n.libelle}post(){var t=this;return(0,p.Z)(function*(){const n=yield t.magasinsService.get(),o=[];var m;n.map(m=>o.push({type:"radio",value:m.id,label:m.libelle})),yield(yield t.alertController.create({cssClass:"my-custom-class",header:"Ou souhaitez-vous faire vos courses ?",inputs:o,buttons:[{text:"Annuler",role:"cancel",cssClass:"secondary",handler:()=>{}},{text:"Valider",handler:(m=(0,p.Z)(function*(Z){yield t.postChooseDate(Z)}),function(K){return m.apply(this,arguments)})}]})).present()})()}postChooseDate(t){var n=this;return(0,p.Z)(function*(){var h;yield(yield n.alertController.create({cssClass:"my-custom-class",header:"A quelle date ?",inputs:[{type:"date",value:(new Date).toISOString().slice(0,10)}],buttons:[{text:"Annuler",role:"cancel",cssClass:"secondary",handler:()=>{}},{text:"Valider",handler:(h=(0,p.Z)(function*(m){var Z={id:Date.now(),ordre:yield n.generateOrdreCourse(),magasinId:t,montantTheorique:0,montantReel:0,ecart:0,date:m[0],actif:!0,isFirebase:!1,isFocus:!0};yield n.coursesService.postCourse(Z),yield n.refresh()}),function(Z){return h.apply(this,arguments)})}]})).present()})()}generateOrdreCourse(){var t=this;return(0,p.Z)(function*(){const n=yield t.coursesService.getCourse(),o=yield t.coursesService.sortByOrdreDesc(n).pop();return Number(null==o?void 0:o.ordre)+1})()}put(t){this.utility.navigateTo("course-details/"+t)}activer(t){var n=this;return(0,p.Z)(function*(){t.actif=!t.actif,t.isFocus=!1,yield n.coursesService.putCourse(t),yield n.refresh()})()}supprimer(t){var n=this;return(0,p.Z)(function*(){yield n.coursesService.deleteCourseDefinitivement(t),yield n.refresh()})()}setIsFocus(t){var n=this;return(0,p.Z)(function*(){const o=yield n.get();o.map(m=>m.isFocus=!1);const h=yield o.findIndex(m=>t.id===m.id);o[h].isFocus=!0,yield n.storage.set(C.K.Courses,o),n.refresh()})()}}return(c=x).\u0275fac=function(t){return new(t||c)(e.Y36(S.N),e.Y36(M.t),e.Y36(O.V),e.Y36(J.K),e.Y36(y.t),e.Y36(u.Br))},c.\u0275cmp=e.Xpm({type:c,selectors:[["app-courses"]],decls:18,vars:6,consts:[[3,"translucent"],["slot","start"],[3,"fullscreen"],["slot","fixed",3,"pullFactor","pullMin","pullMax","ionRefresh"],[4,"ngFor","ngForOf"],["slot","fixed","horizontal","end","vertical","bottom"],["size","small","routerLink","../memo"],["name","book-outline"],["size","small",3,"click"],["name","filter-outline"],["name","add"],["button","","detail","true",3,"disabled","click"],["name","pencil-outline",4,"ngIf"],["color","success",4,"ngIf"],["name","lock-closed-outline",4,"ngIf"],["side","start"],["style","background: rgb(156, 46, 46);",3,"click",4,"ngIf"],["style","background: rgb(100, 42, 209);",3,"click",4,"ngIf"],[2,"background","rgb(51, 14, 14)",3,"click"],["side","end"],[3,"click"],["name","pencil-outline"],["color","success"],["name","lock-closed-outline"],[2,"background","rgb(156, 46, 46)",3,"click"],[2,"background","rgb(100, 42, 209)",3,"click"]],template:function(t,n){1&t&&(e.TgZ(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-buttons",1),e._UZ(3,"ion-menu-button"),e.qZA(),e.TgZ(4,"ion-title"),e._uU(5,"Liste de course"),e.qZA()()(),e.TgZ(6,"ion-content",2)(7,"ion-refresher",3),e.NdJ("ionRefresh",function(h){return n.handleRefresh(h)}),e._UZ(8,"ion-refresher-content"),e.qZA(),e.TgZ(9,"ion-list"),e.YNc(10,l,20,9,"ion-item-sliding",4),e.qZA(),e.TgZ(11,"ion-fab",5)(12,"ion-fab-button",6),e._UZ(13,"ion-icon",7),e.qZA(),e.TgZ(14,"ion-fab-button",8),e.NdJ("click",function(){return n.setIsAfficherCourseMasquer()}),e._UZ(15,"ion-icon",9),e.qZA(),e.TgZ(16,"ion-fab-button",8),e.NdJ("click",function(){return n.post()}),e._UZ(17,"ion-icon",10),e.qZA()()()),2&t&&(e.Q6J("translucent",!0),e.xp6(6),e.Q6J("fullscreen",!0),e.xp6(1),e.Q6J("pullFactor",.5)("pullMin",100)("pullMax",200),e.xp6(3),e.Q6J("ngForOf",n.courses))},dependencies:[g.sg,g.O5,u.Sm,u.hM,u.W2,u.IJ,u.W4,u.Gu,u.gu,u.Ie,u.u8,u.IK,u.td,u.Q$,u.q_,u.fG,u.nJ,u.Wo,u.wd,u.sr,u.YI,A.rH]}),x})()}];let _=(()=>{var c;class x{}return(c=x).\u0275fac=function(t){return new(t||c)},c.\u0275mod=e.oAB({type:c}),c.\u0275inj=e.cJS({imports:[A.Bz.forChild(T),A.Bz]}),x})(),I=(()=>{var c;class x{}return(c=x).\u0275fac=function(t){return new(t||c)},c.\u0275mod=e.oAB({type:c}),c.\u0275inj=e.cJS({imports:[g.ez,v.u5,u.Pc,_]}),x})()},849:(D,F,f)=>{f.d(F,{V:()=>J});var g=f(5861),v=f(3009),u=function(y){return y.POST="POST",y.PUT="PUT",y.DELETE="DELETE",y}(u||{}),A=f(6689),p=f(2014),C=f(2386),e=f(9392),S=f(3182),M=f(553);let O=(()=>{var y;class b{constructor(i){this.firestore=i}post(i,s,r){return(0,g.Z)(function*(){const l=(0,S.ZF)(M.N.firebaseConfig),d=(0,e.ad)(l);yield(0,C.pl)((0,C.JU)(d,i,r),s)})()}getAll(i){var s=this;return(0,g.Z)(function*(){const r=yield(0,C.hJ)(s.firestore,i);return(0,C.BS)(r)})()}put(i,s,r){var l=this;return(0,g.Z)(function*(){const d=(0,C.JU)(l.firestore,i+"/"+s);return(0,C.r7)(d,r)})()}delete(i,s,r){var l=this;return(0,g.Z)(function*(){const d=(0,C.JU)(l.firestore,i+"/"+s);return(0,C.oe)(d)})()}}return(y=b).\u0275fac=function(i){return new(i||y)(A.LFG(C.gg))},y.\u0275prov=A.Yz7({token:y,factory:y.\u0275fac,providedIn:"root"}),b})(),J=(()=>{var y;class b{constructor(i,s){this.storage=i,this.firestore=s}postAll(i,s){var r=this;return(0,g.Z)(function*(){(yield r.getConnexionInfo()).isOnline&&(yield(yield s.filter(T=>!T.isFirebase)).map(function(){var T=(0,g.Z)(function*(_){_.isFirebase=!0,yield r.firestore.post(i,_,_.id.toString())});return function(_){return T.apply(this,arguments)}}())),yield r.storage.set(i,s)})()}post(i,s){var r=this;return(0,g.Z)(function*(){var l=yield r.getAll(i);s.id=Number(new Date),s.createdOn=new Date,s.modifiedOn=null,s.deletedOn=null,s.isFirebase=!1,l.push(s),yield r.postAll(i,l)})()}get(i){var s=this;return(0,g.Z)(function*(){return yield(yield s.storage.get(i)).filter(l=>""===l.deletedOn||null===l.deletedOn||void 0!==l.deletedOn)})()}getAll(i){var s=this;return(0,g.Z)(function*(){return yield s.storage.get(i)})()}getIndex(i,s){var r=this;return(0,g.Z)(function*(){return yield(yield r.getAll(i)).findIndex(d=>d.id===s)})()}put(i,s){var r=this;return(0,g.Z)(function*(){const l=yield r.getAll(i),d=yield r.getIndex(i,s.id);l[d]=s,l[d].modifiedOn=new Date,(yield r.getConnexionInfo()).isOnline?yield r.firestore.put(i,s.id.toString(),s):l[d].isFirebase&&(l[d].firebaseMethod=u.PUT),yield r.postAll(i,l)})()}delete(i,s){var r=this;return(0,g.Z)(function*(){const l=yield r.getAll(i),d=yield r.getIndex(i,s.id);l[d].deletedOn=new Date,l[d].firebaseMethod=u.DELETE,yield r.postAll(i,l),(yield r.getConnexionInfo()).isOnline&&(yield r.firestore.put(i,s.id.toString(),s))})()}deleteDefinitivement(i,s){var r=this;return(0,g.Z)(function*(){const l=yield r.getAll(i),d=yield r.getIndex(i,s.id);(yield r.getConnexionInfo()).isOnline?(l.splice(d,1),yield r.firestore.delete(i,s.id.toString(),s)):l[d].isFirebase?(l[d].firebaseMethod=u.DELETE,l[d].deletedOn=new Date):l.splice(d,1),yield r.postAll(i,l)})()}synchroniserAvecFirestore(){var i=this;return(0,g.Z)(function*(){(yield i.getConnexionInfo()).isOnline?(yield i.synchroniser(v.K.Utilisateurs),yield i.synchroniser(v.K.Articles),yield i.synchroniser(v.K.Courses),yield i.synchroniser(v.K.Familles),yield i.synchroniser(v.K.CourseDetails),yield i.synchroniser(v.K.Memos),yield i.synchroniser(v.K.HistoriquePrix),yield i.synchroniser(v.K.Magasins),yield i.synchroniser(v.K.Plats),yield i.synchroniser(v.K.PlatDetails),yield i.synchroniser(v.K.Groupes),yield i.synchroniser(v.K.Menus)):alert("Le mode onLine est d\xe9sactiv\xe9")})()}synchroniser(i){var s=this;return(0,g.Z)(function*(){if((yield s.getConnexionInfo()).isOnline){const l=yield s.storage.get(i),d=yield l.filter(_=>!_.isFirebase);d.length>0&&d.map(function(){var _=(0,g.Z)(function*(I){I.isFirebase=!0,yield s.firestore.post(i,I,I.id.toString())});return function(I){return _.apply(this,arguments)}}());const T=yield l.filter(_=>_.firebaseMethod===u.DELETE||_.firebaseMethod===u.PUT);T.length>0&&T.map(function(){var _=(0,g.Z)(function*(I){I.firebaseMethod===u.PUT&&(yield s.put(i,I)),I.firebaseMethod===u.DELETE&&(yield s.deleteDefinitivement(i,I))});return function(I){return _.apply(this,arguments)}}()),(yield s.firestore.getAll(i)).subscribe(_=>{s.storage.set(i,_)})}else alert("Le mode onLine est d\xe9sactiv\xe9")})()}set(i,s){var r=this;return(0,g.Z)(function*(){yield r.storage.set(i,s)})()}getConnexionInfo(){var i=this;return(0,g.Z)(function*(){return yield i.storage.get(v.K.InfoConnexion)})()}}return(y=b).\u0275fac=function(i){return new(i||y)(A.LFG(p.K),A.LFG(O))},y.\u0275prov=A.Yz7({token:y,factory:y.\u0275fac,providedIn:"root"}),b})()}}]);