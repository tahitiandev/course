"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[8622],{8622:(P,T,h)=>{h.r(T),h.d(T,{MemoPageModule:()=>m});var d=h(6814),y=h(95),o=h(7027),M=h(9801),x=h(5861),e=h(6689),Z=h(3629),b=h(6199),F=h(5512);let p=(()=>{var n;class u{transform(i,s){return i.filter(f=>f.libelle.toLowerCase().startsWith(s.toLowerCase()))}}return(n=u).\u0275fac=function(i){return new(i||n)},n.\u0275pipe=e.Yjl({name:"articleFiltreMemo",type:n,pure:!0}),u})();function v(n,u){if(1&n){const l=e.EpF();e.TgZ(0,"ion-item-sliding")(1,"ion-item")(2,"ion-label"),e._uU(3),e.qZA()(),e.TgZ(4,"ion-item-options",4)(5,"ion-item-option",5),e.NdJ("click",function(){const g=e.CHM(l).$implicit,f=e.oxw();return e.KtG(f.selectArticle(g))}),e._uU(6,"Selectionner"),e.qZA()()()}if(2&n){const l=u.$implicit;e.xp6(3),e.AsE("",l.libelle," - ",l.prix[0].prix," xpf")}}let _=(()=>{var n;class u{constructor(i){this.articleService=i,this.searchValue="",this.articles=[],this.articlesOutput=new e.vpe}ngOnInit(){this.onInit()}onInit(){var i=this;return(0,x.Z)(function*(){const s=yield i.getArticles();i.articles=s})()}getArticles(){var i=this;return(0,x.Z)(function*(){return yield i.articleService.get()})()}selectArticle(i){this.articlesOutput.emit(i)}}return(n=u).\u0275fac=function(i){return new(i||n)(e.Y36(F.J))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-search-article-memo"]],outputs:{articlesOutput:"articlesOutput"},decls:10,vars:5,consts:[[2,"width","80%","margin","auto","margin-top","20px"],[3,"ngModel","ngModelChange"],[2,"margin","5%","width","100%","height","460px","overflow","scroll"],[4,"ngFor","ngForOf"],["side","end"],[3,"click"]],template:function(i,s){1&i&&(e.TgZ(0,"ion-card",0)(1,"ion-card-header")(2,"ion-card-subtitle"),e._uU(3,"Rechercher d'article"),e.qZA()(),e.TgZ(4,"ion-card-content")(5,"ion-toolbar")(6,"ion-searchbar",1),e.NdJ("ngModelChange",function(f){return s.searchValue=f}),e.qZA()(),e.TgZ(7,"ion-list",2),e.YNc(8,v,7,2,"ion-item-sliding",3),e.ALo(9,"articleFiltreMemo"),e.qZA()()()),2&i&&(e.xp6(6),e.Q6J("ngModel",s.searchValue),e.xp6(2),e.Q6J("ngForOf",e.xi3(9,2,s.articles,s.searchValue)))},dependencies:[d.sg,y.JJ,y.On,o.PM,o.FN,o.Zi,o.tO,o.Ie,o.u8,o.IK,o.td,o.Q$,o.q_,o.VI,o.sr,o.j9,p]}),u})();function A(n,u){if(1&n){const l=e.EpF();e.TgZ(0,"ion-content")(1,"app-search-article-memo",4),e.NdJ("articlesOutput",function(s){e.CHM(l);const g=e.oxw();return e.KtG(g.selectArticle(s))}),e.qZA()()}}function I(n,u){if(1&n){const l=e.EpF();e.TgZ(0,"ion-item-sliding")(1,"ion-item",11),e.NdJ("click",function(){const g=e.CHM(l).$implicit,f=e.oxw(2);return e.KtG(f.put(g))}),e.TgZ(2,"ion-label"),e._uU(3),e.qZA(),e.TgZ(4,"ion-label",12),e._uU(5),e.qZA()(),e.TgZ(6,"ion-item-options",13)(7,"ion-item-option",14),e.NdJ("click",function(){const g=e.CHM(l).$implicit,f=e.oxw(2);return e.KtG(f.sendToCourse(g))}),e._uU(8," Envoyer "),e.qZA(),e.TgZ(9,"ion-item-option",14),e.NdJ("click",function(){const g=e.CHM(l).$implicit,f=e.oxw(2);return e.KtG(f.retirer(g))}),e._uU(10," Retirer "),e.qZA()()()}if(2&n){const l=u.$implicit;e.xp6(3),e.Oqu(l.article.libelle),e.xp6(2),e.hij("Qte : ",l.quantite,"")}}function t(n,u){if(1&n){const l=e.EpF();e.TgZ(0,"ion-content")(1,"ion-list",5),e.YNc(2,I,11,2,"ion-item-sliding",6),e.qZA(),e.TgZ(3,"ion-fab",7)(4,"ion-fab-button",8),e.NdJ("click",function(){e.CHM(l);const s=e.oxw();return e.KtG(s.postManuel())}),e._UZ(5,"ion-icon",9),e.qZA(),e.TgZ(6,"ion-fab-button",8),e.NdJ("click",function(){e.CHM(l);const s=e.oxw();return e.KtG(s.postMemo())}),e._UZ(7,"ion-icon",10),e.qZA()()()}if(2&n){const l=e.oxw();e.xp6(1),e.Q6J("inset",!0),e.xp6(1),e.Q6J("ngForOf",l.memos)}}const c=[{path:"",component:(()=>{var n;class u{constructor(i,s,g,f){this.memoService=i,this.courseservice=s,this.alertController=g,this.articleService=f,this.memos=[],this.isRechercheAvance=!1}ngOnInit(){var i=this;return(0,x.Z)(function*(){yield i.refresh()})()}refresh(){var i=this;return(0,x.Z)(function*(){const s=yield(yield i.memoService.get()).filter(g=>null==g.deletedOn);i.memos=s})()}put(i){var s=this;return(0,x.Z)(function*(){var f;yield(yield s.alertController.create({cssClass:"my-custom-class",header:"Nouvelle article",inputs:[{type:"text",placeholder:i.article.libelle,disabled:!0},{type:"number",name:"quantite",placeholder:i.quantite.toString(),value:i.quantite}],buttons:[{text:"Annuler",role:"cancel",cssClass:"secondary",handler:()=>{}},{text:"Valider",handler:(f=(0,x.Z)(function*(C){i.quantite=null==C.quantite||""===C.quantite?1:Number(C.quantite),yield s.memoService.put(i),yield s.refresh()}),function(O){return f.apply(this,arguments)})}]})).present()})()}selectArticle(i){var s=this;return(0,x.Z)(function*(){var g={id:Number(new Date),article:i,quantite:1,isFirebase:!1};yield s.memoService.post(g),yield s.refresh(),s.postMemo()})()}postMemo(){this.isRechercheAvance=!this.isRechercheAvance}retirer(i){var s=this;return(0,x.Z)(function*(){yield s.memoService.delete(i),yield s.refresh()})()}postManuel(){var i=this;return(0,x.Z)(function*(){var g;yield(yield i.alertController.create({cssClass:"my-custom-class",header:"Nouvelle article",inputs:[{type:"text",placeholder:"Nom de l'article",name:"libelle"},{type:"number",name:"quantite",placeholder:"Quantit\xe9"}],buttons:[{text:"Annuler",role:"cancel",cssClass:"secondary",handler:()=>{}},{text:"Valider",handler:(g=(0,x.Z)(function*(f){var C=null==f.quantite||""===f.quantite?1:Number(f.quantite),O={id:Number(new Date),libelle:f.libelle,prix:[{magasin:1,prix:100}],createdOn:new Date,groupeId:[0],familleId:0,codeBarre:"",isFirebase:!1},S={id:Number(new Date),article:O,quantite:C,isFirebase:!1};yield i.articleService.post(O),yield i.memoService.post(S),yield i.refresh()}),function(C){return g.apply(this,arguments)})}]})).present()})()}sendToCourse(i){var s=this;return(0,x.Z)(function*(){const g=yield s.courseservice.getCourseIsFocus(),f=i.article.prix.find(O=>O.magasin===g[0].magasinId),C={id:Number(new Date),ordre:0,courseId:g[0].id.toString(),libelle:i.article.libelle,quantite:i.quantite,articleId:i.article.id,prixArticle:void 0===f?i.article.prix[0].prix:f.prix,prixReel:void 0===f?i.article.prix[0].prix:f.prix,total:Number(i.quantite*(void 0===f?i.article.prix[0].prix:f.prix)),checked:!1,isFirebase:!1};yield s.courseservice.postCourseDetails(C),yield s.memoService.delete(i),s.refresh()})()}}return(n=u).\u0275fac=function(i){return new(i||n)(e.Y36(Z.T),e.Y36(b.N),e.Y36(o.Br),e.Y36(F.J))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-memo"]],decls:8,vars:3,consts:[[3,"translucent"],["slot","start"],["defaultHref","/courses"],[4,"ngIf"],[3,"articlesOutput"],[3,"inset"],[4,"ngFor","ngForOf"],["slot","fixed","horizontal","end","vertical","bottom"],["size","small",3,"click"],["name","calculator-outline"],["name","add"],["button","",3,"click"],["slot","end"],["side","end"],[3,"click"]],template:function(i,s){1&i&&(e.TgZ(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-buttons",1),e._UZ(3,"ion-back-button",2),e.qZA(),e.TgZ(4,"ion-title"),e._uU(5,"Notes"),e.qZA()()(),e.YNc(6,A,2,0,"ion-content",3),e.YNc(7,t,8,2,"ion-content",3)),2&i&&(e.Q6J("translucent",!0),e.xp6(6),e.Q6J("ngIf",s.isRechercheAvance),e.xp6(1),e.Q6J("ngIf",!s.isRechercheAvance))},dependencies:[d.sg,d.O5,o.oU,o.Sm,o.W2,o.IJ,o.W4,o.Gu,o.gu,o.Ie,o.u8,o.IK,o.td,o.Q$,o.q_,o.wd,o.sr,o.cs,_]}),u})()}];let a=(()=>{var n;class u{}return(n=u).\u0275fac=function(i){return new(i||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[M.Bz.forChild(c),M.Bz]}),u})(),m=(()=>{var n;class u{}return(n=u).\u0275fac=function(i){return new(i||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[d.ez,y.u5,o.Pc,a]}),u})()},5512:(P,T,h)=>{h.d(T,{J:()=>e});var d=h(5861),y=h(3009),o=h(6689),M=h(849),x=h(6815);let e=(()=>{var Z;class b{constructor(p,v){this.storage=p,this.utility=v}get(){var p=this;return(0,d.Z)(function*(){return p.orderByFamille(yield p.storage.get(y.K.Articles))})()}post(p){var v=this;return(0,d.Z)(function*(){yield v.storage.post(y.K.Articles,p)})()}put(p){var v=this;return(0,d.Z)(function*(){yield v.storage.put(y.K.Articles,p)})()}delete(p){var v=this;return(0,d.Z)(function*(){yield v.storage.delete(y.K.Articles,p)})()}deleteDefinitivement(p){var v=this;return(0,d.Z)(function*(){yield v.storage.deleteDefinitivement(y.K.Articles,p)})()}getArticleById(p){var v=this;return(0,d.Z)(function*(){return(yield v.get()).filter(A=>A.id==p)})()}getArticleByCodeBarre(p){var v=this;return(0,d.Z)(function*(){return(yield v.get()).filter(A=>A.codeBarre==p)})()}orderByFamille(p){return p.sort((v,_)=>v.familleId<_.familleId?-1:1)}}return(Z=b).\u0275fac=function(p){return new(p||Z)(o.LFG(M.V),o.LFG(x.t))},Z.\u0275prov=o.Yz7({token:Z,factory:Z.\u0275fac,providedIn:"root"}),b})()},849:(P,T,h)=>{h.d(T,{V:()=>v});var d=h(5861),y=h(3009),o=function(_){return _.POST="POST",_.PUT="PUT",_.DELETE="DELETE",_}(o||{}),M=h(6689),x=h(2014),e=h(2386),Z=h(9392),b=h(3182),F=h(553);let p=(()=>{var _;class A{constructor(t){this.firestore=t}post(t,r,c){return(0,d.Z)(function*(){const a=(0,b.ZF)(F.N.firebaseConfig),m=(0,Z.ad)(a);yield(0,e.pl)((0,e.JU)(m,t,c),r)})()}getAll(t){var r=this;return(0,d.Z)(function*(){const c=yield(0,e.hJ)(r.firestore,t);return(0,e.BS)(c)})()}put(t,r,c){var a=this;return(0,d.Z)(function*(){const m=(0,e.JU)(a.firestore,t+"/"+r);return(0,e.r7)(m,c)})()}delete(t,r,c){var a=this;return(0,d.Z)(function*(){const m=(0,e.JU)(a.firestore,t+"/"+r);return(0,e.oe)(m)})()}}return(_=A).\u0275fac=function(t){return new(t||_)(M.LFG(e.gg))},_.\u0275prov=M.Yz7({token:_,factory:_.\u0275fac,providedIn:"root"}),A})(),v=(()=>{var _;class A{constructor(t,r){this.storage=t,this.firestore=r}postAll(t,r){var c=this;return(0,d.Z)(function*(){(yield c.getConnexionInfo()).isOnline&&(yield(yield r.filter(n=>!n.isFirebase)).map(function(){var n=(0,d.Z)(function*(u){u.isFirebase=!0,yield c.firestore.post(t,u,u.id.toString())});return function(u){return n.apply(this,arguments)}}())),yield c.storage.set(t,r)})()}post(t,r){var c=this;return(0,d.Z)(function*(){var a=yield c.getAll(t);r.id=Number(new Date),r.createdOn=new Date,r.modifiedOn=null,r.deletedOn=null,r.isFirebase=!1,a.push(r),yield c.postAll(t,a)})()}get(t){var r=this;return(0,d.Z)(function*(){return yield(yield r.storage.get(t)).filter(a=>""===a.deletedOn||null===a.deletedOn||void 0!==a.deletedOn)})()}getAll(t){var r=this;return(0,d.Z)(function*(){return yield r.storage.get(t)})()}getIndex(t,r){var c=this;return(0,d.Z)(function*(){return yield(yield c.getAll(t)).findIndex(m=>m.id===r)})()}put(t,r){var c=this;return(0,d.Z)(function*(){const a=yield c.getAll(t),m=yield c.getIndex(t,r.id);a[m]=r,a[m].modifiedOn=new Date,(yield c.getConnexionInfo()).isOnline?yield c.firestore.put(t,r.id.toString(),r):a[m].isFirebase&&(a[m].firebaseMethod=o.PUT),yield c.postAll(t,a)})()}delete(t,r){var c=this;return(0,d.Z)(function*(){const a=yield c.getAll(t),m=yield c.getIndex(t,r.id);a[m].deletedOn=new Date,a[m].firebaseMethod=o.DELETE,yield c.postAll(t,a),(yield c.getConnexionInfo()).isOnline&&(yield c.firestore.put(t,r.id.toString(),r))})()}deleteDefinitivement(t,r){var c=this;return(0,d.Z)(function*(){const a=yield c.getAll(t),m=yield c.getIndex(t,r.id);(yield c.getConnexionInfo()).isOnline?(a.splice(m,1),yield c.firestore.delete(t,r.id.toString(),r)):a[m].isFirebase?(a[m].firebaseMethod=o.DELETE,a[m].deletedOn=new Date):a.splice(m,1),yield c.postAll(t,a)})()}synchroniserAvecFirestore(){var t=this;return(0,d.Z)(function*(){(yield t.getConnexionInfo()).isOnline?(yield t.synchroniser(y.K.Utilisateurs),yield t.synchroniser(y.K.Articles),yield t.synchroniser(y.K.Courses),yield t.synchroniser(y.K.Familles),yield t.synchroniser(y.K.CourseDetails),yield t.synchroniser(y.K.Memos),yield t.synchroniser(y.K.HistoriquePrix),yield t.synchroniser(y.K.Magasins),yield t.synchroniser(y.K.Plats),yield t.synchroniser(y.K.PlatDetails),yield t.synchroniser(y.K.Groupes),yield t.synchroniser(y.K.Menus)):alert("Le mode onLine est d\xe9sactiv\xe9")})()}synchroniser(t){var r=this;return(0,d.Z)(function*(){if((yield r.getConnexionInfo()).isOnline){const a=yield r.storage.get(t),m=yield a.filter(u=>!u.isFirebase);m.length>0&&m.map(function(){var u=(0,d.Z)(function*(l){l.isFirebase=!0,yield r.firestore.post(t,l,l.id.toString())});return function(l){return u.apply(this,arguments)}}());const n=yield a.filter(u=>u.firebaseMethod===o.DELETE||u.firebaseMethod===o.PUT);n.length>0&&n.map(function(){var u=(0,d.Z)(function*(l){l.firebaseMethod===o.PUT&&(yield r.put(t,l)),l.firebaseMethod===o.DELETE&&(yield r.deleteDefinitivement(t,l))});return function(l){return u.apply(this,arguments)}}()),(yield r.firestore.getAll(t)).subscribe(u=>{r.storage.set(t,u)})}else alert("Le mode onLine est d\xe9sactiv\xe9")})()}set(t,r){var c=this;return(0,d.Z)(function*(){yield c.storage.set(t,r)})()}getConnexionInfo(){var t=this;return(0,d.Z)(function*(){return yield t.storage.get(y.K.InfoConnexion)})()}}return(_=A).\u0275fac=function(t){return new(t||_)(M.LFG(x.K),M.LFG(p))},_.\u0275prov=M.Yz7({token:_,factory:_.\u0275fac,providedIn:"root"}),A})()}}]);