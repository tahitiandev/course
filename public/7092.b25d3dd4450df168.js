"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[7092],{9825:(T,v,l)=>{l.d(v,{f:()=>a});var a=function(s){return s.POST="POST",s.PUT="PUT",s.DELETE="DELETE",s}(a||{})},7092:(T,v,l)=>{l.r(v),l.d(v,{AuthentificationPageModule:()=>m});var a=l(6814),s=l(95),c=l(7027),y=l(9801),A=l(5861),g=l(3009),o=l(6689),Z=l(6815),x=l(5423),I=l(4073);const f=[{path:"",component:(()=>{var e;class t{constructor(n,r,d,u){this.formbuilder=n,this.utility=r,this.storage=d,this.utilisateursService=u,this.authentificationForm=new s.cw([])}ngOnInit(){this.authentificationFormInit()}authentificationFormInit(){this.authentificationForm=this.formbuilder.group({username:"",password:""})}handleRefresh(n){var r=this;return(0,A.Z)(function*(){yield r.storage.synchroniser(g.K.Utilisateurs),n.target.complete(),yield r.utility.popUp("Synchronisation des utilisateurs termin\xe9e")})()}onValide(){var n=this;return(0,A.Z)(function*(){const r=n.authentificationForm.value,u=yield(yield n.utilisateursService.get()).filter(h=>h.username===r.username);if(u.length>0)if(u[0].password===r.password){const h={isConnected:!0,utilisateurId:u[0].id,groupeId:u[0].groupeId,isOnline:!0,isCourseAfficher:!0,isCourseRapide:!0,budget:1e4,epargne:0};console.log(h),yield n.storage.set(g.K.InfoConnexion,h),yield n.storage.synchroniserAvecFirestore(),n.utility.navigateTo("home")}else console.log("Le mot de passe est incorrecte");else console.log("Le login renseign\xe9 n'existe pas");n.authentificationForm.patchValue({username:"",password:""})})()}navigateToCreerUtilisateur(){this.utility.navigateTo("creation-utilisateur")}}return(e=t).\u0275fac=function(n){return new(n||e)(o.Y36(s.qu),o.Y36(Z.t),o.Y36(x.V),o.Y36(I.X))},e.\u0275cmp=o.Xpm({type:e,selectors:[["app-authentification"]],decls:20,vars:6,consts:[[3,"translucent"],["slot","start"],[3,"fullscreen"],["slot","fixed",3,"pullFactor","pullMin","pullMax","ionRefresh"],[3,"formGroup","ngSubmit"],["formControlName","username","label","Votre login","label-placement","floating","fill","outline","placeholder","Votre login"],["formControlName","password","label","Votre mot de passe","type","password","label-placement","floating","fill","outline","placeholder","Votre mot de passe"],["type","submit","expand","full"],[2,"cursor","pointer",3,"click"]],template:function(n,r){1&n&&(o.TgZ(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-buttons",1),o._UZ(3,"ion-menu-button"),o.qZA(),o.TgZ(4,"ion-title"),o._uU(5,"Se connecter"),o.qZA()()(),o.TgZ(6,"ion-content",2)(7,"ion-refresher",3),o.NdJ("ionRefresh",function(u){return r.handleRefresh(u)}),o._UZ(8,"ion-refresher-content"),o.qZA(),o.TgZ(9,"form",4),o.NdJ("ngSubmit",function(){return r.onValide()}),o.TgZ(10,"ion-item"),o._UZ(11,"ion-input",5),o.qZA(),o._UZ(12,"br"),o.TgZ(13,"ion-item"),o._UZ(14,"ion-input",6),o.qZA(),o._UZ(15,"br"),o.TgZ(16,"ion-button",7),o._uU(17,"VALIDER"),o.qZA(),o.TgZ(18,"p",8),o.NdJ("click",function(){return r.navigateToCreerUtilisateur()}),o._uU(19,"Se cr\xe9er un compte"),o.qZA()()()),2&n&&(o.Q6J("translucent",!0),o.xp6(6),o.Q6J("fullscreen",!0),o.xp6(1),o.Q6J("pullFactor",.5)("pullMin",100)("pullMax",200),o.xp6(2),o.Q6J("formGroup",r.authentificationForm))},dependencies:[s._Y,s.JJ,s.JL,c.YG,c.Sm,c.W2,c.Gu,c.pK,c.Ie,c.fG,c.nJ,c.Wo,c.wd,c.sr,c.j9,s.sg,s.u]}),t})()}];let p=(()=>{var e;class t{}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275mod=o.oAB({type:e}),e.\u0275inj=o.cJS({imports:[y.Bz.forChild(f),y.Bz]}),t})(),m=(()=>{var e;class t{}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275mod=o.oAB({type:e}),e.\u0275inj=o.cJS({imports:[a.ez,s.u5,c.Pc,p,s.UX,s.u5]}),t})()},5423:(T,v,l)=>{l.d(v,{V:()=>F});var a=l(5861),s=l(3009),c=l(9825),y=l(6689),A=l(2014),g=l(2386),o=l(9392),Z=l(3182),x=l(553);let I=(()=>{var f;class p{constructor(e){this.firestore=e}post(e,t,i){return(0,a.Z)(function*(){const n=(0,Z.ZF)(x.N.firebaseConfig),r=(0,o.ad)(n);yield(0,g.pl)((0,g.JU)(r,e,i),t)})()}getAll(e){var t=this;return(0,a.Z)(function*(){const i=yield(0,g.hJ)(t.firestore,e);return(0,g.BS)(i)})()}put(e,t,i){var n=this;return(0,a.Z)(function*(){const r=(0,g.JU)(n.firestore,e+"/"+t);return(0,g.r7)(r,i)})()}delete(e,t,i){var n=this;return(0,a.Z)(function*(){const r=(0,g.JU)(n.firestore,e+"/"+t);return(0,g.oe)(r)})()}}return(f=p).\u0275fac=function(e){return new(e||f)(y.LFG(g.gg))},f.\u0275prov=y.Yz7({token:f,factory:f.\u0275fac,providedIn:"root"}),p})(),F=(()=>{var f;class p{constructor(e,t){this.storage=e,this.firestore=t}postAll(e,t){var i=this;return(0,a.Z)(function*(){(yield i.getConnexionInfo()).isOnline&&(yield(yield t.filter(d=>!d.isFirebase)).map(function(){var d=(0,a.Z)(function*(u){u.isFirebase=!0,yield i.firestore.post(e,u,u.id.toString())});return function(u){return d.apply(this,arguments)}}())),yield i.storage.set(e,t)})()}parseDate(e){const i=new Date(e).getTime();return{nanoseconds:i%1e3*1e6,seconds:Math.floor(i/1e3)}}post(e,t){var i=this;return(0,a.Z)(function*(){var n=yield i.getAll(e);t.id=Number(new Date),t.createdOn=i.parseDate(new Date),t.modifiedOn=null,t.deletedOn=null,t.isFirebase=!1,n.push(t),yield i.postAll(e,n)})()}get(e){var t=this;return(0,a.Z)(function*(){return yield(yield t.storage.get(e)).filter(n=>""===n.deletedOn||null===n.deletedOn||void 0!==n.deletedOn)})()}getAll(e){var t=this;return(0,a.Z)(function*(){return yield t.storage.get(e)})()}getIndex(e,t){var i=this;return(0,a.Z)(function*(){return yield(yield i.getAll(e)).findIndex(r=>r.id===t)})()}put(e,t){var i=this;return(0,a.Z)(function*(){const n=yield i.getAll(e),r=yield i.getIndex(e,t.id);n[r]=t,n[r].modifiedOn=new Date,(yield i.getConnexionInfo()).isOnline?yield i.firestore.put(e,t.id.toString(),t):n[r].isFirebase&&(n[r].firebaseMethod=c.f.PUT),yield i.postAll(e,n)})()}delete(e,t){var i=this;return(0,a.Z)(function*(){const n=yield i.getAll(e),r=yield i.getIndex(e,t.id);n[r].deletedOn=new Date,n[r].firebaseMethod=c.f.DELETE,yield i.postAll(e,n),(yield i.getConnexionInfo()).isOnline&&(yield i.firestore.put(e,t.id.toString(),t))})()}deleteDefinitivement(e,t){var i=this;return(0,a.Z)(function*(){const n=yield i.getAll(e),r=yield i.getIndex(e,t.id);(yield i.getConnexionInfo()).isOnline?(n.splice(r,1),yield i.firestore.delete(e,t.id.toString(),t)):n[r].isFirebase?(n[r].firebaseMethod=c.f.DELETE,n[r].deletedOn=new Date):n.splice(r,1),yield i.postAll(e,n)})()}synchroniserAvecFirestore(){var e=this;return(0,a.Z)(function*(){(yield e.getConnexionInfo()).isOnline?(yield e.synchroniser(s.K.Utilisateurs),yield e.synchroniser(s.K.Articles),yield e.synchroniser(s.K.Courses),yield e.synchroniser(s.K.Familles),yield e.synchroniser(s.K.CourseDetails),yield e.synchroniser(s.K.Memos),yield e.synchroniser(s.K.HistoriquePrix),yield e.synchroniser(s.K.Depenses),yield e.synchroniser(s.K.Apports),yield e.synchroniser(s.K.Epargnes),yield e.synchroniser(s.K.Magasins),yield e.synchroniser(s.K.Plats),yield e.synchroniser(s.K.PlatDetails),yield e.synchroniser(s.K.Groupes),yield e.synchroniser(s.K.Menus),yield e.synchroniser(s.K.Budget)):alert("Le mode onLine est d\xe9sactiv\xe9")})()}synchroniser(e){var t=this;return(0,a.Z)(function*(){if((yield t.getConnexionInfo()).isOnline){const n=yield t.storage.get(e),r=yield n.filter(u=>!u.isFirebase);r.length>0&&r.map(function(){var u=(0,a.Z)(function*(h){h.isFirebase=!0,yield t.firestore.post(e,h,h.id.toString())});return function(h){return u.apply(this,arguments)}}());const d=yield n.filter(u=>u.firebaseMethod===c.f.DELETE||u.firebaseMethod===c.f.PUT);d.length>0&&d.map(function(){var u=(0,a.Z)(function*(h){h.firebaseMethod===c.f.PUT&&(yield t.put(e,h)),h.firebaseMethod===c.f.DELETE&&(yield t.deleteDefinitivement(e,h))});return function(h){return u.apply(this,arguments)}}()),(yield t.firestore.getAll(e)).subscribe(u=>{t.storage.set(e,u)})}else alert("Le mode onLine est d\xe9sactiv\xe9")})()}set(e,t){var i=this;return(0,a.Z)(function*(){yield i.storage.set(e,t)})()}getConnexionInfo(){var e=this;return(0,a.Z)(function*(){return yield e.storage.get(s.K.InfoConnexion)})()}}return(f=p).\u0275fac=function(e){return new(e||f)(y.LFG(A.K),y.LFG(I))},f.\u0275prov=y.Yz7({token:f,factory:f.\u0275fac,providedIn:"root"}),p})()}}]);