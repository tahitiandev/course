"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[6897],{7468:(I,m,c)=>{c.r(m),c.d(m,{MagasinsPageModule:()=>g});var l=c(6814),d=c(95),a=c(7027),v=c(9801),p=c(5861),t=c(6689),x=c(202);function Z(o,y){if(1&o){const e=t.EpF();t.TgZ(0,"ion-item-sliding")(1,"ion-item",7),t.NdJ("click",function(){const s=t.CHM(e).$implicit,r=t.oxw();return t.KtG(r.put(s))}),t.TgZ(2,"ion-label")(3,"h3"),t._uU(4),t.qZA()()(),t.TgZ(5,"ion-item-options",8)(6,"ion-item-option",9),t.NdJ("click",function(){const s=t.CHM(e).$implicit,r=t.oxw();return t.KtG(r.delete(s))}),t._uU(7," Supprimer "),t.qZA()()()}if(2&o){const e=y.$implicit;t.xp6(1),t.Q6J("disabled","DELETE"===e.firebaseMethod),t.xp6(3),t.Oqu(e.libelle)}}const M=[{path:"",component:(()=>{var o;class y{constructor(n,i){this.magasinsService=n,this.alertController=i,this.magasins=[]}ngOnInit(){this.refresh()}refresh(){var n=this;return(0,p.Z)(function*(){n.magasins=yield n.get()})()}get(){var n=this;return(0,p.Z)(function*(){return yield n.magasinsService.get()})()}post(){var n=this;return(0,p.Z)(function*(){var s;yield(yield n.alertController.create({cssClass:"my-custom-class",header:"Nouveau Magasin",inputs:[{type:"text",name:"libelle",label:"Libell\xe9"}],buttons:[{text:"Annuler",role:"cancel",cssClass:"secondary",handler:()=>{}},{text:"Valider",handler:(s=(0,p.Z)(function*(r){var u={id:Date.now(),libelle:r.libelle,createdOn:new Date,modifiedOn:new Date,deletedOn:new Date,isFirebase:!1};yield n.magasinsService.post(u),yield n.refresh()}),function(u){return s.apply(this,arguments)})}]})).present()})()}put(n){var i=this;return(0,p.Z)(function*(){var r;yield(yield i.alertController.create({cssClass:"my-custom-class",header:"Nouveau Magasin",inputs:[{type:"text",name:"libelle",placeholder:n.libelle}],buttons:[{text:"Annuler",role:"cancel",cssClass:"secondary",handler:()=>{}},{text:"Valider",handler:(r=(0,p.Z)(function*(u){n.libelle=""===u?n.libelle:u.libelle,yield i.magasinsService.put(n),yield i.refresh()}),function(f){return r.apply(this,arguments)})}]})).present()})()}delete(n){var i=this;return(0,p.Z)(function*(){yield i.magasinsService.delete(n),yield i.refresh()})()}}return(o=y).\u0275fac=function(n){return new(n||o)(t.Y36(x.t),t.Y36(a.Br))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-magasins"]],decls:12,vars:3,consts:[[3,"translucent"],["slot","start"],[3,"fullscreen"],[4,"ngFor","ngForOf"],["slot","fixed","horizontal","end","vertical","bottom",3,"click"],["size","small"],["name","add"],["button","","detail","true",3,"disabled","click"],["side","start"],[2,"background","red",3,"click"]],template:function(n,i){1&n&&(t.TgZ(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-buttons",1),t._UZ(3,"ion-menu-button"),t.qZA(),t.TgZ(4,"ion-title"),t._uU(5,"Configurer vos magasins"),t.qZA()()(),t.TgZ(6,"ion-content",2)(7,"ion-list"),t.YNc(8,Z,8,2,"ion-item-sliding",3),t.qZA(),t.TgZ(9,"ion-fab",4),t.NdJ("click",function(){return i.post()}),t.TgZ(10,"ion-fab-button",5),t._UZ(11,"ion-icon",6),t.qZA()()()),2&n&&(t.Q6J("translucent",!0),t.xp6(6),t.Q6J("fullscreen",!0),t.xp6(2),t.Q6J("ngForOf",i.magasins))},dependencies:[l.sg,a.Sm,a.W2,a.IJ,a.W4,a.Gu,a.gu,a.Ie,a.u8,a.IK,a.td,a.Q$,a.q_,a.fG,a.wd,a.sr]}),y})()}];let b=(()=>{var o;class y{}return(o=y).\u0275fac=function(n){return new(n||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({imports:[v.Bz.forChild(M),v.Bz]}),y})(),g=(()=>{var o;class y{}return(o=y).\u0275fac=function(n){return new(n||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({imports:[l.ez,d.u5,a.Pc,b]}),y})()},9825:(I,m,c)=>{c.d(m,{f:()=>l});var l=function(d){return d.POST="POST",d.PUT="PUT",d.DELETE="DELETE",d}(l||{})},5423:(I,m,c)=>{c.d(m,{V:()=>b});var l=c(5861),d=c(3009),a=c(9825),v=c(6689),p=c(2014),t=c(2386),x=c(9392),Z=c(3182),T=c(553);let M=(()=>{var g;class o{constructor(e){this.firestore=e}post(e,n,i){return(0,l.Z)(function*(){const s=(0,Z.ZF)(T.N.firebaseConfig),r=(0,x.ad)(s);yield(0,t.pl)((0,t.JU)(r,e,i),n)})()}getAll(e){var n=this;return(0,l.Z)(function*(){const i=yield(0,t.hJ)(n.firestore,e);return(0,t.BS)(i)})()}put(e,n,i){var s=this;return(0,l.Z)(function*(){const r=(0,t.JU)(s.firestore,e+"/"+n);return(0,t.r7)(r,i)})()}delete(e,n,i){var s=this;return(0,l.Z)(function*(){const r=(0,t.JU)(s.firestore,e+"/"+n);return(0,t.oe)(r)})()}}return(g=o).\u0275fac=function(e){return new(e||g)(v.LFG(t.gg))},g.\u0275prov=v.Yz7({token:g,factory:g.\u0275fac,providedIn:"root"}),o})(),b=(()=>{var g;class o{constructor(e,n){this.storage=e,this.firestore=n}postAll(e,n){var i=this;return(0,l.Z)(function*(){(yield i.getConnexionInfo()).isOnline&&(yield(yield n.filter(u=>!u.isFirebase)).map(function(){var u=(0,l.Z)(function*(f){f.isFirebase=!0,yield i.firestore.post(e,f,f.id.toString())});return function(f){return u.apply(this,arguments)}}())),yield i.storage.set(e,n)})()}post(e,n){var i=this;return(0,l.Z)(function*(){var s=yield i.getAll(e);n.id=Number(new Date),n.createdOn=new Date,n.modifiedOn=null,n.deletedOn=null,n.isFirebase=!1,s.push(n),yield i.postAll(e,s)})()}get(e){var n=this;return(0,l.Z)(function*(){return yield(yield n.storage.get(e)).filter(s=>""===s.deletedOn||null===s.deletedOn||void 0!==s.deletedOn)})()}getAll(e){var n=this;return(0,l.Z)(function*(){return yield n.storage.get(e)})()}getIndex(e,n){var i=this;return(0,l.Z)(function*(){return yield(yield i.getAll(e)).findIndex(r=>r.id===n)})()}put(e,n){var i=this;return(0,l.Z)(function*(){const s=yield i.getAll(e),r=yield i.getIndex(e,n.id);s[r]=n,s[r].modifiedOn=new Date,(yield i.getConnexionInfo()).isOnline?yield i.firestore.put(e,n.id.toString(),n):s[r].isFirebase&&(s[r].firebaseMethod=a.f.PUT),yield i.postAll(e,s)})()}delete(e,n){var i=this;return(0,l.Z)(function*(){const s=yield i.getAll(e),r=yield i.getIndex(e,n.id);s[r].deletedOn=new Date,s[r].firebaseMethod=a.f.DELETE,yield i.postAll(e,s),(yield i.getConnexionInfo()).isOnline&&(yield i.firestore.put(e,n.id.toString(),n))})()}deleteDefinitivement(e,n){var i=this;return(0,l.Z)(function*(){const s=yield i.getAll(e),r=yield i.getIndex(e,n.id);(yield i.getConnexionInfo()).isOnline?(s.splice(r,1),yield i.firestore.delete(e,n.id.toString(),n)):s[r].isFirebase?(s[r].firebaseMethod=a.f.DELETE,s[r].deletedOn=new Date):s.splice(r,1),yield i.postAll(e,s)})()}synchroniserAvecFirestore(){var e=this;return(0,l.Z)(function*(){(yield e.getConnexionInfo()).isOnline?(yield e.synchroniser(d.K.Utilisateurs),yield e.synchroniser(d.K.Articles),yield e.synchroniser(d.K.Courses),yield e.synchroniser(d.K.Familles),yield e.synchroniser(d.K.CourseDetails),yield e.synchroniser(d.K.Memos),yield e.synchroniser(d.K.HistoriquePrix),yield e.synchroniser(d.K.Depenses),yield e.synchroniser(d.K.Apports),yield e.synchroniser(d.K.Epargnes),yield e.synchroniser(d.K.Magasins),yield e.synchroniser(d.K.Plats),yield e.synchroniser(d.K.PlatDetails),yield e.synchroniser(d.K.Groupes),yield e.synchroniser(d.K.Menus)):alert("Le mode onLine est d\xe9sactiv\xe9")})()}synchroniser(e){var n=this;return(0,l.Z)(function*(){if((yield n.getConnexionInfo()).isOnline){const s=yield n.storage.get(e),r=yield s.filter(f=>!f.isFirebase);r.length>0&&r.map(function(){var f=(0,l.Z)(function*(h){h.isFirebase=!0,yield n.firestore.post(e,h,h.id.toString())});return function(h){return f.apply(this,arguments)}}());const u=yield s.filter(f=>f.firebaseMethod===a.f.DELETE||f.firebaseMethod===a.f.PUT);u.length>0&&u.map(function(){var f=(0,l.Z)(function*(h){h.firebaseMethod===a.f.PUT&&(yield n.put(e,h)),h.firebaseMethod===a.f.DELETE&&(yield n.deleteDefinitivement(e,h))});return function(h){return f.apply(this,arguments)}}()),(yield n.firestore.getAll(e)).subscribe(f=>{n.storage.set(e,f)})}else alert("Le mode onLine est d\xe9sactiv\xe9")})()}set(e,n){var i=this;return(0,l.Z)(function*(){yield i.storage.set(e,n)})()}getConnexionInfo(){var e=this;return(0,l.Z)(function*(){return yield e.storage.get(d.K.InfoConnexion)})()}}return(g=o).\u0275fac=function(e){return new(e||g)(v.LFG(p.K),v.LFG(M))},g.\u0275prov=v.Yz7({token:g,factory:g.\u0275fac,providedIn:"root"}),o})()}}]);