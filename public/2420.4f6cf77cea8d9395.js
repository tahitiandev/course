"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[2420],{9825:(Z,D,c)=>{c.d(D,{f:()=>n});var n=function(o){return o.POST="POST",o.PUT="PUT",o.DELETE="DELETE",o}(n||{})},6199:(Z,D,c)=>{c.d(D,{N:()=>O});var n=c(5861),o=c(3009),v=c(6689),_=c(5423);let O=(()=>{var f;class C{constructor(e){this.storage=e}getCourse(){var e=this;return(0,n.Z)(function*(){const r=yield e.storage.get(o.K.Courses);return e.sortByOrdreAsc(r)})()}sortByOrdreAsc(e){return e.sort((r,d)=>r.ordre>d.ordre?-1:1)}sortByOrdreDesc(e){return e.sort((r,d)=>r.ordre<d.ordre?-1:1)}postCourse(e){var r=this;return(0,n.Z)(function*(){yield r.storage.post(o.K.Courses,e)})()}putCourse(e){var r=this;return(0,n.Z)(function*(){yield r.storage.put(o.K.Courses,e)})()}deleteCourse(e){var r=this;return(0,n.Z)(function*(){yield r.storage.delete(o.K.Courses,e)})()}deleteCourseDefinitivement(e){var r=this;return(0,n.Z)(function*(){yield r.storage.deleteDefinitivement(o.K.Courses,e)})()}getCourseById(e){var r=this;return(0,n.Z)(function*(){return yield(yield r.getCourse()).find(i=>i.id==e)})()}getCourseDetails(e){var r=this;return(0,n.Z)(function*(){return(yield r.storage.get(o.K.CourseDetails)).filter(i=>i.courseId===e&&void 0!==i.deletedOn)})()}generateOrdreCourse(){var e=this;return(0,n.Z)(function*(){const r=yield e.getCourse(),d=yield e.sortByOrdreDesc(r).pop();return Number(null==d?void 0:d.ordre)+1})()}setAllCoursesIsFocusFalse(){var e=this;return(0,n.Z)(function*(){yield(yield e.getCourse()).map(function(){var d=(0,n.Z)(function*(i){i.isFocus=!1,yield e.putCourse(i)});return function(i){return d.apply(this,arguments)}}())})()}getCourseIsFocus(){var e=this;return(0,n.Z)(function*(){const r=yield e.getCourse(),d=yield r.filter(i=>i.isFocus);return d.length>0?d:(yield e.postCourse({id:0,ordre:yield e.generateOrdreCourse(),magasinId:0,montantTheorique:0,montantReel:0,ecart:0,date:new Date,actif:!0,isFirebase:!1,isFocus:!0}),yield r.filter(i=>i.isFocus))})()}sortByOrdre(e){return e.sort((r,d)=>r.ordre<d.ordre?-1:1)}postCourseDetails(e){var r=this;return(0,n.Z)(function*(){var d=yield r.getCourseDetails(e.courseId),i=r.sortByOrdre(d);i.length>0&&(e.ordre=i[i.length-1].ordre+1),yield r.storage.post(o.K.CourseDetails,e)})()}putCourseDetails(e){var r=this;return(0,n.Z)(function*(){yield r.storage.put(o.K.CourseDetails,e)})()}deleteCourseDetails(e){var r=this;return(0,n.Z)(function*(){yield r.storage.delete(o.K.CourseDetails,e)})()}deleteDefinitivementCourseDetails(e){var r=this;return(0,n.Z)(function*(){yield r.storage.deleteDefinitivement(o.K.CourseDetails,e)})()}}return(f=C).\u0275fac=function(e){return new(e||f)(v.LFG(_.V))},f.\u0275prov=v.Yz7({token:f,factory:f.\u0275fac,providedIn:"root"}),C})()},4956:(Z,D,c)=>{c.d(D,{r:()=>O});var n=c(5861),o=c(3009),v=c(6689),_=c(5423);let O=(()=>{var f;class C{constructor(e){this.storage=e}get(){var e=this;return(0,n.Z)(function*(){return yield e.storage.get(o.K.Plats)})()}post(e){var r=this;return(0,n.Z)(function*(){yield r.storage.post(o.K.Plats,e)})()}put(e){var r=this;return(0,n.Z)(function*(){yield r.storage.put(o.K.Plats,e)})()}delete(e){var r=this;return(0,n.Z)(function*(){yield r.storage.delete(o.K.Plats,e)})()}deleteDefinitivement(e){var r=this;return(0,n.Z)(function*(){yield r.storage.deleteDefinitivement(o.K.Plats,e);var d=yield r.getPlatDetails(e.id);yield d.map(function(){var i=(0,n.Z)(function*(y){yield r.deleteDefinitivementPlatDetail(y)});return function(y){return i.apply(this,arguments)}}())})()}getPlatById(e){var r=this;return(0,n.Z)(function*(){return yield(yield r.get()).find(i=>i.id===e)})()}sortByOrdre(e){return e.sort((r,d)=>r.ordre<d.ordre?-1:1)}getPlatDetails(e){var r=this;return(0,n.Z)(function*(){return yield(yield r.storage.get(o.K.PlatDetails)).filter(i=>i.platId===e)})()}postPlatDetail(e){var r=this;return(0,n.Z)(function*(){var d=yield r.getPlatDetails(e.platId),i=r.sortByOrdre(d);i.length>0&&(e.ordre=i[i.length-1].ordre+1),yield r.storage.post(o.K.PlatDetails,e)})()}putPlatDetail(e){var r=this;return(0,n.Z)(function*(){yield r.storage.put(o.K.PlatDetails,e)})()}deletePlatDetail(e){var r=this;return(0,n.Z)(function*(){yield r.storage.delete(o.K.PlatDetails,e)})()}deleteDefinitivementPlatDetail(e){var r=this;return(0,n.Z)(function*(){yield r.storage.deleteDefinitivement(o.K.PlatDetails,e)})()}}return(f=C).\u0275fac=function(e){return new(e||f)(v.LFG(_.V))},f.\u0275prov=v.Yz7({token:f,factory:f.\u0275fac,providedIn:"root"}),C})()},5423:(Z,D,c)=>{c.d(D,{V:()=>d});var n=c(5861),o=c(3009),v=c(9825),_=c(6689),O=c(2014),f=c(2386),C=c(9392),P=c(3182),e=c(553);let r=(()=>{var i;class y{constructor(t){this.firestore=t}post(t,s,l){return(0,n.Z)(function*(){const u=(0,P.ZF)(e.N.firebaseConfig),a=(0,C.ad)(u);yield(0,f.pl)((0,f.JU)(a,t,l),s)})()}getAll(t){var s=this;return(0,n.Z)(function*(){const l=yield(0,f.hJ)(s.firestore,t);return(0,f.BS)(l)})()}put(t,s,l){var u=this;return(0,n.Z)(function*(){const a=(0,f.JU)(u.firestore,t+"/"+s);return(0,f.r7)(a,l)})()}delete(t,s,l){var u=this;return(0,n.Z)(function*(){const a=(0,f.JU)(u.firestore,t+"/"+s);return(0,f.oe)(a)})()}}return(i=y).\u0275fac=function(t){return new(t||i)(_.LFG(f.gg))},i.\u0275prov=_.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),y})(),d=(()=>{var i;class y{constructor(t,s){this.storage=t,this.firestore=s}postAll(t,s){var l=this;return(0,n.Z)(function*(){(yield l.getConnexionInfo()).isOnline&&(yield(yield s.filter(p=>!p.isFirebase)).map(function(){var p=(0,n.Z)(function*(h){h.isFirebase=!0,yield l.firestore.post(t,h,h.id.toString())});return function(h){return p.apply(this,arguments)}}())),yield l.storage.set(t,s)})()}parseDate(t){const l=new Date(t).getTime();return{nanoseconds:l%1e3*1e6,seconds:Math.floor(l/1e3)}}post(t,s){var l=this;return(0,n.Z)(function*(){var u=yield l.getAll(t);s.id=Number(new Date),s.createdOn=l.parseDate(new Date),s.modifiedOn=null,s.deletedOn=null,s.isFirebase=!1,u.push(s),yield l.postAll(t,u)})()}get(t){var s=this;return(0,n.Z)(function*(){return yield(yield s.storage.get(t)).filter(u=>""===u.deletedOn||null===u.deletedOn||void 0!==u.deletedOn)})()}getAll(t){var s=this;return(0,n.Z)(function*(){return yield s.storage.get(t)})()}getIndex(t,s){var l=this;return(0,n.Z)(function*(){return yield(yield l.getAll(t)).findIndex(a=>a.id===s)})()}put(t,s){var l=this;return(0,n.Z)(function*(){const u=yield l.getAll(t),a=yield l.getIndex(t,s.id);u[a]=s,u[a].modifiedOn=new Date,(yield l.getConnexionInfo()).isOnline?yield l.firestore.put(t,s.id.toString(),s):u[a].isFirebase&&(u[a].firebaseMethod=v.f.PUT),yield l.postAll(t,u)})()}delete(t,s){var l=this;return(0,n.Z)(function*(){const u=yield l.getAll(t),a=yield l.getIndex(t,s.id);u[a].deletedOn=new Date,u[a].firebaseMethod=v.f.DELETE,yield l.postAll(t,u),(yield l.getConnexionInfo()).isOnline&&(yield l.firestore.put(t,s.id.toString(),s))})()}deleteDefinitivement(t,s){var l=this;return(0,n.Z)(function*(){const u=yield l.getAll(t),a=yield l.getIndex(t,s.id);(yield l.getConnexionInfo()).isOnline?(u.splice(a,1),yield l.firestore.delete(t,s.id.toString(),s)):u[a].isFirebase?(u[a].firebaseMethod=v.f.DELETE,u[a].deletedOn=new Date):u.splice(a,1),yield l.postAll(t,u)})()}synchroniserAvecFirestore(){var t=this;return(0,n.Z)(function*(){(yield t.getConnexionInfo()).isOnline?(yield t.synchroniser(o.K.Utilisateurs),yield t.synchroniser(o.K.Articles),yield t.synchroniser(o.K.Courses),yield t.synchroniser(o.K.Familles),yield t.synchroniser(o.K.CourseDetails),yield t.synchroniser(o.K.Memos),yield t.synchroniser(o.K.HistoriquePrix),yield t.synchroniser(o.K.Depenses),yield t.synchroniser(o.K.Apports),yield t.synchroniser(o.K.Epargnes),yield t.synchroniser(o.K.Magasins),yield t.synchroniser(o.K.Plats),yield t.synchroniser(o.K.PlatDetails),yield t.synchroniser(o.K.Groupes),yield t.synchroniser(o.K.Menus),yield t.synchroniser(o.K.Budget)):alert("Le mode onLine est d\xe9sactiv\xe9")})()}synchroniser(t){var s=this;return(0,n.Z)(function*(){if((yield s.getConnexionInfo()).isOnline){const u=yield s.storage.get(t),a=yield u.filter(h=>!h.isFirebase);a.length>0&&a.map(function(){var h=(0,n.Z)(function*(g){g.isFirebase=!0,yield s.firestore.post(t,g,g.id.toString())});return function(g){return h.apply(this,arguments)}}());const p=yield u.filter(h=>h.firebaseMethod===v.f.DELETE||h.firebaseMethod===v.f.PUT);p.length>0&&p.map(function(){var h=(0,n.Z)(function*(g){g.firebaseMethod===v.f.PUT&&(yield s.put(t,g)),g.firebaseMethod===v.f.DELETE&&(yield s.deleteDefinitivement(t,g))});return function(g){return h.apply(this,arguments)}}()),(yield s.firestore.getAll(t)).subscribe(h=>{s.storage.set(t,h)})}else alert("Le mode onLine est d\xe9sactiv\xe9")})()}set(t,s){var l=this;return(0,n.Z)(function*(){yield l.storage.set(t,s)})()}getConnexionInfo(){var t=this;return(0,n.Z)(function*(){return yield t.storage.get(o.K.InfoConnexion)})()}}return(i=y).\u0275fac=function(t){return new(t||i)(_.LFG(O.K),_.LFG(r))},i.\u0275prov=_.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),y})()}}]);