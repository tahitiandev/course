"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[8622],{8622:(b,O,p)=>{p.r(O),p.d(O,{MemoPageModule:()=>v});var s=p(6814),a=p(95),c=p(7027),M=p(9801),Z=p(5861),e=p(6689),A=p(3629),D=p(6199),o=p(5512);let n=(()=>{var i;class m{transform(r,d){return r.filter(y=>y.libelle.toLowerCase().startsWith(d.toLowerCase()))}}return(i=m).\u0275fac=function(r){return new(r||i)},i.\u0275pipe=e.Yjl({name:"articleFiltreMemo",type:i,pure:!0}),m})();function _(i,m){if(1&i){const h=e.EpF();e.TgZ(0,"ion-item-sliding")(1,"ion-item")(2,"ion-label"),e._uU(3),e.qZA()(),e.TgZ(4,"ion-item-options",4)(5,"ion-item-option",5),e.NdJ("click",function(){const x=e.CHM(h).$implicit,y=e.oxw();return e.KtG(y.selectArticle(x))}),e._uU(6,"Selectionner"),e.qZA()()()}if(2&i){const h=m.$implicit;e.xp6(3),e.AsE("",h.libelle," - ",h.prix[0].prix," xpf")}}let f=(()=>{var i;class m{constructor(r){this.articleService=r,this.searchValue="",this.articles=[],this.articlesOutput=new e.vpe}ngOnInit(){this.onInit()}onInit(){var r=this;return(0,Z.Z)(function*(){const d=yield r.getArticles();r.articles=d})()}getArticles(){var r=this;return(0,Z.Z)(function*(){return yield r.articleService.get()})()}selectArticle(r){this.articlesOutput.emit(r)}}return(i=m).\u0275fac=function(r){return new(r||i)(e.Y36(o.J))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-search-article-memo"]],outputs:{articlesOutput:"articlesOutput"},decls:10,vars:5,consts:[[2,"width","80%","margin","auto","margin-top","20px"],[3,"ngModel","ngModelChange"],[2,"margin","5%","width","100%","height","460px","overflow","scroll"],[4,"ngFor","ngForOf"],["side","end"],[3,"click"]],template:function(r,d){1&r&&(e.TgZ(0,"ion-card",0)(1,"ion-card-header")(2,"ion-card-subtitle"),e._uU(3,"Rechercher d'article"),e.qZA()(),e.TgZ(4,"ion-card-content")(5,"ion-toolbar")(6,"ion-searchbar",1),e.NdJ("ngModelChange",function(y){return d.searchValue=y}),e.qZA()(),e.TgZ(7,"ion-list",2),e.YNc(8,_,7,2,"ion-item-sliding",3),e.ALo(9,"articleFiltreMemo"),e.qZA()()()),2&r&&(e.xp6(6),e.Q6J("ngModel",d.searchValue),e.xp6(2),e.Q6J("ngForOf",e.xi3(9,2,d.articles,d.searchValue)))},dependencies:[s.sg,a.JJ,a.On,c.PM,c.FN,c.Zi,c.tO,c.Ie,c.u8,c.IK,c.td,c.Q$,c.q_,c.VI,c.sr,c.j9,n]}),m})();function C(i,m){if(1&i){const h=e.EpF();e.TgZ(0,"ion-content")(1,"app-search-article-memo",4),e.NdJ("articlesOutput",function(d){e.CHM(h);const x=e.oxw();return e.KtG(x.selectArticle(d))}),e.qZA()()}}function T(i,m){if(1&i){const h=e.EpF();e.TgZ(0,"ion-item-sliding")(1,"ion-item",11),e.NdJ("click",function(){const x=e.CHM(h).$implicit,y=e.oxw(2);return e.KtG(y.put(x))}),e.TgZ(2,"ion-label"),e._uU(3),e.qZA(),e.TgZ(4,"ion-label",12),e._uU(5),e.qZA()(),e.TgZ(6,"ion-item-options",13)(7,"ion-item-option",14),e.NdJ("click",function(){const x=e.CHM(h).$implicit,y=e.oxw(2);return e.KtG(y.sendToCourse(x))}),e._uU(8," Envoyer "),e.qZA(),e.TgZ(9,"ion-item-option",14),e.NdJ("click",function(){const x=e.CHM(h).$implicit,y=e.oxw(2);return e.KtG(y.retirer(x))}),e._uU(10," Retirer "),e.qZA()()()}if(2&i){const h=m.$implicit;e.xp6(3),e.Oqu(h.article.libelle),e.xp6(2),e.hij("Qte : ",h.quantite,"")}}function t(i,m){if(1&i){const h=e.EpF();e.TgZ(0,"ion-content")(1,"ion-list",5),e.YNc(2,T,11,2,"ion-item-sliding",6),e.qZA(),e.TgZ(3,"ion-fab",7)(4,"ion-fab-button",8),e.NdJ("click",function(){e.CHM(h);const d=e.oxw();return e.KtG(d.postManuel())}),e._UZ(5,"ion-icon",9),e.qZA(),e.TgZ(6,"ion-fab-button",8),e.NdJ("click",function(){e.CHM(h);const d=e.oxw();return e.KtG(d.postMemo())}),e._UZ(7,"ion-icon",10),e.qZA()()()}if(2&i){const h=e.oxw();e.xp6(1),e.Q6J("inset",!0),e.xp6(1),e.Q6J("ngForOf",h.memos)}}const u=[{path:"",component:(()=>{var i;class m{constructor(r,d,x,y){this.memoService=r,this.courseservice=d,this.alertController=x,this.articleService=y,this.memos=[],this.isRechercheAvance=!1}ngOnInit(){var r=this;return(0,Z.Z)(function*(){yield r.refresh()})()}refresh(){var r=this;return(0,Z.Z)(function*(){const d=yield(yield r.memoService.get()).filter(x=>null==x.deletedOn);r.memos=d})()}put(r){var d=this;return(0,Z.Z)(function*(){var y;yield(yield d.alertController.create({cssClass:"my-custom-class",header:"Nouvelle article",inputs:[{type:"text",placeholder:r.article.libelle,disabled:!0},{type:"number",name:"quantite",placeholder:r.quantite.toString(),value:r.quantite}],buttons:[{text:"Annuler",role:"cancel",cssClass:"secondary",handler:()=>{}},{text:"Valider",handler:(y=(0,Z.Z)(function*(I){r.quantite=null==I.quantite||""===I.quantite?1:Number(I.quantite),yield d.memoService.put(r),yield d.refresh()}),function(F){return y.apply(this,arguments)})}]})).present()})()}selectArticle(r){var d=this;return(0,Z.Z)(function*(){var x={id:Number(new Date),article:r,quantite:1,isFirebase:!1};yield d.memoService.post(x),yield d.refresh(),d.postMemo()})()}postMemo(){this.isRechercheAvance=!this.isRechercheAvance}retirer(r){var d=this;return(0,Z.Z)(function*(){yield d.memoService.delete(r),yield d.refresh()})()}postManuel(){var r=this;return(0,Z.Z)(function*(){var x;yield(yield r.alertController.create({cssClass:"my-custom-class",header:"Nouvelle article",inputs:[{type:"text",placeholder:"Nom de l'article",name:"libelle"},{type:"number",name:"quantite",placeholder:"Quantit\xe9"}],buttons:[{text:"Annuler",role:"cancel",cssClass:"secondary",handler:()=>{}},{text:"Valider",handler:(x=(0,Z.Z)(function*(y){var I=null==y.quantite||""===y.quantite?1:Number(y.quantite),F={id:Number(new Date),libelle:y.libelle,prix:[{magasin:1,prix:100}],createdOn:new Date,groupeId:[0],familleId:0,codeBarre:"",isFirebase:!1},P={id:Number(new Date),article:F,quantite:I,isFirebase:!1};yield r.articleService.post(F),yield r.memoService.post(P),yield r.refresh()}),function(I){return x.apply(this,arguments)})}]})).present()})()}sendToCourse(r){var d=this;return(0,Z.Z)(function*(){const x=yield d.courseservice.getCourseIsFocus(),y=r.article.prix.find(F=>F.magasin===x[0].magasinId),I={id:Number(new Date),ordre:0,courseId:x[0].id.toString(),libelle:r.article.libelle,quantite:r.quantite,articleId:r.article.id,prixArticle:void 0===y?r.article.prix[0].prix:y.prix,prixReel:void 0===y?r.article.prix[0].prix:y.prix,total:Number(r.quantite*(void 0===y?r.article.prix[0].prix:y.prix)),checked:!1,isFirebase:!1};yield d.courseservice.postCourseDetails(I),yield d.memoService.delete(r),d.refresh()})()}}return(i=m).\u0275fac=function(r){return new(r||i)(e.Y36(A.T),e.Y36(D.N),e.Y36(c.Br),e.Y36(o.J))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-memo"]],decls:8,vars:3,consts:[[3,"translucent"],["slot","start"],["defaultHref","/courses"],[4,"ngIf"],[3,"articlesOutput"],[3,"inset"],[4,"ngFor","ngForOf"],["slot","fixed","horizontal","end","vertical","bottom"],["size","small",3,"click"],["name","calculator-outline"],["name","add"],["button","",3,"click"],["slot","end"],["side","end"],[3,"click"]],template:function(r,d){1&r&&(e.TgZ(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-buttons",1),e._UZ(3,"ion-back-button",2),e.qZA(),e.TgZ(4,"ion-title"),e._uU(5,"Notes"),e.qZA()()(),e.YNc(6,C,2,0,"ion-content",3),e.YNc(7,t,8,2,"ion-content",3)),2&r&&(e.Q6J("translucent",!0),e.xp6(6),e.Q6J("ngIf",d.isRechercheAvance),e.xp6(1),e.Q6J("ngIf",!d.isRechercheAvance))},dependencies:[s.sg,s.O5,c.oU,c.Sm,c.W2,c.IJ,c.W4,c.Gu,c.gu,c.Ie,c.u8,c.IK,c.td,c.Q$,c.q_,c.wd,c.sr,c.cs,f]}),m})()}];let g=(()=>{var i;class m{}return(i=m).\u0275fac=function(r){return new(r||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[M.Bz.forChild(u),M.Bz]}),m})(),v=(()=>{var i;class m{}return(i=m).\u0275fac=function(r){return new(r||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[s.ez,a.u5,c.Pc,g]}),m})()},9825:(b,O,p)=>{p.d(O,{f:()=>s});var s=function(a){return a.POST="POST",a.PUT="PUT",a.DELETE="DELETE",a}(s||{})},5512:(b,O,p)=>{p.d(O,{J:()=>e});var s=p(5861),a=p(3009),c=p(6689),M=p(5423),Z=p(6815);let e=(()=>{var A;class D{constructor(n,_){this.storage=n,this.utility=_}get(){var n=this;return(0,s.Z)(function*(){return n.orderByFamille(yield n.storage.get(a.K.Articles))})()}post(n){var _=this;return(0,s.Z)(function*(){yield _.storage.post(a.K.Articles,n)})()}put(n){var _=this;return(0,s.Z)(function*(){yield _.storage.put(a.K.Articles,n)})()}delete(n){var _=this;return(0,s.Z)(function*(){yield _.storage.delete(a.K.Articles,n)})()}deleteDefinitivement(n){var _=this;return(0,s.Z)(function*(){yield _.storage.deleteDefinitivement(a.K.Articles,n)})()}getArticleById(n){var _=this;return(0,s.Z)(function*(){return(yield _.get()).filter(C=>C.id==n)})()}getArticleByCodeBarre(n){var _=this;return(0,s.Z)(function*(){return(yield _.get()).filter(C=>C.codeBarre==n)})()}orderByFamille(n){return n.sort((_,f)=>_.familleId<f.familleId?-1:1)}}return(A=D).\u0275fac=function(n){return new(n||A)(c.LFG(M.V),c.LFG(Z.t))},A.\u0275prov=c.Yz7({token:A,factory:A.\u0275fac,providedIn:"root"}),D})()},6199:(b,O,p)=>{p.d(O,{N:()=>Z});var s=p(5861),a=p(3009),c=p(6689),M=p(5423);let Z=(()=>{var e;class A{constructor(o){this.storage=o}getCourse(){var o=this;return(0,s.Z)(function*(){const n=yield o.storage.get(a.K.Courses);return o.sortByOrdreAsc(n)})()}sortByOrdreAsc(o){return o.sort((n,_)=>n.ordre>_.ordre?-1:1)}sortByOrdreDesc(o){return o.sort((n,_)=>n.ordre<_.ordre?-1:1)}postCourse(o){var n=this;return(0,s.Z)(function*(){yield n.storage.post(a.K.Courses,o)})()}putCourse(o){var n=this;return(0,s.Z)(function*(){yield n.storage.put(a.K.Courses,o)})()}deleteCourse(o){var n=this;return(0,s.Z)(function*(){yield n.storage.delete(a.K.Courses,o)})()}deleteCourseDefinitivement(o){var n=this;return(0,s.Z)(function*(){yield n.storage.deleteDefinitivement(a.K.Courses,o)})()}getCourseById(o){var n=this;return(0,s.Z)(function*(){return yield(yield n.getCourse()).find(f=>f.id==o)})()}getCourseDetails(o){var n=this;return(0,s.Z)(function*(){return(yield n.storage.get(a.K.CourseDetails)).filter(f=>f.courseId===o&&void 0!==f.deletedOn)})()}generateOrdreCourse(){var o=this;return(0,s.Z)(function*(){const n=yield o.getCourse(),_=yield o.sortByOrdreDesc(n).pop();return Number(null==_?void 0:_.ordre)+1})()}setAllCoursesIsFocusFalse(){var o=this;return(0,s.Z)(function*(){yield(yield o.getCourse()).map(function(){var _=(0,s.Z)(function*(f){f.isFocus=!1,yield o.putCourse(f)});return function(f){return _.apply(this,arguments)}}())})()}getCourseIsFocus(){var o=this;return(0,s.Z)(function*(){const n=yield o.getCourse(),_=yield n.filter(f=>f.isFocus);return _.length>0?_:(yield o.postCourse({id:0,ordre:yield o.generateOrdreCourse(),magasinId:0,montantTheorique:0,montantReel:0,ecart:0,date:new Date,actif:!0,isFirebase:!1,isFocus:!0}),yield n.filter(f=>f.isFocus))})()}sortByOrdre(o){return o.sort((n,_)=>n.ordre<_.ordre?-1:1)}postCourseDetails(o){var n=this;return(0,s.Z)(function*(){var _=yield n.getCourseDetails(o.courseId),f=n.sortByOrdre(_);f.length>0&&(o.ordre=f[f.length-1].ordre+1),yield n.storage.post(a.K.CourseDetails,o)})()}putCourseDetails(o){var n=this;return(0,s.Z)(function*(){yield n.storage.put(a.K.CourseDetails,o)})()}deleteCourseDetails(o){var n=this;return(0,s.Z)(function*(){yield n.storage.delete(a.K.CourseDetails,o)})()}deleteDefinitivementCourseDetails(o){var n=this;return(0,s.Z)(function*(){yield n.storage.deleteDefinitivement(a.K.CourseDetails,o)})()}}return(e=A).\u0275fac=function(o){return new(o||e)(c.LFG(M.V))},e.\u0275prov=c.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),A})()},5423:(b,O,p)=>{p.d(O,{V:()=>_});var s=p(5861),a=p(3009),c=p(9825),M=p(6689),Z=p(2014),e=p(2386),A=p(9392),D=p(3182),o=p(553);let n=(()=>{var f;class C{constructor(t){this.firestore=t}post(t,l,u){return(0,s.Z)(function*(){const g=(0,D.ZF)(o.N.firebaseConfig),v=(0,A.ad)(g);yield(0,e.pl)((0,e.JU)(v,t,u),l)})()}getAll(t){var l=this;return(0,s.Z)(function*(){const u=yield(0,e.hJ)(l.firestore,t);return(0,e.BS)(u)})()}put(t,l,u){var g=this;return(0,s.Z)(function*(){const v=(0,e.JU)(g.firestore,t+"/"+l);return(0,e.r7)(v,u)})()}delete(t,l,u){var g=this;return(0,s.Z)(function*(){const v=(0,e.JU)(g.firestore,t+"/"+l);return(0,e.oe)(v)})()}}return(f=C).\u0275fac=function(t){return new(t||f)(M.LFG(e.gg))},f.\u0275prov=M.Yz7({token:f,factory:f.\u0275fac,providedIn:"root"}),C})(),_=(()=>{var f;class C{constructor(t,l){this.storage=t,this.firestore=l}postAll(t,l){var u=this;return(0,s.Z)(function*(){(yield u.getConnexionInfo()).isOnline&&(yield(yield l.filter(i=>!i.isFirebase)).map(function(){var i=(0,s.Z)(function*(m){m.isFirebase=!0,yield u.firestore.post(t,m,m.id.toString())});return function(m){return i.apply(this,arguments)}}())),yield u.storage.set(t,l)})()}parseDate(t){const u=new Date(t).getTime();return{nanoseconds:u%1e3*1e6,seconds:Math.floor(u/1e3)}}post(t,l){var u=this;return(0,s.Z)(function*(){var g=yield u.getAll(t);l.id=Number(new Date),l.createdOn=u.parseDate(new Date),l.modifiedOn=null,l.deletedOn=null,l.isFirebase=!1,g.push(l),yield u.postAll(t,g)})()}get(t){var l=this;return(0,s.Z)(function*(){return yield(yield l.storage.get(t)).filter(g=>""===g.deletedOn||null===g.deletedOn||void 0!==g.deletedOn)})()}getAll(t){var l=this;return(0,s.Z)(function*(){return yield l.storage.get(t)})()}getIndex(t,l){var u=this;return(0,s.Z)(function*(){return yield(yield u.getAll(t)).findIndex(v=>v.id===l)})()}put(t,l){var u=this;return(0,s.Z)(function*(){const g=yield u.getAll(t),v=yield u.getIndex(t,l.id);g[v]=l,g[v].modifiedOn=new Date,(yield u.getConnexionInfo()).isOnline?yield u.firestore.put(t,l.id.toString(),l):g[v].isFirebase&&(g[v].firebaseMethod=c.f.PUT),yield u.postAll(t,g)})()}delete(t,l){var u=this;return(0,s.Z)(function*(){const g=yield u.getAll(t),v=yield u.getIndex(t,l.id);g[v].deletedOn=new Date,g[v].firebaseMethod=c.f.DELETE,yield u.postAll(t,g),(yield u.getConnexionInfo()).isOnline&&(yield u.firestore.put(t,l.id.toString(),l))})()}deleteDefinitivement(t,l){var u=this;return(0,s.Z)(function*(){const g=yield u.getAll(t),v=yield u.getIndex(t,l.id);(yield u.getConnexionInfo()).isOnline?(g.splice(v,1),yield u.firestore.delete(t,l.id.toString(),l)):g[v].isFirebase?(g[v].firebaseMethod=c.f.DELETE,g[v].deletedOn=new Date):g.splice(v,1),yield u.postAll(t,g)})()}synchroniserAvecFirestore(){var t=this;return(0,s.Z)(function*(){(yield t.getConnexionInfo()).isOnline?(yield t.synchroniser(a.K.Utilisateurs),yield t.synchroniser(a.K.Articles),yield t.synchroniser(a.K.Courses),yield t.synchroniser(a.K.Familles),yield t.synchroniser(a.K.CourseDetails),yield t.synchroniser(a.K.Memos),yield t.synchroniser(a.K.HistoriquePrix),yield t.synchroniser(a.K.Depenses),yield t.synchroniser(a.K.Apports),yield t.synchroniser(a.K.Epargnes),yield t.synchroniser(a.K.Magasins),yield t.synchroniser(a.K.Plats),yield t.synchroniser(a.K.PlatDetails),yield t.synchroniser(a.K.Groupes),yield t.synchroniser(a.K.Menus),yield t.synchroniser(a.K.Budget)):alert("Le mode onLine est d\xe9sactiv\xe9")})()}synchroniser(t){var l=this;return(0,s.Z)(function*(){if((yield l.getConnexionInfo()).isOnline){const g=yield l.storage.get(t),v=yield g.filter(m=>!m.isFirebase);v.length>0&&v.map(function(){var m=(0,s.Z)(function*(h){h.isFirebase=!0,yield l.firestore.post(t,h,h.id.toString())});return function(h){return m.apply(this,arguments)}}());const i=yield g.filter(m=>m.firebaseMethod===c.f.DELETE||m.firebaseMethod===c.f.PUT);i.length>0&&i.map(function(){var m=(0,s.Z)(function*(h){h.firebaseMethod===c.f.PUT&&(yield l.put(t,h)),h.firebaseMethod===c.f.DELETE&&(yield l.deleteDefinitivement(t,h))});return function(h){return m.apply(this,arguments)}}()),(yield l.firestore.getAll(t)).subscribe(m=>{l.storage.set(t,m)})}else alert("Le mode onLine est d\xe9sactiv\xe9")})()}set(t,l){var u=this;return(0,s.Z)(function*(){yield u.storage.set(t,l)})()}getConnexionInfo(){var t=this;return(0,s.Z)(function*(){return yield t.storage.get(a.K.InfoConnexion)})()}}return(f=C).\u0275fac=function(t){return new(t||f)(M.LFG(Z.K),M.LFG(n))},f.\u0275prov=M.Yz7({token:f,factory:f.\u0275fac,providedIn:"root"}),C})()}}]);