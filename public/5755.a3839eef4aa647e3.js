"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[5755],{5755:(X,A,f)=>{f.r(A),f.d(A,{CourseDetailsPageModule:()=>$});var g=f(6814),y=f(95),d=f(7027),C=f(9801),a=f(5861),e=f(6689),Z=f(6199),v=f(5512),I=f(6815),T=f(1934),q=f(4985),D=f(3629);let N=(()=>{var n;class _{transform(t,i){return t.filter(o=>o.libelle.toLowerCase().startsWith(i.toLowerCase()))}}return(n=_).\u0275fac=function(t){return new(t||n)},n.\u0275pipe=e.Yjl({name:"articleFiltre",type:n,pure:!0}),_})();function S(n,_){if(1&n){const r=e.EpF();e.TgZ(0,"ion-item-sliding")(1,"ion-item")(2,"ion-label"),e._uU(3),e.qZA()(),e.TgZ(4,"ion-item-options",4)(5,"ion-item-option",5),e.NdJ("click",function(){const s=e.CHM(r).$implicit,o=e.oxw();return e.KtG(o.selectArticle(s))}),e._uU(6,"Selectionner"),e.qZA()()()}if(2&n){const r=_.$implicit;e.xp6(3),e.AsE("",r.libelle," - ",r.prix[0].prix," xpf")}}let P=(()=>{var n;class _{constructor(t){this.articleService=t,this.searchValue="",this.articles=[],this.articlesOutput=new e.vpe}ngOnInit(){this.onInit()}onInit(){var t=this;return(0,a.Z)(function*(){const i=yield t.getArticles();t.articles=i})()}getArticles(){var t=this;return(0,a.Z)(function*(){return yield t.articleService.get()})()}selectArticle(t){this.articlesOutput.emit(t)}}return(n=_).\u0275fac=function(t){return new(t||n)(e.Y36(v.J))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-search-article"]],outputs:{articlesOutput:"articlesOutput"},decls:10,vars:5,consts:[[2,"width","80%","margin","auto","margin-top","20px"],[3,"ngModel","ngModelChange"],[2,"margin","5%","width","100%","height","460px","overflow","scroll"],[4,"ngFor","ngForOf"],["side","end"],[3,"click"]],template:function(t,i){1&t&&(e.TgZ(0,"ion-card",0)(1,"ion-card-header")(2,"ion-card-subtitle"),e._uU(3,"Rechercher d'article"),e.qZA()(),e.TgZ(4,"ion-card-content")(5,"ion-toolbar")(6,"ion-searchbar",1),e.NdJ("ngModelChange",function(o){return i.searchValue=o}),e.qZA()(),e.TgZ(7,"ion-list",2),e.YNc(8,S,7,2,"ion-item-sliding",3),e.ALo(9,"articleFiltre"),e.qZA()()()),2&t&&(e.xp6(6),e.Q6J("ngModel",i.searchValue),e.xp6(2),e.Q6J("ngForOf",e.xi3(9,2,i.articles,i.searchValue)))},dependencies:[g.sg,y.JJ,y.On,d.PM,d.FN,d.Zi,d.tO,d.Ie,d.u8,d.IK,d.td,d.Q$,d.q_,d.VI,d.sr,d.j9,N]}),_})();function k(n,_){if(1&n){const r=e.EpF();e.TgZ(0,"ion-icon",6),e.NdJ("click",function(){e.CHM(r);const i=e.oxw();return e.KtG(i.setIsButtonActif())}),e.qZA()}}function w(n,_){if(1&n){const r=e.EpF();e.TgZ(0,"ion-content")(1,"app-search-article",7),e.NdJ("articlesOutput",function(i){e.CHM(r);const s=e.oxw();return e.KtG(s.selectArticle(i))}),e.qZA()()}}function J(n,_){1&n&&e._UZ(0,"ion-icon",22)}function F(n,_){if(1&n){const r=e.EpF();e.TgZ(0,"ion-item-option",23),e.NdJ("click",function(){e.CHM(r);const i=e.oxw().$implicit,s=e.oxw(3);return e.KtG(s.associerUnCodeBarreAArticleSansTitre(i))}),e._uU(1," BarreCode "),e.qZA()}}function M(n,_){1&n&&e._UZ(0,"ion-icon",22)}const m=function(n){return{color:n}};function R(n,_){if(1&n){const r=e.EpF();e.TgZ(0,"ion-item-sliding")(1,"ion-item",14),e.NdJ("click",function(){const s=e.CHM(r).$implicit,o=e.oxw(3);return e.KtG(o.put(s))}),e.TgZ(2,"ion-label",15),e._uU(3),e.qZA(),e.TgZ(4,"ion-label",15),e._uU(5),e.qZA(),e.TgZ(6,"ion-label",15),e._uU(7),e.qZA(),e.YNc(8,J,1,0,"ion-icon",16),e.qZA(),e.TgZ(9,"ion-item-options",17),e.YNc(10,F,2,0,"ion-item-option",18),e.TgZ(11,"ion-item-option",19),e.NdJ("click",function(){const s=e.CHM(r).$implicit,o=e.oxw(3);return e.KtG(o.delete(s))}),e._uU(12," Supprimer "),e.qZA()(),e.TgZ(13,"ion-item-options",20)(14,"ion-item-option",21),e.NdJ("click",function(){const s=e.CHM(r).$implicit,o=e.oxw(3);return e.KtG(o.check(s))}),e._uU(15," Check "),e.YNc(16,M,1,0,"ion-icon",16),e.qZA()()()}if(2&n){const r=_.$implicit;e.xp6(1),e.Q6J("disabled",r.checked||"DELETE"===r.firebaseMethod),e.xp6(1),e.Q6J("ngStyle",e.VKq(10,m,r.checked?"brown":"white")),e.xp6(1),e.Oqu(r.libelle),e.xp6(1),e.Q6J("ngStyle",e.VKq(12,m,r.checked?"brown":"white")),e.xp6(1),e.hij("x ",r.quantite,""),e.xp6(1),e.Q6J("ngStyle",e.VKq(14,m,r.checked?"brown":"white")),e.xp6(1),e.hij("",r.total," xpf"),e.xp6(1),e.Q6J("ngIf",r.checked),e.xp6(2),e.Q6J("ngIf","Sans titre"===r.libelle),e.xp6(6),e.Q6J("ngIf",!r.checked)}}function B(n,_){if(1&n&&(e.TgZ(0,"ion-list"),e.YNc(1,R,17,16,"ion-item-sliding",13),e.qZA()),2&n){const r=e.oxw(2);e.xp6(1),e.Q6J("ngForOf",r.coursedetails)}}function Q(n,_){if(1&n){const r=e.EpF();e.TgZ(0,"ion-fab",24)(1,"ion-fab-button",25),e.NdJ("click",function(){e.CHM(r);const i=e.oxw(2);return e.KtG(i.postArticleWithCalculator())}),e._UZ(2,"ion-icon",26),e.qZA(),e.TgZ(3,"ion-fab-button",27),e.NdJ("click",function(){e.CHM(r);const i=e.oxw(2);return e.KtG(i.postArticleWithBarCode())}),e._UZ(4,"ion-icon",28),e.qZA(),e.TgZ(5,"ion-fab-button",27),e.NdJ("click",function(){e.CHM(r);const i=e.oxw(2);return e.KtG(i.dechargerMemo())}),e._UZ(6,"ion-icon",29),e.qZA(),e.TgZ(7,"ion-fab-button",27),e.NdJ("click",function(){e.CHM(r);const i=e.oxw(2);return e.KtG(i.postArticle())}),e._UZ(8,"ion-icon",30),e.qZA()()}}function U(n,_){if(1&n){const r=e.EpF();e.TgZ(0,"ion-fab",31),e.NdJ("click",function(){e.CHM(r);const i=e.oxw(2);return e.KtG(i.postArticleWithCalculator())}),e.TgZ(1,"ion-fab-button",32),e._UZ(2,"ion-icon",30),e.qZA()()}}function O(n,_){if(1&n){const r=e.EpF();e.TgZ(0,"ion-fab-button",35),e.NdJ("click",function(){e.CHM(r);const i=e.oxw(3);return e.KtG(i.regler())}),e._UZ(1,"ion-icon",36),e.qZA()}}function Y(n,_){if(1&n){const r=e.EpF();e.TgZ(0,"ion-fab",24),e.YNc(1,O,2,0,"ion-fab-button",33),e.TgZ(2,"ion-fab-button",27),e.NdJ("click",function(){e.CHM(r);const i=e.oxw(2);return e.KtG(i.setAfficherListe())}),e._UZ(3,"ion-icon",34),e.qZA()()}if(2&n){const r=e.oxw(2);e.xp6(1),e.Q6J("ngIf",r.isAfficherListe)}}function K(n,_){1&n&&e._UZ(0,"ion-icon",22)}function E(n,_){if(1&n){const r=e.EpF();e.TgZ(0,"ion-item-option",23),e.NdJ("click",function(){e.CHM(r);const i=e.oxw().$implicit,s=e.oxw(3);return e.KtG(s.associerUnCodeBarreAArticleSansTitre(i))}),e._uU(1," BarreCode "),e.qZA()}}function G(n,_){1&n&&e._UZ(0,"ion-icon",22)}function V(n,_){if(1&n){const r=e.EpF();e.TgZ(0,"ion-item-sliding")(1,"ion-item",14),e.NdJ("click",function(){const s=e.CHM(r).$implicit,o=e.oxw(3);return e.KtG(o.put(s))}),e.TgZ(2,"ion-label",15),e._uU(3),e.qZA(),e.TgZ(4,"ion-label",15),e._uU(5),e.qZA(),e.TgZ(6,"ion-label",15),e._uU(7),e.qZA(),e.YNc(8,K,1,0,"ion-icon",16),e.qZA(),e.TgZ(9,"ion-item-options",17),e.YNc(10,E,2,0,"ion-item-option",18),e.TgZ(11,"ion-item-option",19),e.NdJ("click",function(){const s=e.CHM(r).$implicit,o=e.oxw(3);return e.KtG(o.delete(s))}),e._uU(12," Supprimer "),e.qZA()(),e.TgZ(13,"ion-item-options",20)(14,"ion-item-option",21),e.NdJ("click",function(){const s=e.CHM(r).$implicit,o=e.oxw(3);return e.KtG(o.check(s))}),e._uU(15," Check "),e.YNc(16,G,1,0,"ion-icon",16),e.qZA()()()}if(2&n){const r=_.$implicit;e.xp6(1),e.Q6J("disabled",r.checked||"DELETE"===r.firebaseMethod),e.xp6(1),e.Q6J("ngStyle",e.VKq(10,m,r.checked?"brown":"white")),e.xp6(1),e.Oqu(r.libelle),e.xp6(1),e.Q6J("ngStyle",e.VKq(12,m,r.checked?"brown":"white")),e.xp6(1),e.hij("x ",r.quantite,""),e.xp6(1),e.Q6J("ngStyle",e.VKq(14,m,r.checked?"brown":"white")),e.xp6(1),e.hij("",r.total," xpf"),e.xp6(1),e.Q6J("ngIf",r.checked),e.xp6(2),e.Q6J("ngIf","Sans titre"===r.libelle),e.xp6(6),e.Q6J("ngIf",!r.checked)}}function L(n,_){if(1&n&&(e.TgZ(0,"ion-list"),e.YNc(1,V,17,16,"ion-item-sliding",13),e.qZA()),2&n){const r=e.oxw(2);e.xp6(1),e.Q6J("ngForOf",r.coursedetails)}}function z(n,_){if(1&n&&(e.TgZ(0,"ion-content",8)(1,"div",9)(2,"ion-chip",10),e._uU(3),e.qZA()(),e.YNc(4,B,2,1,"ion-list",4),e.YNc(5,Q,9,0,"ion-fab",11),e.YNc(6,U,3,0,"ion-fab",12),e.YNc(7,Y,4,1,"ion-fab",11),e.YNc(8,L,2,1,"ion-list",4),e.qZA()),2&n){const r=e.oxw();e.Udp("visibility",r.content_visibility),e.Q6J("fullscreen",!0),e.xp6(3),e.hij("",r.totalCourse," XPF"),e.xp6(1),e.Q6J("ngIf",!r.isModeCourseRapide),e.xp6(1),e.Q6J("ngIf",r.isButtonActif&&!r.isModeCourseRapide),e.xp6(1),e.Q6J("ngIf",r.isModeCourseRapide&&!r.isAfficherListe),e.xp6(1),e.Q6J("ngIf",r.isModeCourseRapide),e.xp6(1),e.Q6J("ngIf",r.isModeCourseRapide&&r.isAfficherListe)}}const H=[{path:"",component:(()=>{var n;class _{constructor(t,i,s,o,l,c,u,p,h){this.coursesService=t,this.alertController=i,this.articleservice=s,this.utility=o,this.codeBarre=l,this.articlesService=c,this.historiqueprixservice=u,this.memoservice=p,this.route=h,this.courseid=0,this.totalCourse=0,this.course={id:0,ordre:0,magasinId:1,montantTheorique:0,montantReel:0,ecart:0,date:new Date,actif:!0,isFirebase:!1},this.coursedetails=[],this.articles=[],this.content_visibility="",this.rechercheAvance=!1,this.isButtonActif=!0,this.isModeCourseRapide=!0,this.isAfficherListe=!1}ngOnInit(){this.refresh()}scanne(){var t=this;return(0,a.Z)(function*(){const i=yield t.codeBarre.STEP1EnableCameraReturnVisility();t.content_visibility=i;const s=yield t.codeBarre.STEP2ScanneBarCodeAndReturnContent(),o=yield t.codeBarre.STEP3disableCameraReturnVisility();return t.content_visibility=o,s})()}postArticleWithBarCode(){var t=this;return(0,a.Z)(function*(){const i=yield t.scanne(),s=yield t.articleservice.getArticleByCodeBarre(i);s.length>0?yield t.postPrix(s[0]):yield t.setArticleOnLocalStorageWithCodeBarre(i)})()}postArticleWithCalculator(){var t=this;return(0,a.Z)(function*(){var s;yield(yield t.alertController.create({cssClass:"my-custom-class",header:"Ajouter un \xe9lement au panier",inputs:[{type:"number",name:"prix",placeholder:"Prix"},{type:"number",name:"quantite",placeholder:"Quantit\xe9"}],buttons:[{text:"Annuler",role:"cancel",cssClass:"secondary",handler:()=>{}},{text:"Valider",handler:(s=(0,a.Z)(function*(o){var l=""==o.quantite?1:Number(o.quantite),c=""==o.prix?100:Number(o.prix),u={id:Date.now(),ordre:1,courseId:t.courseid,libelle:"Sans titre",quantite:l,articleId:0,prixArticle:c,prixReel:c,checked:!1,total:c*l,isFirebase:!1};yield t.coursesService.postCourseDetails(u),yield t.refresh()}),function(l){return s.apply(this,arguments)})}]})).present().then(()=>{document.querySelector("ion-alert input").focus()})})()}associerUnCodeBarreAArticleSansTitre(t){var i=this;return(0,a.Z)(function*(){const s=yield i.scanne();yield i.setArticleArticleSanstitre(t,s)})()}setArticleArticleSanstitre(t,i){var s=this;return(0,a.Z)(function*(){var l;yield(yield s.alertController.create({cssClass:"my-custom-class",header:"Ajouter un \xe9lement au panier",inputs:[{type:"text",name:"libelle",placeholder:"Libelle"},{type:"number",name:"prix",placeholder:t.prixReel.toString()+" xpf"},{type:"number",name:"quantite",placeholder:"Qt\xe9: "+t.quantite.toString()}],buttons:[{text:"Annuler",role:"cancel",cssClass:"secondary",handler:()=>{}},{text:"Valider",handler:(l=(0,a.Z)(function*(c){var u=""==c.quantite?1:Number(c.quantite),p=""==c.prix?100:Number(c.prix),h=""==c.libelle?"Prix":c.libelle,x={id:0,libelle:h,createdOn:new Date,groupeId:[0],familleId:0,codeBarre:i,isFirebase:!1,prix:[{magasin:s.course.magasinId,prix:p}]};yield s.articlesService.post(x);var b=yield s.articlesService.getArticleByCodeBarre(i);t.libelle=h,t.quantite=u,t.prixReel=p,t.articleId=null==b[0].id||null==b[0].id?0:b[0].id,t.total=p*u,yield s.coursesService.putCourseDetails(t),yield s.refresh()}),function(u){return l.apply(this,arguments)})}]})).present().then(()=>{document.querySelector("ion-alert input").focus()})})()}setArticleOnLocalStorageWithCodeBarre(t){var i=this;return(0,a.Z)(function*(){var o;yield(yield i.alertController.create({cssClass:"my-custom-class",header:"L'article n'existe pas, veuillez le cr\xe9\xe9",inputs:[{type:"text",name:"libelle",label:"Nom de l'article"}],buttons:[{text:"Annuler",role:"cancel",cssClass:"secondary",handler:()=>{}},{text:"Valider",handler:(o=(0,a.Z)(function*(l){l.codeBarre=yield t,yield i.postChoosePrixAndSaveArticle(l)}),function(c){return o.apply(this,arguments)})}]})).present().then(()=>{document.querySelector("ion-alert input").focus()})})()}postChoosePrixAndSaveArticle(t){var i=this;return(0,a.Z)(function*(){var o;yield(yield i.alertController.create({cssClass:"my-custom-class",header:"Renseigner un prix",inputs:[{type:"number",name:"prix",placeholder:"PRIX"}],buttons:[{text:"Annuler",role:"cancel",cssClass:"secondary",handler:()=>{}},{text:"Valider",handler:(o=(0,a.Z)(function*(l){var c={id:Date.now(),libelle:t.libelle,prix:[{magasin:i.course.magasinId,prix:null==l?100:l.prix}],createdOn:new Date,groupeId:[(yield i.utility.getConnexionInfo()).groupeId],familleId:0,codeBarre:t.codeBarre,isFirebase:!1};yield i.articlesService.post(c),yield i.postPrix(c)}),function(c){return o.apply(this,arguments)})}]})).present().then(()=>{document.querySelector("ion-alert input").focus()})})()}refresh(){var t=this;return(0,a.Z)(function*(){t.courseid=t.getId();const i=yield t.getCourse();t.course=i;const s=yield t.getCourseDetail();t.coursedetails=s;const o=yield t.getArticles();t.articles=o,t.calculeTotalCourse()})()}calculeTotalCourse(){const t=this.coursedetails;var i=0;t.length>0?(t.map(s=>i+=s.total),this.totalCourse=i,this.course.montantReel=i,this.course.montantTheorique=i):(this.totalCourse=0,this.course.montantReel=0,this.course.montantTheorique=0),this.coursesService.putCourse(this.course)}getId(){return this.route.snapshot.params.id}getCourse(){var t=this;return(0,a.Z)(function*(){return yield t.coursesService.getCourseById(t.courseid)})()}getCourseDetail(){var t=this;return(0,a.Z)(function*(){return(yield t.coursesService.getCourseDetails(t.courseid)).filter(s=>null==s.deletedOn)})()}getArticles(){var t=this;return(0,a.Z)(function*(){return t.articleservice.get()})()}postArticle(){var t=this;return(0,a.Z)(function*(){const i=[];var o;t.articles.map(o=>i.push({type:"radio",label:o.libelle,value:o})),yield(yield t.alertController.create({cssClass:"my-custom-class",header:"Ajouter un \xe9l\xe9ment \xe0 votre panier ?",inputs:i,buttons:[{text:"Annuler",role:"cancel",cssClass:"secondary",handler:()=>{}},{text:"Nouvelle article",cssClass:"secondary",handler:(o=(0,a.Z)(function*(){yield t.postNouvelleArticle()}),function(){return o.apply(this,arguments)})},{text:"Recherche avanc\xe9e",cssClass:"secondary",handler:()=>{t.rechercheAvance=!t.rechercheAvance}},{text:"Valider",handler:function(){var o=(0,a.Z)(function*(l){yield t.postPrix(l)});return function(c){return o.apply(this,arguments)}}()}]})).present()})()}postNouvelleArticle(){var t=this;return(0,a.Z)(function*(){var s;yield(yield t.alertController.create({cssClass:"my-custom-class",header:"Ajouter un nouvelle article",inputs:[{type:"text",label:"Libell\xe9",name:"libelle"},{type:"number",placeholder:"Qt\xe9 : 1",name:"quantite"},{type:"number",placeholder:"Prix : 1000 xpf",name:"prix"}],buttons:[{text:"Annuler",role:"cancel",cssClass:"secondary",handler:()=>{}},{text:"Valider",handler:(s=(0,a.Z)(function*(o){var l=""===o.prix?1e3:Number(o.prix),c=""===o.quantite?1:Number(o.quantite),u={id:t.utility.generateId(),libelle:o.libelle,prix:[{magasin:t.course.magasinId,prix:l}],createdOn:new Date,groupeId:[(yield t.utility.getConnexionInfo()).groupeId],familleId:0,codeBarre:"",isFirebase:!1};yield t.articleservice.post(u);var p={id:Date.now(),ordre:1,courseId:t.courseid,libelle:u.libelle,quantite:c,articleId:u.id,prixArticle:u.prix[0].prix,prixReel:l,checked:!1,total:c*l,isFirebase:!1};yield t.coursesService.postCourseDetails(p),yield t.refresh()}),function(l){return s.apply(this,arguments)})}]})).present()})()}addNewPrixArticle(t){var i=this;return(0,a.Z)(function*(){var o;yield(yield i.alertController.create({cssClass:"my-custom-class",header:"Renseigner le prix et la quantit\xe9 souhait\xe9e",inputs:[{type:"number",placeholder:"Quantit\xe9 : 1",name:"quantite"},{type:"number",placeholder:"Prix ex: "+t.prix[0].prix+" xpf",name:"prix"}],buttons:[{text:"Annuler",role:"cancel",cssClass:"secondary",handler:()=>{}},{text:"Valider",handler:(o=(0,a.Z)(function*(l){t.prix.push({magasin:i.course.magasinId,prix:Number(""===l.prix?t.prix[0].prix:l.prix)}),yield i.articlesService.put(t);var c=Number(""===l.prix?t.prix[0].prix:l.prix),u=""===l.quantite?1:Number(l.quantite),p={id:Date.now(),ordre:1,courseId:i.courseid,libelle:t.libelle,quantite:u,articleId:t.id,prixArticle:c,prixReel:c,checked:!1,total:u*c,isFirebase:!1};yield i.coursesService.postCourseDetails(p),yield i.refresh()}),function(c){return o.apply(this,arguments)})}]})).present()})()}postPrix(t){var i=this;return(0,a.Z)(function*(){var s,c,o=yield null===(s=t.prix.find(l=>l.magasin==i.course.magasinId))||void 0===s?void 0:s.prix;void 0===o?yield i.addNewPrixArticle(t):yield(yield i.alertController.create({cssClass:"my-custom-class",header:"Renseigner le prix et la quantit\xe9 souhait\xe9e",inputs:[{type:"number",placeholder:"Qt\xe9 : 1",name:"quantite"},{type:"number",placeholder:"Prix : "+o+" xpf",name:"prix"}],buttons:[{text:"Annuler",role:"cancel",cssClass:"secondary",handler:()=>{}},{text:"Valider",handler:(c=(0,a.Z)(function*(u){var p=""===u.prix?o:Number(u.prix),h=""===u.quantite?1:Number(u.quantite),x={id:Date.now(),ordre:1,courseId:i.courseid,libelle:t.libelle,quantite:h,articleId:t.id,prixArticle:Number(o),prixReel:Number(p),checked:!1,total:h*Number(p),isFirebase:!1};if(yield i.coursesService.postCourseDetails(x),x.prixReel!==x.prixArticle){const b=t.prix.findIndex(W=>W.magasin===i.course.magasinId);t.prix[b].prix=Number(x.prixReel),yield i.putPrixFicheArticle(t,Number(o))}else yield i.refresh()}),function(p){return c.apply(this,arguments)})}]})).present()})()}putPrixFicheArticle(t,i){var s=this;return(0,a.Z)(function*(){var l;yield(yield s.alertController.create({cssClass:"my-custom-class",header:"Le prix renseign\xe9 est diff\xe9r\xe9 du prix de la fiche article. Souhaitez-vous le mettre \xe0 jour ?",inputs:[],buttons:[{text:"Non",role:"cancel",cssClass:"secondary",handler:()=>{}},{text:"Oui",handler:(l=(0,a.Z)(function*(){yield s.articlesService.put(t);const c=t.prix.findIndex(p=>p.magasin===s.course.magasinId),u={id:Number(new Date),articleId:t.id,libelle:t.libelle,prixAncien:i,prixNouveau:t.prix[c].prix,magasinid:t.prix[c].magasin,date:new Date,isFirebase:!1};yield s.historiqueprixservice.post(u),s.refresh()}),function(){return l.apply(this,arguments)})}]})).present()})()}check(t){var i=this;return(0,a.Z)(function*(){t.checked=!t.checked,yield i.coursesService.putCourseDetails(t),yield i.refresh()})()}put(t){var i=this;return(0,a.Z)(function*(){var o;yield(yield i.alertController.create({cssClass:"my-custom-class",header:"Renseigner le prix et la quantit\xe9 souhait\xe9e",inputs:[{type:"text",value:t.libelle,label:"Libell\xe9",name:"libelle"},{type:"number",value:t.quantite,label:"Quantit\xe9",name:"quantite"},{type:"number",label:"Prix",name:"prix",value:t.prixReel}],buttons:[{text:"Annuler",role:"cancel",cssClass:"secondary",handler:()=>{}},{text:"Valider",handler:(o=(0,a.Z)(function*(l){if(t.libelle=l.libelle,t.prixReel=l.prix,t.quantite=l.quantite,t.total=l.prix*l.quantite,yield i.coursesService.putCourseDetails(t),l.prix==t.prixArticle)yield i.refresh();else if("Sans titre"!==t.libelle){const c=yield i.articlesService.getArticleById(t.articleId),u=yield c[0].prix.findIndex(p=>p.magasin===i.course.magasinId);i.putArticleOnDatabase({articleId:t.articleId,prixNouveau:Number(l.prix),prixAncien:Number(c[0].prix[u].prix),magasinId:i.course.magasinId,coursedetail:t})}}),function(c){return o.apply(this,arguments)})}]})).present()})()}putArticleOnDatabase(t){var i=this;return(0,a.Z)(function*(){var o;yield(yield i.alertController.create({cssClass:"my-custom-class",header:"Souhaitez-vous \xe9galement mettre \xe0 jour le prix en base de donn\xe9es ?",buttons:[{text:"Annuler",role:"Non",cssClass:"secondary",handler:()=>{}},{text:"Oui",handler:(o=(0,a.Z)(function*(){var l=yield i.articleservice.getArticleById(Number(t.articleId)),c=yield l[0].prix.findIndex(h=>h.magasin==t.magasinId);l[0].prix[c].prix=t.prixNouveau,yield i.articleservice.put(l[0]),t.coursedetail.prixArticle=t.prixNouveau,yield i.coursesService.putCourseDetails(t.coursedetail);const p={id:Number(new Date),articleId:l[0].id,libelle:l[0].libelle,prixAncien:t.prixAncien,prixNouveau:t.prixNouveau,magasinid:i.course.magasinId,date:new Date,isFirebase:!1};yield i.historiqueprixservice.post(p),yield i.refresh()}),function(){return o.apply(this,arguments)})}]})).present()})()}selectArticle(t){var i=this;return(0,a.Z)(function*(){yield i.postPrix(t),i.rechercheAvance=!i.rechercheAvance})()}delete(t){var i=this;return(0,a.Z)(function*(){var o;yield(yield i.alertController.create({cssClass:"my-custom-class",header:"Souhaitez-vous r\xe9ellement retirer l'article de votre liste ?",buttons:[{text:"Annuler",role:"Non",cssClass:"secondary",handler:()=>{}},{text:"Oui",handler:(o=(0,a.Z)(function*(){yield i.coursesService.deleteDefinitivementCourseDetails(t),yield i.refresh()}),function(){return o.apply(this,arguments)})}]})).present()})()}deleteCourseDetail(t){var i=this;return(0,a.Z)(function*(){yield i.coursesService.deleteCourseDetails(t),yield i.refresh()})()}setIsButtonActif(){this.isButtonActif=!this.isButtonActif}dechargerMemo(){var t=this;return(0,a.Z)(function*(){var s;yield(yield t.alertController.create({cssClass:"my-custom-class",header:"Souhaitez-vous d\xe9charger vos notes de course ?",buttons:[{text:"Annuler",role:"Non",cssClass:"secondary",handler:()=>{}},{text:"Oui",handler:(s=(0,a.Z)(function*(){const o=yield t.memoservice.get();for(let c of o){const u=c.article.prix.find(p=>p.magasin===t.course.magasinId);var l={id:Number(new Date),ordre:0,courseId:t.course.id.toString(),libelle:c.article.libelle,quantite:c.quantite,articleId:c.article.id,prixArticle:void 0===u?c.article.prix[0].prix:u.prix,prixReel:void 0===u?c.article.prix[0].prix:u.prix,total:Number(c.quantite*(void 0===u?c.article.prix[0].prix:u.prix)),checked:!1,isFirebase:!1};yield t.coursesService.postCourseDetails(l),yield t.memoservice.delete(c)}yield t.refresh()}),function(){return s.apply(this,arguments)})}]})).present()})()}setAfficherListe(){this.isAfficherListe=!this.isAfficherListe}regler(){var t=this;return(0,a.Z)(function*(){var s;yield(yield t.alertController.create({cssClass:"my-custom-class",header:"R\xe9gler vos courses",inputs:[{type:"number",name:"reglement"}],buttons:[{text:"Annuler",role:"Non",cssClass:"secondary",handler:()=>{}},{text:"Valider",handler:(s=(0,a.Z)(function*(o){t.course.montantReel=o.reglement,yield t.coursesService.putCourse(t.course);const l=t.course.montantTheorique;if(l<o.reglement){var c=o.reglement-l,u={id:Date.now(),ordre:1,courseId:t.courseid,libelle:"REGLT +",quantite:1,articleId:0,prixArticle:c,prixReel:c,checked:!1,total:c,isFirebase:!1};yield t.coursesService.postCourseDetails(u)}else c=l-o.reglement,u={id:Date.now(),ordre:1,courseId:t.courseid,libelle:"REGLT -",quantite:1,articleId:0,prixArticle:c,prixReel:c,checked:!1,total:-1*c,isFirebase:!1},yield t.coursesService.postCourseDetails(u);yield t.refresh()}),function(l){return s.apply(this,arguments)})}]})).present()})()}}return(n=_).\u0275fac=function(t){return new(t||n)(e.Y36(Z.N),e.Y36(d.Br),e.Y36(v.J),e.Y36(I.t),e.Y36(T.k),e.Y36(v.J),e.Y36(q.a),e.Y36(D.T),e.Y36(C.gz))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-course-details"]],decls:9,vars:4,consts:[[3,"translucent"],["slot","start"],["defaultHref","/courses"],["style","margin-left: 50px;","name","apps-outline",3,"click",4,"ngIf"],[4,"ngIf"],[3,"fullscreen","visibility",4,"ngIf"],["name","apps-outline",2,"margin-left","50px",3,"click"],[3,"articlesOutput"],[3,"fullscreen"],[2,"display","flex","justify-content","center","padding","10px"],["color","white",2,"font-weight","bold","font-size","x-large"],["slot","fixed","horizontal","end","vertical","bottom",4,"ngIf"],["slot","fixed","horizontal","center","vertical","center",3,"click",4,"ngIf"],[4,"ngFor","ngForOf"],["button","",3,"disabled","click"],[3,"ngStyle"],["name","lock-closed-outline",4,"ngIf"],["side","start"],["style","color: rgb(255, 196, 216); background: rgb(39, 24, 102);",3,"click",4,"ngIf"],[2,"background","red",3,"click"],["side","end"],[3,"click"],["name","lock-closed-outline"],[2,"color","rgb(255, 196, 216)","background","rgb(39, 24, 102)",3,"click"],["slot","fixed","horizontal","end","vertical","bottom"],["size","large","color","success",3,"click"],["name","calculator-outline"],["size","small",3,"click"],["name","barcode"],["name","book-outline"],["name","add"],["slot","fixed","horizontal","center","vertical","center",3,"click"],["size","large"],["size","small","color","danger",3,"click",4,"ngIf"],["name","list-circle-outline"],["size","small","color","danger",3,"click"],["name","journal-outline"]],template:function(t,i){1&t&&(e.TgZ(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-buttons",1),e._UZ(3,"ion-back-button",2),e.qZA(),e.TgZ(4,"ion-title"),e._uU(5," Votre liste de course "),e.YNc(6,k,1,0,"ion-icon",3),e.qZA()()(),e.YNc(7,w,2,0,"ion-content",4),e.YNc(8,z,9,9,"ion-content",5)),2&t&&(e.Q6J("translucent",!0),e.xp6(6),e.Q6J("ngIf",!i.isModeCourseRapide),e.xp6(1),e.Q6J("ngIf",i.rechercheAvance),e.xp6(1),e.Q6J("ngIf",!i.rechercheAvance))},dependencies:[g.sg,g.O5,g.PC,d.oU,d.Sm,d.hM,d.W2,d.IJ,d.W4,d.Gu,d.gu,d.Ie,d.u8,d.IK,d.td,d.Q$,d.q_,d.wd,d.sr,d.cs,P]}),_})()}];let j=(()=>{var n;class _{}return(n=_).\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[C.Bz.forChild(H),C.Bz]}),_})(),$=(()=>{var n;class _{}return(n=_).\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[g.ez,y.u5,d.Pc,j]}),_})()}}]);