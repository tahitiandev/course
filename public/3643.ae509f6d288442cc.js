"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[3643],{3643:(S,_,g)=>{g.r(_),g.d(_,{HomePageModule:()=>A});var a=g(6814),f=g(95),h=g(7027),U=g(9801),Z=g(5861),e=g(6689),O=g(6815),F=g(4073),r=g(5423),l=g(202),v=g(7039),d=g(9972),D=g(6199);function P(o,p){if(1&o){const T=e.EpF();e.TgZ(0,"div",15)(1,"ion-datetime",16),e.NdJ("ionChange",function(s){e.CHM(T);const m=e.oxw();return e.KtG(m.selectDateTime(s))}),e.qZA()()}}function n(o,p){if(1&o&&(e.TgZ(0,"tr",19)(1,"td"),e._uU(2),e.qZA(),e.TgZ(3,"td"),e._uU(4),e.qZA(),e.TgZ(5,"td"),e._uU(6),e.qZA()()),2&o){const T=p.$implicit;e.xp6(2),e.Oqu(T.utilisateur),e.xp6(2),e.Oqu(T.montantCourse),e.xp6(2),e.Oqu(T.montantdepense)}}function i(o,p){if(1&o&&(e.TgZ(0,"table",9)(1,"tr",17)(2,"th"),e._uU(3,"Utilisateurs"),e.qZA(),e.TgZ(4,"th"),e._uU(5,"Montant course"),e.qZA(),e.TgZ(6,"th"),e._uU(7,"Montant d\xe9pense"),e.qZA()(),e.YNc(8,n,7,3,"tr",18),e.qZA()),2&o){const T=e.oxw();e.xp6(8),e.Q6J("ngForOf",T.utilisateurByDepense)}}const c=[{path:"",component:(()=>{var o;class p{constructor(t,s,m,C,x,I,b,M){this.utility=t,this.utilisateursService=s,this.storageService=m,this.magasinservice=C,this.navigate=x,this.apportsservice=I,this.depensesservice=b,this.coursesService=M,this.utilisateurs=[],this.courses=[],this.depenses=[],this.apports=[],this.utilisateurByDepense=[],this.isInputDateActif=!1,this.budgetRestant=0,this.budget=0,this.totalDepense=0,this.utilisateurConnecteLibelle="",this.montantApportUtilisateurConnecte=0,this.epargne=0}ngOnInit(){var t=this;return(0,Z.Z)(function*(){yield t.redirection();var s=t.getToday();t.year=s.year,t.day=s.day,t.month=s.month,yield t.refresh(),yield t.statsUtilisateursByDepense()})()}handleRefresh(t){var s=this;this.storageService.synchroniserAvecFirestore().then((0,Z.Z)(function*(){t.target.complete(),location.reload(),yield s.utility.popUp("Synchronisation compl\xe8te termin\xe9e")}))}changeDate(){this.isInputDateActif=!this.isInputDateActif}getLibelleMois(t){return["January","February","March","April","May","June","July","August","September","October","November","December"][t]}redirection(){var t=this;return(0,Z.Z)(function*(){(yield t.utility.getConnexionInfo()).isConnected||t.navigate.navigateRoot("authentification")})()}getToday(){const t=new Date;return{day:t.getUTCDate(),month:t.getUTCMonth()+1,year:t.getUTCFullYear(),full:t.toLocaleDateString("en-GB")}}refresh(){var t=this;return(0,Z.Z)(function*(){t.courses=yield t.getCourses(),t.utilisateurs=yield t.getUtilisateurs(),t.depenses=yield t.getDepenses(),t.apports=yield t.getApports(),t.getApportUtilisateurConnecte(),t.setBudget(),t.epargne=(yield t.getInfoConnexion()).epargne})()}getInfoConnexion(){var t=this;return(0,Z.Z)(function*(){return yield t.utility.getConnexionInfo()})()}getUtilisateurs(){var t=this;return(0,Z.Z)(function*(){return(yield t.utilisateursService.get()).filter(s=>0!==s.id)})()}getCourses(){var t=this;return(0,Z.Z)(function*(){return yield t.coursesService.getCourse()})()}getDepenses(){var t=this;return(0,Z.Z)(function*(){return yield t.depensesservice.get()})()}statsUtilisateursByDepense(){var t=[],s=0,m=0;this.utilisateurs.map(C=>{this.courses.map(x=>{var I=this.utility.detecteDate(x.date);new Date(I).getUTCFullYear()==this.year&&new Date(I).getUTCMonth()+1==this.month&&x.payeurId===C.id&&(s+=x.montantReel)}),this.depenses.map(x=>{var I=this.utility.detecteDate(x.createdOn);new Date(I).getUTCFullYear()==this.year&&new Date(I).getUTCMonth()+1==this.month&&x.userid===C.id&&(m+=Number(x.depense))}),t.push({utilisateur:C.libelle,montantCourse:s,montantdepense:m}),s=0,m=0}),this.utilisateurByDepense=t}selectDateTime(t){var s=this;return(0,Z.Z)(function*(){s.utilisateurByDepense=[];var m=t.detail.value;s.month=(yield new Date(m).getUTCMonth())+1,s.year=yield new Date(m).getUTCFullYear(),yield s.statsUtilisateursByDepense()})()}statistiquePayeurByMagasin(){var t=this;return(0,Z.Z)(function*(){const s=t.utilisateurs,m=yield t.magasinservice.get();t.courses.map(b=>{s.map(M=>{b.payeurId===M.id&&m.map(E=>{})})})})()}getApports(){var t=this;return(0,Z.Z)(function*(){return yield t.apportsservice.get()})()}getApportUtilisateurConnecte(){var t=this;return(0,Z.Z)(function*(){const s=yield t.utility.getConnexionInfo();var m=0;t.apports.map(C=>{var x=t.utility.detecteDate(C.createdOn);x.getUTCFullYear()==t.year&&new Date(x).getUTCMonth()+1==t.month&&C.userid==s.utilisateurId&&(m+=Number(C.apport))}),t.montantApportUtilisateurConnecte=m})()}setBudget(){var t=this;return(0,Z.Z)(function*(){const s=yield t.utility.getConnexionInfo(),m=s.budget,C=yield t.utilisateursService.getLibelleUtilisateurById(s.utilisateurId),I=yield t.utilisateurByDepense.find(E=>E.utilisateur===C),b=I.montantCourse+I.montantdepense;t.budgetRestant=s.budget-b+t.montantApportUtilisateurConnecte,t.budget=m,t.totalDepense=b,t.utilisateurConnecteLibelle=C})()}}return(o=p).\u0275fac=function(t){return new(t||o)(e.Y36(O.t),e.Y36(F.X),e.Y36(r.V),e.Y36(l.t),e.Y36(h.SH),e.Y36(v.P),e.Y36(d.e),e.Y36(D.N))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-home"]],decls:40,vars:14,consts:[[3,"translucent"],["slot","start"],[3,"fullscreen"],["slot","fixed",3,"pullFactor","pullMin","pullMax","ionRefresh"],["shape","round",2,"display","block","margin","auto","width","60%","margin-top","10px",3,"click"],["style","margin: 50px;",4,"ngIf"],[2,"margin-top","30px","margin-left","20px"],["style","margin: 15px;",4,"ngIf"],[2,"margin-left","20px"],[2,"margin","15px"],["aria-hidden","true","name","thumbs-down","slot","start"],["aria-hidden","true","name","thumbs-up","slot","start"],["aria-hidden","true","name","cash","slot","start"],["aria-hidden","true","name","card","slot","start"],["aria-hidden","true","name","lock-closed","slot","start"],[2,"margin","50px"],["presentation","month-year",3,"ionChange"],[2,"background","rgb(135, 71, 207)"],["style","text-align: center;",4,"ngFor","ngForOf"],[2,"text-align","center"]],template:function(t,s){1&t&&(e.TgZ(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-buttons",1),e._UZ(3,"ion-menu-button"),e.qZA(),e.TgZ(4,"ion-title"),e._uU(5,"Tableau de bord"),e.qZA()()(),e.TgZ(6,"ion-content",2)(7,"ion-refresher",3),e.NdJ("ionRefresh",function(C){return s.handleRefresh(C)}),e._UZ(8,"ion-refresher-content"),e.qZA(),e.TgZ(9,"ion-button",4),e.NdJ("click",function(){return s.changeDate()}),e._uU(10,"Modifier la date"),e.qZA(),e.YNc(11,P,2,0,"div",5),e.TgZ(12,"h4",6),e._uU(13,"D\xe9pense de "),e.TgZ(14,"u"),e._uU(15),e.qZA()(),e.YNc(16,i,9,1,"table",7),e.TgZ(17,"h4",8),e._uU(18),e.qZA(),e.TgZ(19,"ion-list",9)(20,"ion-item"),e._UZ(21,"ion-icon",10),e.TgZ(22,"ion-label"),e._uU(23),e.qZA()(),e.TgZ(24,"ion-item"),e._UZ(25,"ion-icon",11),e.TgZ(26,"ion-label"),e._uU(27),e.qZA()(),e.TgZ(28,"ion-item"),e._UZ(29,"ion-icon",12),e.TgZ(30,"ion-label"),e._uU(31),e.qZA()(),e.TgZ(32,"ion-item"),e._UZ(33,"ion-icon",13),e.TgZ(34,"ion-label"),e._uU(35),e.qZA()(),e.TgZ(36,"ion-item"),e._UZ(37,"ion-icon",14),e.TgZ(38,"ion-label"),e._uU(39),e.qZA()()()()),2&t&&(e.Q6J("translucent",!0),e.xp6(6),e.Q6J("fullscreen",!0),e.xp6(1),e.Q6J("pullFactor",.5)("pullMin",100)("pullMax",200),e.xp6(4),e.Q6J("ngIf",s.isInputDateActif),e.xp6(4),e.Oqu(s.getLibelleMois(s.month-1)),e.xp6(1),e.Q6J("ngIf",!s.isInputDateActif),e.xp6(2),e.hij("R\xe9capitulatif de ",s.utilisateurConnecteLibelle,""),e.xp6(5),e.hij("D\xe9pense du mois : ",s.totalDepense.toLocaleString()," XPF"),e.xp6(4),e.hij("Apport du mois : ",s.montantApportUtilisateurConnecte.toLocaleString()," XPF"),e.xp6(4),e.hij("Budget du mois fix\xe9 \xe0 : ",s.budget.toLocaleString()," XPF"),e.xp6(4),e.hij("Budget restant : ",s.budgetRestant.toLocaleString()," XPF"),e.xp6(4),e.hij("Epargne : ",s.epargne.toLocaleString()," XPF"))},dependencies:[a.sg,a.O5,h.YG,h.Sm,h.W2,h.x4,h.Gu,h.gu,h.Ie,h.Q$,h.q_,h.fG,h.nJ,h.Wo,h.wd,h.sr,h.QI],styles:["table[_ngcontent-%COMP%]{border-collapse:collapse;margin:40px auto auto}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{border:1px solid black;padding:10px}"]}),p})()}];let y=(()=>{var o;class p{}return(o=p).\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[U.Bz.forChild(c),U.Bz]}),p})(),A=(()=>{var o;class p{}return(o=p).\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[a.ez,f.u5,h.Pc,y]}),p})()},9825:(S,_,g)=>{g.d(_,{f:()=>a});var a=function(f){return f.POST="POST",f.PUT="PUT",f.DELETE="DELETE",f}(a||{})},6199:(S,_,g)=>{g.d(_,{N:()=>Z});var a=g(5861),f=g(3009),h=g(6689),U=g(5423);let Z=(()=>{var e;class O{constructor(r){this.storage=r}getCourse(){var r=this;return(0,a.Z)(function*(){const l=yield r.storage.get(f.K.Courses);return r.sortByOrdreAsc(l)})()}sortByOrdreAsc(r){return r.sort((l,v)=>l.ordre>v.ordre?-1:1)}sortByOrdreDesc(r){return r.sort((l,v)=>l.ordre<v.ordre?-1:1)}postCourse(r){var l=this;return(0,a.Z)(function*(){yield l.storage.post(f.K.Courses,r)})()}putCourse(r){var l=this;return(0,a.Z)(function*(){yield l.storage.put(f.K.Courses,r)})()}deleteCourse(r){var l=this;return(0,a.Z)(function*(){yield l.storage.delete(f.K.Courses,r)})()}deleteCourseDefinitivement(r){var l=this;return(0,a.Z)(function*(){yield l.storage.deleteDefinitivement(f.K.Courses,r)})()}getCourseById(r){var l=this;return(0,a.Z)(function*(){return yield(yield l.getCourse()).find(d=>d.id==r)})()}getCourseDetails(r){var l=this;return(0,a.Z)(function*(){return(yield l.storage.get(f.K.CourseDetails)).filter(d=>d.courseId===r&&void 0!==d.deletedOn)})()}generateOrdreCourse(){var r=this;return(0,a.Z)(function*(){const l=yield r.getCourse(),v=yield r.sortByOrdreDesc(l).pop();return Number(null==v?void 0:v.ordre)+1})()}setAllCoursesIsFocusFalse(){var r=this;return(0,a.Z)(function*(){yield(yield r.getCourse()).map(function(){var v=(0,a.Z)(function*(d){d.isFocus=!1,yield r.putCourse(d)});return function(d){return v.apply(this,arguments)}}())})()}getCourseIsFocus(){var r=this;return(0,a.Z)(function*(){const l=yield r.getCourse(),v=yield l.filter(d=>d.isFocus);return v.length>0?v:(yield r.postCourse({id:0,ordre:yield r.generateOrdreCourse(),magasinId:0,montantTheorique:0,montantReel:0,ecart:0,date:new Date,actif:!0,isFirebase:!1,isFocus:!0}),yield l.filter(d=>d.isFocus))})()}sortByOrdre(r){return r.sort((l,v)=>l.ordre<v.ordre?-1:1)}postCourseDetails(r){var l=this;return(0,a.Z)(function*(){var v=yield l.getCourseDetails(r.courseId),d=l.sortByOrdre(v);d.length>0&&(r.ordre=d[d.length-1].ordre+1),yield l.storage.post(f.K.CourseDetails,r)})()}putCourseDetails(r){var l=this;return(0,a.Z)(function*(){yield l.storage.put(f.K.CourseDetails,r)})()}deleteCourseDetails(r){var l=this;return(0,a.Z)(function*(){yield l.storage.delete(f.K.CourseDetails,r)})()}deleteDefinitivementCourseDetails(r){var l=this;return(0,a.Z)(function*(){yield l.storage.deleteDefinitivement(f.K.CourseDetails,r)})()}}return(e=O).\u0275fac=function(r){return new(r||e)(h.LFG(U.V))},e.\u0275prov=h.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),O})()},5423:(S,_,g)=>{g.d(_,{V:()=>v});var a=g(5861),f=g(3009),h=g(9825),U=g(6689),Z=g(2014),e=g(2386),O=g(9392),F=g(3182),r=g(553);let l=(()=>{var d;class D{constructor(n){this.firestore=n}post(n,i,u){return(0,a.Z)(function*(){const c=(0,F.ZF)(r.N.firebaseConfig),y=(0,O.ad)(c);yield(0,e.pl)((0,e.JU)(y,n,u),i)})()}getAll(n){var i=this;return(0,a.Z)(function*(){const u=yield(0,e.hJ)(i.firestore,n);return(0,e.BS)(u)})()}put(n,i,u){var c=this;return(0,a.Z)(function*(){const y=(0,e.JU)(c.firestore,n+"/"+i);return(0,e.r7)(y,u)})()}delete(n,i,u){var c=this;return(0,a.Z)(function*(){const y=(0,e.JU)(c.firestore,n+"/"+i);return(0,e.oe)(y)})()}}return(d=D).\u0275fac=function(n){return new(n||d)(U.LFG(e.gg))},d.\u0275prov=U.Yz7({token:d,factory:d.\u0275fac,providedIn:"root"}),D})(),v=(()=>{var d;class D{constructor(n,i){this.storage=n,this.firestore=i}postAll(n,i){var u=this;return(0,a.Z)(function*(){(yield u.getConnexionInfo()).isOnline&&(yield(yield i.filter(A=>!A.isFirebase)).map(function(){var A=(0,a.Z)(function*(o){o.isFirebase=!0,yield u.firestore.post(n,o,o.id.toString())});return function(o){return A.apply(this,arguments)}}())),yield u.storage.set(n,i)})()}parseDate(n){const u=new Date(n).getTime();return{nanoseconds:u%1e3*1e6,seconds:Math.floor(u/1e3)}}post(n,i){var u=this;return(0,a.Z)(function*(){var c=yield u.getAll(n);i.id=Number(new Date),i.createdOn=u.parseDate(new Date),i.modifiedOn=null,i.deletedOn=null,i.isFirebase=!1,c.push(i),yield u.postAll(n,c)})()}get(n){var i=this;return(0,a.Z)(function*(){return yield(yield i.storage.get(n)).filter(c=>""===c.deletedOn||null===c.deletedOn||void 0!==c.deletedOn)})()}getAll(n){var i=this;return(0,a.Z)(function*(){return yield i.storage.get(n)})()}getIndex(n,i){var u=this;return(0,a.Z)(function*(){return yield(yield u.getAll(n)).findIndex(y=>y.id===i)})()}put(n,i){var u=this;return(0,a.Z)(function*(){const c=yield u.getAll(n),y=yield u.getIndex(n,i.id);c[y]=i,c[y].modifiedOn=new Date,(yield u.getConnexionInfo()).isOnline?yield u.firestore.put(n,i.id.toString(),i):c[y].isFirebase&&(c[y].firebaseMethod=h.f.PUT),yield u.postAll(n,c)})()}delete(n,i){var u=this;return(0,a.Z)(function*(){const c=yield u.getAll(n),y=yield u.getIndex(n,i.id);c[y].deletedOn=new Date,c[y].firebaseMethod=h.f.DELETE,yield u.postAll(n,c),(yield u.getConnexionInfo()).isOnline&&(yield u.firestore.put(n,i.id.toString(),i))})()}deleteDefinitivement(n,i){var u=this;return(0,a.Z)(function*(){const c=yield u.getAll(n),y=yield u.getIndex(n,i.id);(yield u.getConnexionInfo()).isOnline?(c.splice(y,1),yield u.firestore.delete(n,i.id.toString(),i)):c[y].isFirebase?(c[y].firebaseMethod=h.f.DELETE,c[y].deletedOn=new Date):c.splice(y,1),yield u.postAll(n,c)})()}synchroniserAvecFirestore(){var n=this;return(0,a.Z)(function*(){(yield n.getConnexionInfo()).isOnline?(yield n.synchroniser(f.K.Utilisateurs),yield n.synchroniser(f.K.Articles),yield n.synchroniser(f.K.Courses),yield n.synchroniser(f.K.Familles),yield n.synchroniser(f.K.CourseDetails),yield n.synchroniser(f.K.Memos),yield n.synchroniser(f.K.HistoriquePrix),yield n.synchroniser(f.K.Depenses),yield n.synchroniser(f.K.Apports),yield n.synchroniser(f.K.Epargnes),yield n.synchroniser(f.K.Magasins),yield n.synchroniser(f.K.Plats),yield n.synchroniser(f.K.PlatDetails),yield n.synchroniser(f.K.Groupes),yield n.synchroniser(f.K.Menus),yield n.synchroniser(f.K.Budget)):alert("Le mode onLine est d\xe9sactiv\xe9")})()}synchroniser(n){var i=this;return(0,a.Z)(function*(){if((yield i.getConnexionInfo()).isOnline){const c=yield i.storage.get(n),y=yield c.filter(o=>!o.isFirebase);y.length>0&&y.map(function(){var o=(0,a.Z)(function*(p){p.isFirebase=!0,yield i.firestore.post(n,p,p.id.toString())});return function(p){return o.apply(this,arguments)}}());const A=yield c.filter(o=>o.firebaseMethod===h.f.DELETE||o.firebaseMethod===h.f.PUT);A.length>0&&A.map(function(){var o=(0,a.Z)(function*(p){p.firebaseMethod===h.f.PUT&&(yield i.put(n,p)),p.firebaseMethod===h.f.DELETE&&(yield i.deleteDefinitivement(n,p))});return function(p){return o.apply(this,arguments)}}()),(yield i.firestore.getAll(n)).subscribe(o=>{i.storage.set(n,o)})}else alert("Le mode onLine est d\xe9sactiv\xe9")})()}set(n,i){var u=this;return(0,a.Z)(function*(){yield u.storage.set(n,i)})()}getConnexionInfo(){var n=this;return(0,a.Z)(function*(){return yield n.storage.get(f.K.InfoConnexion)})()}}return(d=D).\u0275fac=function(n){return new(n||d)(U.LFG(Z.K),U.LFG(l))},d.\u0275prov=U.Yz7({token:d,factory:d.\u0275fac,providedIn:"root"}),D})()}}]);