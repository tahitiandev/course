"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[3643],{3643:(b,T,u)=>{u.r(T),u.d(T,{HomePageModule:()=>o});var c=u(6814),h=u(95),d=u(7027),m=u(9801),v=u(5861),e=u(6689),D=u(6815),I=u(4073),A=u(849),C=u(202),P=u(6199);function g(i,f){if(1&i){const a=e.EpF();e.TgZ(0,"div",7)(1,"ion-datetime",8),e.NdJ("ionChange",function(l){e.CHM(a);const y=e.oxw();return e.KtG(y.selectDateTime(l))}),e.qZA()()}}function x(i,f){if(1&i&&(e.TgZ(0,"tr",12)(1,"td"),e._uU(2),e.qZA(),e.TgZ(3,"td"),e._uU(4),e.qZA()()),2&i){const a=f.$implicit;e.xp6(2),e.Oqu(a.utilisateur),e.xp6(2),e.Oqu(a.depense)}}function Z(i,f){if(1&i&&(e.TgZ(0,"table")(1,"h5",9),e._uU(2,"D\xe9pense de "),e.TgZ(3,"u"),e._uU(4),e.qZA()(),e.TgZ(5,"tr",10)(6,"th"),e._uU(7,"Utilisateurs"),e.qZA(),e.TgZ(8,"th"),e._uU(9,"D\xe9penses"),e.qZA()(),e.YNc(10,x,5,2,"tr",11),e.qZA()),2&i){const a=e.oxw();e.xp6(4),e.Oqu(a.getLibelleMois(a.month-1)),e.xp6(6),e.Q6J("ngForOf",a.utilisateurByDepense)}}const s=[{path:"",component:(()=>{var i;class f{constructor(n,l,y,p,F,U){this.utility=n,this.utilisateursService=l,this.storageService=y,this.magasinservice=p,this.navigate=F,this.coursesService=U,this.utilisateurs=[],this.courses=[],this.utilisateurByDepense=[],this.isInputDateActif=!1}ngOnInit(){var n=this;return(0,v.Z)(function*(){yield n.refresh(),yield n.redirection();var l=n.getToday();n.year=l.year,n.day=l.day,n.month=l.month,yield n.statsUtilisateursByDepense()})()}handleRefresh(n){this.storageService.synchroniserAvecFirestore().then(()=>{n.target.complete(),location.reload()})}changeDate(){this.isInputDateActif=!this.isInputDateActif}getLibelleMois(n){return["January","February","March","April","May","June","July","August","September","October","November","December"][n]}redirection(){var n=this;return(0,v.Z)(function*(){(yield n.utility.getConnexionInfo()).isConnected||n.navigate.navigateRoot("authentification")})()}getToday(){const n=new Date;return{day:n.getUTCDate(),month:n.getUTCMonth()+1,year:n.getUTCFullYear(),full:n.toLocaleDateString("en-GB")}}refresh(){var n=this;return(0,v.Z)(function*(){n.courses=yield n.getCourses(),n.utilisateurs=yield n.getUtilisateurs()})()}getUtilisateurs(){var n=this;return(0,v.Z)(function*(){return(yield n.utilisateursService.get()).filter(l=>0!==l.id)})()}getCourses(){var n=this;return(0,v.Z)(function*(){return yield n.coursesService.getCourse()})()}statsUtilisateursByDepense(){var n=[],l=0;this.utilisateurs.map(y=>{this.courses.map(p=>{new Date(p.date).getUTCFullYear()==this.year&&new Date(p.date).getUTCMonth()+1==this.month&&p.payeurId===y.id&&(l+=p.montantReel)}),n.push({utilisateur:y.libelle,depense:l}),l=0}),this.utilisateurByDepense=n}selectDateTime(n){var l=this;return(0,v.Z)(function*(){l.utilisateurByDepense=[];var y=n.detail.value;l.month=(yield new Date(y).getUTCMonth())+1,l.year=yield new Date(y).getUTCFullYear(),yield l.statsUtilisateursByDepense()})()}statistiquePayeurByMagasin(){var n=this;return(0,v.Z)(function*(){const l=n.utilisateurs,y=yield n.magasinservice.get();n.courses.map(M=>{l.map(S=>{M.payeurId===S.id&&y.map(O=>{})})})})()}}return(i=f).\u0275fac=function(n){return new(n||i)(e.Y36(D.t),e.Y36(I.X),e.Y36(A.V),e.Y36(C.t),e.Y36(d.SH),e.Y36(P.N))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-home"]],decls:13,vars:7,consts:[[3,"translucent"],["slot","start"],[3,"fullscreen"],["slot","fixed",3,"pullFactor","pullMin","pullMax","ionRefresh"],["shape","round",2,"display","block","margin","auto","width","60%","margin-top","10px",3,"click"],["style","margin: 50px;",4,"ngIf"],[4,"ngIf"],[2,"margin","50px"],["presentation","month-year",3,"ionChange"],[2,"margin-right","10px"],[2,"background","rgb(135, 71, 207)"],["style","text-align: center;",4,"ngFor","ngForOf"],[2,"text-align","center"]],template:function(n,l){1&n&&(e.TgZ(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-buttons",1),e._UZ(3,"ion-menu-button"),e.qZA(),e.TgZ(4,"ion-title"),e._uU(5,"Tableau de bord"),e.qZA()()(),e.TgZ(6,"ion-content",2)(7,"ion-refresher",3),e.NdJ("ionRefresh",function(p){return l.handleRefresh(p)}),e._UZ(8,"ion-refresher-content"),e.qZA(),e.TgZ(9,"ion-button",4),e.NdJ("click",function(){return l.changeDate()}),e._uU(10,"Modifier la date"),e.qZA(),e.YNc(11,g,2,0,"div",5),e.YNc(12,Z,11,2,"table",6),e.qZA()),2&n&&(e.Q6J("translucent",!0),e.xp6(6),e.Q6J("fullscreen",!0),e.xp6(1),e.Q6J("pullFactor",.5)("pullMin",100)("pullMax",200),e.xp6(4),e.Q6J("ngIf",l.isInputDateActif),e.xp6(1),e.Q6J("ngIf",!l.isInputDateActif))},dependencies:[c.sg,c.O5,d.YG,d.Sm,d.W2,d.x4,d.Gu,d.fG,d.nJ,d.Wo,d.wd,d.sr,d.QI],styles:["table[_ngcontent-%COMP%]{border-collapse:collapse;margin:40px auto auto}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{border:1px solid black;padding:10px}"]}),f})()}];let r=(()=>{var i;class f{}return(i=f).\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[m.Bz.forChild(s),m.Bz]}),f})(),o=(()=>{var i;class f{}return(i=f).\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[c.ez,h.u5,d.Pc,r]}),f})()},849:(b,T,u)=>{u.d(T,{V:()=>P});var c=u(5861),h=u(3009),d=function(g){return g.POST="POST",g.PUT="PUT",g.DELETE="DELETE",g}(d||{}),m=u(6689),v=u(2014),e=u(2386),D=u(9392),I=u(3182),A=u(553);let C=(()=>{var g;class x{constructor(t){this.firestore=t}post(t,s,r){return(0,c.Z)(function*(){const o=(0,I.ZF)(A.N.firebaseConfig),i=(0,D.ad)(o);yield(0,e.pl)((0,e.JU)(i,t,r),s)})()}getAll(t){var s=this;return(0,c.Z)(function*(){const r=yield(0,e.hJ)(s.firestore,t);return(0,e.BS)(r)})()}put(t,s,r){var o=this;return(0,c.Z)(function*(){const i=(0,e.JU)(o.firestore,t+"/"+s);return(0,e.r7)(i,r)})()}delete(t,s,r){var o=this;return(0,c.Z)(function*(){const i=(0,e.JU)(o.firestore,t+"/"+s);return(0,e.oe)(i)})()}}return(g=x).\u0275fac=function(t){return new(t||g)(m.LFG(e.gg))},g.\u0275prov=m.Yz7({token:g,factory:g.\u0275fac,providedIn:"root"}),x})(),P=(()=>{var g;class x{constructor(t,s){this.storage=t,this.firestore=s}postAll(t,s){var r=this;return(0,c.Z)(function*(){(yield r.getConnexionInfo()).isOnline&&(yield(yield s.filter(f=>!f.isFirebase)).map(function(){var f=(0,c.Z)(function*(a){a.isFirebase=!0,yield r.firestore.post(t,a,a.id.toString())});return function(a){return f.apply(this,arguments)}}())),yield r.storage.set(t,s)})()}post(t,s){var r=this;return(0,c.Z)(function*(){var o=yield r.getAll(t);s.id=Number(new Date),s.createdOn=new Date,s.modifiedOn=null,s.deletedOn=null,s.isFirebase=!1,o.push(s),yield r.postAll(t,o)})()}get(t){var s=this;return(0,c.Z)(function*(){return yield(yield s.storage.get(t)).filter(o=>""===o.deletedOn||null===o.deletedOn||void 0!==o.deletedOn)})()}getAll(t){var s=this;return(0,c.Z)(function*(){return yield s.storage.get(t)})()}getIndex(t,s){var r=this;return(0,c.Z)(function*(){return yield(yield r.getAll(t)).findIndex(i=>i.id===s)})()}put(t,s){var r=this;return(0,c.Z)(function*(){const o=yield r.getAll(t),i=yield r.getIndex(t,s.id);o[i]=s,o[i].modifiedOn=new Date,(yield r.getConnexionInfo()).isOnline?yield r.firestore.put(t,s.id.toString(),s):o[i].isFirebase&&(o[i].firebaseMethod=d.PUT),yield r.postAll(t,o)})()}delete(t,s){var r=this;return(0,c.Z)(function*(){const o=yield r.getAll(t),i=yield r.getIndex(t,s.id);o[i].deletedOn=new Date,o[i].firebaseMethod=d.DELETE,yield r.postAll(t,o),(yield r.getConnexionInfo()).isOnline&&(yield r.firestore.put(t,s.id.toString(),s))})()}deleteDefinitivement(t,s){var r=this;return(0,c.Z)(function*(){const o=yield r.getAll(t),i=yield r.getIndex(t,s.id);(yield r.getConnexionInfo()).isOnline?(o.splice(i,1),yield r.firestore.delete(t,s.id.toString(),s)):o[i].isFirebase?(o[i].firebaseMethod=d.DELETE,o[i].deletedOn=new Date):o.splice(i,1),yield r.postAll(t,o)})()}synchroniserAvecFirestore(){var t=this;return(0,c.Z)(function*(){(yield t.getConnexionInfo()).isOnline?(yield t.synchroniser(h.K.Utilisateurs),yield t.synchroniser(h.K.Articles),yield t.synchroniser(h.K.Courses),yield t.synchroniser(h.K.Familles),yield t.synchroniser(h.K.CourseDetails),yield t.synchroniser(h.K.Memos),yield t.synchroniser(h.K.HistoriquePrix),yield t.synchroniser(h.K.Magasins),yield t.synchroniser(h.K.Plats),yield t.synchroniser(h.K.PlatDetails),yield t.synchroniser(h.K.Groupes),yield t.synchroniser(h.K.Menus)):alert("Le mode onLine est d\xe9sactiv\xe9")})()}synchroniser(t){var s=this;return(0,c.Z)(function*(){if((yield s.getConnexionInfo()).isOnline){const o=yield s.storage.get(t),i=yield o.filter(a=>!a.isFirebase);i.length>0&&i.map(function(){var a=(0,c.Z)(function*(n){n.isFirebase=!0,yield s.firestore.post(t,n,n.id.toString())});return function(n){return a.apply(this,arguments)}}());const f=yield o.filter(a=>a.firebaseMethod===d.DELETE||a.firebaseMethod===d.PUT);f.length>0&&f.map(function(){var a=(0,c.Z)(function*(n){n.firebaseMethod===d.PUT&&(yield s.put(t,n)),n.firebaseMethod===d.DELETE&&(yield s.deleteDefinitivement(t,n))});return function(n){return a.apply(this,arguments)}}()),(yield s.firestore.getAll(t)).subscribe(a=>{s.storage.set(t,a)})}else alert("Le mode onLine est d\xe9sactiv\xe9")})()}set(t,s){var r=this;return(0,c.Z)(function*(){yield r.storage.set(t,s)})()}getConnexionInfo(){var t=this;return(0,c.Z)(function*(){return yield t.storage.get(h.K.InfoConnexion)})()}}return(g=x).\u0275fac=function(t){return new(t||g)(m.LFG(v.K),m.LFG(C))},g.\u0275prov=m.Yz7({token:g,factory:g.\u0275fac,providedIn:"root"}),x})()}}]);