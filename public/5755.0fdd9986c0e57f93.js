"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[5755],{5755:(N,P,g)=>{g.r(P),g.d(P,{CourseDetailsPageModule:()=>W});var m=g(6814),C=g(95),p=g(7027),I=g(9801),u=g(5861),e=g(6689),q=g(6199),D=g(5512),a=g(6815),d=g(1934),y=g(4985),h=g(3629);let v=(()=>{var n;class f{transform(t,i){return t.filter(s=>s.libelle.toLowerCase().startsWith(i.toLowerCase()))}}return(n=f).\u0275fac=function(t){return new(t||n)},n.\u0275pipe=e.Yjl({name:"articleFiltre",type:n,pure:!0}),f})();function S(n,f){if(1&n){const r=e.EpF();e.TgZ(0,"ion-item-sliding")(1,"ion-item")(2,"ion-label"),e._uU(3),e.qZA()(),e.TgZ(4,"ion-item-options",4)(5,"ion-item-option",5),e.NdJ("click",function(){const o=e.CHM(r).$implicit,s=e.oxw();return e.KtG(s.selectArticle(o))}),e._uU(6,"Selectionner"),e.qZA()()()}if(2&n){const r=f.$implicit;e.xp6(3),e.AsE("",r.libelle," - ",r.prix[0].prix," xpf")}}let k=(()=>{var n;class f{constructor(t){this.articleService=t,this.searchValue="",this.articles=[],this.articlesOutput=new e.vpe}ngOnInit(){this.onInit()}onInit(){var t=this;return(0,u.Z)(function*(){const i=yield t.getArticles();t.articles=i})()}getArticles(){var t=this;return(0,u.Z)(function*(){return yield t.articleService.get()})()}selectArticle(t){this.articlesOutput.emit(t)}}return(n=f).\u0275fac=function(t){return new(t||n)(e.Y36(D.J))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-search-article"]],outputs:{articlesOutput:"articlesOutput"},decls:10,vars:5,consts:[[2,"width","80%","margin","auto","margin-top","20px"],[3,"ngModel","ngModelChange"],[2,"margin","5%","width","100%","height","460px","overflow","scroll"],[4,"ngFor","ngForOf"],["side","end"],[3,"click"]],template:function(t,i){1&t&&(e.TgZ(0,"ion-card",0)(1,"ion-card-header")(2,"ion-card-subtitle"),e._uU(3,"Rechercher d'article"),e.qZA()(),e.TgZ(4,"ion-card-content")(5,"ion-toolbar")(6,"ion-searchbar",1),e.NdJ("ngModelChange",function(s){return i.searchValue=s}),e.qZA()(),e.TgZ(7,"ion-list",2),e.YNc(8,S,7,2,"ion-item-sliding",3),e.ALo(9,"articleFiltre"),e.qZA()()()),2&t&&(e.xp6(6),e.Q6J("ngModel",i.searchValue),e.xp6(2),e.Q6J("ngForOf",e.xi3(9,2,i.articles,i.searchValue)))},dependencies:[m.sg,C.JJ,C.On,p.PM,p.FN,p.Zi,p.tO,p.Ie,p.u8,p.IK,p.td,p.Q$,p.q_,p.VI,p.sr,p.j9,v]}),f})();function w(n,f){if(1&n){const r=e.EpF();e.TgZ(0,"ion-icon",6),e.NdJ("click",function(){e.CHM(r);const i=e.oxw();return e.KtG(i.setIsButtonActif())}),e.qZA()}}function J(n,f){if(1&n){const r=e.EpF();e.TgZ(0,"ion-content")(1,"app-search-article",7),e.NdJ("articlesOutput",function(i){e.CHM(r);const o=e.oxw();return e.KtG(o.selectArticle(i))}),e.qZA()()}}function F(n,f){1&n&&e._UZ(0,"ion-icon",22)}function M(n,f){if(1&n){const r=e.EpF();e.TgZ(0,"ion-item-option",23),e.NdJ("click",function(){e.CHM(r);const i=e.oxw().$implicit,o=e.oxw(3);return e.KtG(o.associerUnCodeBarreAArticleSansTitre(i))}),e._uU(1," BarreCode "),e.qZA()}}function R(n,f){1&n&&e._UZ(0,"ion-icon",22)}const A=function(n){return{color:n}};function O(n,f){if(1&n){const r=e.EpF();e.TgZ(0,"ion-item-sliding")(1,"ion-item",14),e.NdJ("click",function(){const o=e.CHM(r).$implicit,s=e.oxw(3);return e.KtG(s.put(o))}),e.TgZ(2,"ion-label",15),e._uU(3),e.qZA(),e.TgZ(4,"ion-label",15),e._uU(5),e.qZA(),e.TgZ(6,"ion-label",15),e._uU(7),e.qZA(),e.YNc(8,F,1,0,"ion-icon",16),e.qZA(),e.TgZ(9,"ion-item-options",17),e.YNc(10,M,2,0,"ion-item-option",18),e.TgZ(11,"ion-item-option",19),e.NdJ("click",function(){const o=e.CHM(r).$implicit,s=e.oxw(3);return e.KtG(s.delete(o))}),e._uU(12," Supprimer "),e.qZA()(),e.TgZ(13,"ion-item-options",20)(14,"ion-item-option",21),e.NdJ("click",function(){const o=e.CHM(r).$implicit,s=e.oxw(3);return e.KtG(s.check(o))}),e._uU(15," Check "),e.YNc(16,R,1,0,"ion-icon",16),e.qZA()()()}if(2&n){const r=f.$implicit;e.xp6(1),e.Q6J("disabled",r.checked||"DELETE"===r.firebaseMethod),e.xp6(1),e.Q6J("ngStyle",e.VKq(10,A,r.checked?"brown":"white")),e.xp6(1),e.Oqu(r.libelle),e.xp6(1),e.Q6J("ngStyle",e.VKq(12,A,r.checked?"brown":"white")),e.xp6(1),e.hij("x ",r.quantite,""),e.xp6(1),e.Q6J("ngStyle",e.VKq(14,A,r.checked?"brown":"white")),e.xp6(1),e.hij("",r.total," xpf"),e.xp6(1),e.Q6J("ngIf",r.checked),e.xp6(2),e.Q6J("ngIf","Sans titre"===r.libelle),e.xp6(6),e.Q6J("ngIf",!r.checked)}}function B(n,f){if(1&n&&(e.TgZ(0,"ion-list"),e.YNc(1,O,17,16,"ion-item-sliding",13),e.qZA()),2&n){const r=e.oxw(2);e.xp6(1),e.Q6J("ngForOf",r.coursedetails)}}function K(n,f){if(1&n){const r=e.EpF();e.TgZ(0,"ion-fab",24)(1,"ion-fab-button",25),e.NdJ("click",function(){e.CHM(r);const i=e.oxw(2);return e.KtG(i.postArticleWithCalculator())}),e._UZ(2,"ion-icon",26),e.qZA(),e.TgZ(3,"ion-fab-button",27),e.NdJ("click",function(){e.CHM(r);const i=e.oxw(2);return e.KtG(i.postArticleWithBarCode())}),e._UZ(4,"ion-icon",28),e.qZA(),e.TgZ(5,"ion-fab-button",27),e.NdJ("click",function(){e.CHM(r);const i=e.oxw(2);return e.KtG(i.dechargerMemo())}),e._UZ(6,"ion-icon",29),e.qZA(),e.TgZ(7,"ion-fab-button",27),e.NdJ("click",function(){e.CHM(r);const i=e.oxw(2);return e.KtG(i.postArticle())}),e._UZ(8,"ion-icon",30),e.qZA()()}}function U(n,f){if(1&n){const r=e.EpF();e.TgZ(0,"ion-fab",31),e.NdJ("click",function(){e.CHM(r);const i=e.oxw(2);return e.KtG(i.postArticleWithCalculator())}),e.TgZ(1,"ion-fab-button",32),e._UZ(2,"ion-icon",30),e.qZA()()}}function E(n,f){if(1&n){const r=e.EpF();e.TgZ(0,"ion-fab-button",35),e.NdJ("click",function(){e.CHM(r);const i=e.oxw(3);return e.KtG(i.regler())}),e._UZ(1,"ion-icon",36),e.qZA()}}function Q(n,f){if(1&n){const r=e.EpF();e.TgZ(0,"ion-fab",24),e.YNc(1,E,2,0,"ion-fab-button",33),e.TgZ(2,"ion-fab-button",27),e.NdJ("click",function(){e.CHM(r);const i=e.oxw(2);return e.KtG(i.setAfficherListe())}),e._UZ(3,"ion-icon",34),e.qZA()()}if(2&n){const r=e.oxw(2);e.xp6(1),e.Q6J("ngIf",r.isAfficherListe)}}function Y(n,f){1&n&&e._UZ(0,"ion-icon",22)}function L(n,f){if(1&n){const r=e.EpF();e.TgZ(0,"ion-item-option",23),e.NdJ("click",function(){e.CHM(r);const i=e.oxw().$implicit,o=e.oxw(3);return e.KtG(o.associerUnCodeBarreAArticleSansTitre(i))}),e._uU(1," BarreCode "),e.qZA()}}function G(n,f){1&n&&e._UZ(0,"ion-icon",22)}function V(n,f){if(1&n){const r=e.EpF();e.TgZ(0,"ion-item-sliding")(1,"ion-item",14),e.NdJ("click",function(){const o=e.CHM(r).$implicit,s=e.oxw(3);return e.KtG(s.put(o))}),e.TgZ(2,"ion-label",15),e._uU(3),e.qZA(),e.TgZ(4,"ion-label",15),e._uU(5),e.qZA(),e.TgZ(6,"ion-label",15),e._uU(7),e.qZA(),e.YNc(8,Y,1,0,"ion-icon",16),e.qZA(),e.TgZ(9,"ion-item-options",17),e.YNc(10,L,2,0,"ion-item-option",18),e.TgZ(11,"ion-item-option",19),e.NdJ("click",function(){const o=e.CHM(r).$implicit,s=e.oxw(3);return e.KtG(s.delete(o))}),e._uU(12," Supprimer "),e.qZA()(),e.TgZ(13,"ion-item-options",20)(14,"ion-item-option",21),e.NdJ("click",function(){const o=e.CHM(r).$implicit,s=e.oxw(3);return e.KtG(s.check(o))}),e._uU(15," Check "),e.YNc(16,G,1,0,"ion-icon",16),e.qZA()()()}if(2&n){const r=f.$implicit;e.xp6(1),e.Q6J("disabled",r.checked||"DELETE"===r.firebaseMethod),e.xp6(1),e.Q6J("ngStyle",e.VKq(10,A,r.checked?"brown":"white")),e.xp6(1),e.Oqu(r.libelle),e.xp6(1),e.Q6J("ngStyle",e.VKq(12,A,r.checked?"brown":"white")),e.xp6(1),e.hij("x ",r.quantite,""),e.xp6(1),e.Q6J("ngStyle",e.VKq(14,A,r.checked?"brown":"white")),e.xp6(1),e.hij("",r.total," xpf"),e.xp6(1),e.Q6J("ngIf",r.checked),e.xp6(2),e.Q6J("ngIf","Sans titre"===r.libelle),e.xp6(6),e.Q6J("ngIf",!r.checked)}}function z(n,f){if(1&n&&(e.TgZ(0,"ion-list"),e.YNc(1,V,17,16,"ion-item-sliding",13),e.qZA()),2&n){const r=e.oxw(2);e.xp6(1),e.Q6J("ngForOf",r.coursedetails)}}function H(n,f){if(1&n&&(e.TgZ(0,"ion-content",8)(1,"div",9)(2,"ion-chip",10),e._uU(3),e.qZA()(),e.YNc(4,B,2,1,"ion-list",4),e.YNc(5,K,9,0,"ion-fab",11),e.YNc(6,U,3,0,"ion-fab",12),e.YNc(7,Q,4,1,"ion-fab",11),e.YNc(8,z,2,1,"ion-list",4),e.qZA()),2&n){const r=e.oxw();e.Udp("visibility",r.content_visibility),e.Q6J("fullscreen",!0),e.xp6(3),e.hij("",r.totalCourse," XPF"),e.xp6(1),e.Q6J("ngIf",!r.isModeCourseRapide),e.xp6(1),e.Q6J("ngIf",r.isButtonActif&&!r.isModeCourseRapide),e.xp6(1),e.Q6J("ngIf",r.isModeCourseRapide&&!r.isAfficherListe),e.xp6(1),e.Q6J("ngIf",r.isModeCourseRapide),e.xp6(1),e.Q6J("ngIf",r.isModeCourseRapide&&r.isAfficherListe)}}const j=[{path:"",component:(()=>{var n;class f{constructor(t,i,o,s,l,c,_,x,b){this.coursesService=t,this.alertController=i,this.articleservice=o,this.utility=s,this.codeBarre=l,this.articlesService=c,this.historiqueprixservice=_,this.memoservice=x,this.route=b,this.courseid=0,this.totalCourse=0,this.course={id:0,ordre:0,magasinId:1,montantTheorique:0,montantReel:0,ecart:0,date:new Date,actif:!0,isFirebase:!1},this.coursedetails=[],this.articles=[],this.content_visibility="",this.rechercheAvance=!1,this.isButtonActif=!0,this.isModeCourseRapide=!0,this.isAfficherListe=!1}ngOnInit(){this.refresh()}scanne(){var t=this;return(0,u.Z)(function*(){const i=yield t.codeBarre.STEP1EnableCameraReturnVisility();t.content_visibility=i;const o=yield t.codeBarre.STEP2ScanneBarCodeAndReturnContent(),s=yield t.codeBarre.STEP3disableCameraReturnVisility();return t.content_visibility=s,o})()}postArticleWithBarCode(){var t=this;return(0,u.Z)(function*(){const i=yield t.scanne(),o=yield t.articleservice.getArticleByCodeBarre(i);o.length>0?yield t.postPrix(o[0]):yield t.setArticleOnLocalStorageWithCodeBarre(i)})()}postArticleWithCalculator(){var t=this;return(0,u.Z)(function*(){var o;yield(yield t.alertController.create({cssClass:"my-custom-class",header:"Ajouter un \xe9lement au panier",inputs:[{type:"number",name:"prix",placeholder:"Prix"},{type:"number",name:"quantite",placeholder:"Quantit\xe9"}],buttons:[{text:"Annuler",role:"cancel",cssClass:"secondary",handler:()=>{}},{text:"Valider",handler:(o=(0,u.Z)(function*(s){var l=""==s.quantite?1:Number(s.quantite),c=""==s.prix?100:Number(s.prix),_={id:Date.now(),ordre:1,courseId:t.courseid,libelle:"Sans titre",quantite:l,articleId:0,prixArticle:c,prixReel:c,checked:!1,total:c*l,isFirebase:!1};yield t.coursesService.postCourseDetails(_),yield t.refresh()}),function(l){return o.apply(this,arguments)})}]})).present().then(()=>{document.querySelector("ion-alert input").focus()})})()}associerUnCodeBarreAArticleSansTitre(t){var i=this;return(0,u.Z)(function*(){const o=yield i.scanne();yield i.setArticleArticleSanstitre(t,o)})()}setArticleArticleSanstitre(t,i){var o=this;return(0,u.Z)(function*(){var l;yield(yield o.alertController.create({cssClass:"my-custom-class",header:"Ajouter un \xe9lement au panier",inputs:[{type:"text",name:"libelle",placeholder:"Libelle"},{type:"number",name:"prix",placeholder:t.prixReel.toString()+" xpf"},{type:"number",name:"quantite",placeholder:"Qt\xe9: "+t.quantite.toString()}],buttons:[{text:"Annuler",role:"cancel",cssClass:"secondary",handler:()=>{}},{text:"Valider",handler:(l=(0,u.Z)(function*(c){var _=""==c.quantite?1:Number(c.quantite),x=""==c.prix?100:Number(c.prix),b=""==c.libelle?"Prix":c.libelle,Z={id:0,libelle:b,createdOn:new Date,groupeId:[0],familleId:0,codeBarre:i,isFirebase:!1,prix:[{magasin:o.course.magasinId,prix:x}]};yield o.articlesService.post(Z);var T=yield o.articlesService.getArticleByCodeBarre(i);t.libelle=b,t.quantite=_,t.prixReel=x,t.articleId=null==T[0].id||null==T[0].id?0:T[0].id,t.total=x*_,yield o.coursesService.putCourseDetails(t),yield o.refresh()}),function(_){return l.apply(this,arguments)})}]})).present().then(()=>{document.querySelector("ion-alert input").focus()})})()}setArticleOnLocalStorageWithCodeBarre(t){var i=this;return(0,u.Z)(function*(){var s;yield(yield i.alertController.create({cssClass:"my-custom-class",header:"L'article n'existe pas, veuillez le cr\xe9\xe9",inputs:[{type:"text",name:"libelle",label:"Nom de l'article"}],buttons:[{text:"Annuler",role:"cancel",cssClass:"secondary",handler:()=>{}},{text:"Valider",handler:(s=(0,u.Z)(function*(l){l.codeBarre=yield t,yield i.postChoosePrixAndSaveArticle(l)}),function(c){return s.apply(this,arguments)})}]})).present().then(()=>{document.querySelector("ion-alert input").focus()})})()}postChoosePrixAndSaveArticle(t){var i=this;return(0,u.Z)(function*(){var s;yield(yield i.alertController.create({cssClass:"my-custom-class",header:"Renseigner un prix",inputs:[{type:"number",name:"prix",placeholder:"PRIX"}],buttons:[{text:"Annuler",role:"cancel",cssClass:"secondary",handler:()=>{}},{text:"Valider",handler:(s=(0,u.Z)(function*(l){var c={id:Date.now(),libelle:t.libelle,prix:[{magasin:i.course.magasinId,prix:null==l?100:l.prix}],createdOn:new Date,groupeId:[(yield i.utility.getConnexionInfo()).groupeId],familleId:0,codeBarre:t.codeBarre,isFirebase:!1};yield i.articlesService.post(c),yield i.postPrix(c)}),function(c){return s.apply(this,arguments)})}]})).present().then(()=>{document.querySelector("ion-alert input").focus()})})()}refresh(){var t=this;return(0,u.Z)(function*(){t.courseid=t.getId();const i=yield t.getCourse();t.course=i;const o=yield t.getCourseDetail();t.coursedetails=o;const s=yield t.getArticles();t.articles=s;const l=yield t.utility.getConnexionInfo();t.isModeCourseRapide=l.isCourseRapide,t.calculeTotalCourse()})()}calculeTotalCourse(){const t=this.coursedetails;var i=0;t.length>0?(t.map(o=>i+=o.total),this.totalCourse=i,this.course.montantReel=i,this.course.montantTheorique=i):(this.totalCourse=0,this.course.montantReel=0,this.course.montantTheorique=0),this.coursesService.putCourse(this.course)}getId(){return this.route.snapshot.params.id}getCourse(){var t=this;return(0,u.Z)(function*(){return yield t.coursesService.getCourseById(t.courseid)})()}getCourseDetail(){var t=this;return(0,u.Z)(function*(){return(yield t.coursesService.getCourseDetails(t.courseid)).filter(o=>null==o.deletedOn)})()}getArticles(){var t=this;return(0,u.Z)(function*(){return t.articleservice.get()})()}postArticle(){var t=this;return(0,u.Z)(function*(){const i=[];var s;t.articles.map(s=>i.push({type:"radio",label:s.libelle,value:s})),yield(yield t.alertController.create({cssClass:"my-custom-class",header:"Ajouter un \xe9l\xe9ment \xe0 votre panier ?",inputs:i,buttons:[{text:"Annuler",role:"cancel",cssClass:"secondary",handler:()=>{}},{text:"Nouvelle article",cssClass:"secondary",handler:(s=(0,u.Z)(function*(){yield t.postNouvelleArticle()}),function(){return s.apply(this,arguments)})},{text:"Recherche avanc\xe9e",cssClass:"secondary",handler:()=>{t.rechercheAvance=!t.rechercheAvance}},{text:"Valider",handler:function(){var s=(0,u.Z)(function*(l){yield t.postPrix(l)});return function(c){return s.apply(this,arguments)}}()}]})).present()})()}postNouvelleArticle(){var t=this;return(0,u.Z)(function*(){var o;yield(yield t.alertController.create({cssClass:"my-custom-class",header:"Ajouter un nouvelle article",inputs:[{type:"text",label:"Libell\xe9",name:"libelle"},{type:"number",placeholder:"Qt\xe9 : 1",name:"quantite"},{type:"number",placeholder:"Prix : 1000 xpf",name:"prix"}],buttons:[{text:"Annuler",role:"cancel",cssClass:"secondary",handler:()=>{}},{text:"Valider",handler:(o=(0,u.Z)(function*(s){var l=""===s.prix?1e3:Number(s.prix),c=""===s.quantite?1:Number(s.quantite),_={id:t.utility.generateId(),libelle:s.libelle,prix:[{magasin:t.course.magasinId,prix:l}],createdOn:new Date,groupeId:[(yield t.utility.getConnexionInfo()).groupeId],familleId:0,codeBarre:"",isFirebase:!1};yield t.articleservice.post(_);var x={id:Date.now(),ordre:1,courseId:t.courseid,libelle:_.libelle,quantite:c,articleId:_.id,prixArticle:_.prix[0].prix,prixReel:l,checked:!1,total:c*l,isFirebase:!1};yield t.coursesService.postCourseDetails(x),yield t.refresh()}),function(l){return o.apply(this,arguments)})}]})).present()})()}addNewPrixArticle(t){var i=this;return(0,u.Z)(function*(){var s;yield(yield i.alertController.create({cssClass:"my-custom-class",header:"Renseigner le prix et la quantit\xe9 souhait\xe9e",inputs:[{type:"number",placeholder:"Quantit\xe9 : 1",name:"quantite"},{type:"number",placeholder:"Prix ex: "+t.prix[0].prix+" xpf",name:"prix"}],buttons:[{text:"Annuler",role:"cancel",cssClass:"secondary",handler:()=>{}},{text:"Valider",handler:(s=(0,u.Z)(function*(l){t.prix.push({magasin:i.course.magasinId,prix:Number(""===l.prix?t.prix[0].prix:l.prix)}),yield i.articlesService.put(t);var c=Number(""===l.prix?t.prix[0].prix:l.prix),_=""===l.quantite?1:Number(l.quantite),x={id:Date.now(),ordre:1,courseId:i.courseid,libelle:t.libelle,quantite:_,articleId:t.id,prixArticle:c,prixReel:c,checked:!1,total:_*c,isFirebase:!1};yield i.coursesService.postCourseDetails(x),yield i.refresh()}),function(c){return s.apply(this,arguments)})}]})).present()})()}postPrix(t){var i=this;return(0,u.Z)(function*(){var o,c,s=yield null===(o=t.prix.find(l=>l.magasin==i.course.magasinId))||void 0===o?void 0:o.prix;void 0===s?yield i.addNewPrixArticle(t):yield(yield i.alertController.create({cssClass:"my-custom-class",header:"Renseigner le prix et la quantit\xe9 souhait\xe9e",inputs:[{type:"number",placeholder:"Qt\xe9 : 1",name:"quantite"},{type:"number",placeholder:"Prix : "+s+" xpf",name:"prix"}],buttons:[{text:"Annuler",role:"cancel",cssClass:"secondary",handler:()=>{}},{text:"Valider",handler:(c=(0,u.Z)(function*(_){var x=""===_.prix?s:Number(_.prix),b=""===_.quantite?1:Number(_.quantite),Z={id:Date.now(),ordre:1,courseId:i.courseid,libelle:t.libelle,quantite:b,articleId:t.id,prixArticle:Number(s),prixReel:Number(x),checked:!1,total:b*Number(x),isFirebase:!1};if(yield i.coursesService.postCourseDetails(Z),Z.prixReel!==Z.prixArticle){const T=t.prix.findIndex(X=>X.magasin===i.course.magasinId);t.prix[T].prix=Number(Z.prixReel),yield i.putPrixFicheArticle(t,Number(s))}else yield i.refresh()}),function(x){return c.apply(this,arguments)})}]})).present()})()}putPrixFicheArticle(t,i){var o=this;return(0,u.Z)(function*(){var l;yield(yield o.alertController.create({cssClass:"my-custom-class",header:"Le prix renseign\xe9 est diff\xe9r\xe9 du prix de la fiche article. Souhaitez-vous le mettre \xe0 jour ?",inputs:[],buttons:[{text:"Non",role:"cancel",cssClass:"secondary",handler:()=>{}},{text:"Oui",handler:(l=(0,u.Z)(function*(){yield o.articlesService.put(t);const c=t.prix.findIndex(x=>x.magasin===o.course.magasinId),_={id:Number(new Date),articleId:t.id,libelle:t.libelle,prixAncien:i,prixNouveau:t.prix[c].prix,magasinid:t.prix[c].magasin,date:new Date,isFirebase:!1};yield o.historiqueprixservice.post(_),o.refresh()}),function(){return l.apply(this,arguments)})}]})).present()})()}check(t){var i=this;return(0,u.Z)(function*(){t.checked=!t.checked,yield i.coursesService.putCourseDetails(t),yield i.refresh()})()}put(t){var i=this;return(0,u.Z)(function*(){var s;yield(yield i.alertController.create({cssClass:"my-custom-class",header:"Renseigner le prix et la quantit\xe9 souhait\xe9e",inputs:[{type:"text",value:t.libelle,label:"Libell\xe9",name:"libelle"},{type:"number",value:t.quantite,label:"Quantit\xe9",name:"quantite"},{type:"number",label:"Prix",name:"prix",value:t.prixReel}],buttons:[{text:"Annuler",role:"cancel",cssClass:"secondary",handler:()=>{}},{text:"Valider",handler:(s=(0,u.Z)(function*(l){if(t.libelle=l.libelle,t.prixReel=l.prix,t.quantite=l.quantite,t.total=l.prix*l.quantite,yield i.coursesService.putCourseDetails(t),l.prix==t.prixArticle)yield i.refresh();else if("Sans titre"!==t.libelle){const c=yield i.articlesService.getArticleById(t.articleId),_=yield c[0].prix.findIndex(x=>x.magasin===i.course.magasinId);i.putArticleOnDatabase({articleId:t.articleId,prixNouveau:Number(l.prix),prixAncien:Number(c[0].prix[_].prix),magasinId:i.course.magasinId,coursedetail:t})}}),function(c){return s.apply(this,arguments)})}]})).present()})()}putArticleOnDatabase(t){var i=this;return(0,u.Z)(function*(){var s;yield(yield i.alertController.create({cssClass:"my-custom-class",header:"Souhaitez-vous \xe9galement mettre \xe0 jour le prix en base de donn\xe9es ?",buttons:[{text:"Annuler",role:"Non",cssClass:"secondary",handler:()=>{}},{text:"Oui",handler:(s=(0,u.Z)(function*(){var l=yield i.articleservice.getArticleById(Number(t.articleId)),c=yield l[0].prix.findIndex(b=>b.magasin==t.magasinId);l[0].prix[c].prix=t.prixNouveau,yield i.articleservice.put(l[0]),t.coursedetail.prixArticle=t.prixNouveau,yield i.coursesService.putCourseDetails(t.coursedetail);const x={id:Number(new Date),articleId:l[0].id,libelle:l[0].libelle,prixAncien:t.prixAncien,prixNouveau:t.prixNouveau,magasinid:i.course.magasinId,date:new Date,isFirebase:!1};yield i.historiqueprixservice.post(x),yield i.refresh()}),function(){return s.apply(this,arguments)})}]})).present()})()}selectArticle(t){var i=this;return(0,u.Z)(function*(){yield i.postPrix(t),i.rechercheAvance=!i.rechercheAvance})()}delete(t){var i=this;return(0,u.Z)(function*(){var s;yield(yield i.alertController.create({cssClass:"my-custom-class",header:"Souhaitez-vous r\xe9ellement retirer l'article de votre liste ?",buttons:[{text:"Annuler",role:"Non",cssClass:"secondary",handler:()=>{}},{text:"Oui",handler:(s=(0,u.Z)(function*(){yield i.coursesService.deleteDefinitivementCourseDetails(t),yield i.refresh()}),function(){return s.apply(this,arguments)})}]})).present()})()}deleteCourseDetail(t){var i=this;return(0,u.Z)(function*(){yield i.coursesService.deleteCourseDetails(t),yield i.refresh()})()}setIsButtonActif(){this.isButtonActif=!this.isButtonActif}dechargerMemo(){var t=this;return(0,u.Z)(function*(){var o;yield(yield t.alertController.create({cssClass:"my-custom-class",header:"Souhaitez-vous d\xe9charger vos notes de course ?",buttons:[{text:"Annuler",role:"Non",cssClass:"secondary",handler:()=>{}},{text:"Oui",handler:(o=(0,u.Z)(function*(){const s=yield t.memoservice.get();for(let c of s){const _=c.article.prix.find(x=>x.magasin===t.course.magasinId);var l={id:Number(new Date),ordre:0,courseId:t.course.id.toString(),libelle:c.article.libelle,quantite:c.quantite,articleId:c.article.id,prixArticle:void 0===_?c.article.prix[0].prix:_.prix,prixReel:void 0===_?c.article.prix[0].prix:_.prix,total:Number(c.quantite*(void 0===_?c.article.prix[0].prix:_.prix)),checked:!1,isFirebase:!1};yield t.coursesService.postCourseDetails(l),yield t.memoservice.delete(c)}yield t.refresh()}),function(){return o.apply(this,arguments)})}]})).present()})()}setAfficherListe(){this.isAfficherListe=!this.isAfficherListe}regler(){var t=this;return(0,u.Z)(function*(){var o;yield(yield t.alertController.create({cssClass:"my-custom-class",header:"R\xe9gler vos courses",inputs:[{type:"number",name:"reglement"}],buttons:[{text:"Annuler",role:"Non",cssClass:"secondary",handler:()=>{}},{text:"Valider",handler:(o=(0,u.Z)(function*(s){t.course.montantReel=s.reglement,yield t.coursesService.putCourse(t.course);const l=t.course.montantTheorique;if(l<s.reglement){var c=s.reglement-l,_={id:Date.now(),ordre:1,courseId:t.courseid,libelle:"REGLT +",quantite:1,articleId:0,prixArticle:c,prixReel:c,checked:!1,total:c,isFirebase:!1};yield t.coursesService.postCourseDetails(_)}else c=l-s.reglement,_={id:Date.now(),ordre:1,courseId:t.courseid,libelle:"REGLT -",quantite:1,articleId:0,prixArticle:c,prixReel:c,checked:!1,total:-1*c,isFirebase:!1},yield t.coursesService.postCourseDetails(_);yield t.refresh()}),function(l){return o.apply(this,arguments)})}]})).present()})()}}return(n=f).\u0275fac=function(t){return new(t||n)(e.Y36(q.N),e.Y36(p.Br),e.Y36(D.J),e.Y36(a.t),e.Y36(d.k),e.Y36(D.J),e.Y36(y.a),e.Y36(h.T),e.Y36(I.gz))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-course-details"]],decls:9,vars:4,consts:[[3,"translucent"],["slot","start"],["defaultHref","/courses"],["style","margin-left: 50px;","name","apps-outline",3,"click",4,"ngIf"],[4,"ngIf"],[3,"fullscreen","visibility",4,"ngIf"],["name","apps-outline",2,"margin-left","50px",3,"click"],[3,"articlesOutput"],[3,"fullscreen"],[2,"display","flex","justify-content","center","padding","10px"],["color","white",2,"font-weight","bold","font-size","x-large"],["slot","fixed","horizontal","end","vertical","bottom",4,"ngIf"],["slot","fixed","horizontal","center","vertical","center",3,"click",4,"ngIf"],[4,"ngFor","ngForOf"],["button","",3,"disabled","click"],[3,"ngStyle"],["name","lock-closed-outline",4,"ngIf"],["side","start"],["style","color: rgb(255, 196, 216); background: rgb(39, 24, 102);",3,"click",4,"ngIf"],[2,"background","red",3,"click"],["side","end"],[3,"click"],["name","lock-closed-outline"],[2,"color","rgb(255, 196, 216)","background","rgb(39, 24, 102)",3,"click"],["slot","fixed","horizontal","end","vertical","bottom"],["size","large","color","success",3,"click"],["name","calculator-outline"],["size","small",3,"click"],["name","barcode"],["name","book-outline"],["name","add"],["slot","fixed","horizontal","center","vertical","center",3,"click"],["size","large"],["size","small","color","danger",3,"click",4,"ngIf"],["name","list-circle-outline"],["size","small","color","danger",3,"click"],["name","journal-outline"]],template:function(t,i){1&t&&(e.TgZ(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-buttons",1),e._UZ(3,"ion-back-button",2),e.qZA(),e.TgZ(4,"ion-title"),e._uU(5," Votre liste de course "),e.YNc(6,w,1,0,"ion-icon",3),e.qZA()()(),e.YNc(7,J,2,0,"ion-content",4),e.YNc(8,H,9,9,"ion-content",5)),2&t&&(e.Q6J("translucent",!0),e.xp6(6),e.Q6J("ngIf",!i.isModeCourseRapide),e.xp6(1),e.Q6J("ngIf",i.rechercheAvance),e.xp6(1),e.Q6J("ngIf",!i.rechercheAvance))},dependencies:[m.sg,m.O5,m.PC,p.oU,p.Sm,p.hM,p.W2,p.IJ,p.W4,p.Gu,p.gu,p.Ie,p.u8,p.IK,p.td,p.Q$,p.q_,p.wd,p.sr,p.cs,k]}),f})()}];let $=(()=>{var n;class f{}return(n=f).\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[I.Bz.forChild(j),I.Bz]}),f})(),W=(()=>{var n;class f{}return(n=f).\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[m.ez,C.u5,p.Pc,$]}),f})()},6199:(N,P,g)=>{g.d(P,{N:()=>u});var m=g(5861),C=g(3009),p=g(6689),I=g(5423);let u=(()=>{var e;class q{constructor(a){this.storage=a}getCourse(){var a=this;return(0,m.Z)(function*(){const d=yield a.storage.get(C.K.Courses);return a.sortByOrdreAsc(d)})()}sortByOrdreAsc(a){return a.sort((d,y)=>d.ordre>y.ordre?-1:1)}sortByOrdreDesc(a){return a.sort((d,y)=>d.ordre<y.ordre?-1:1)}postCourse(a){var d=this;return(0,m.Z)(function*(){yield d.storage.post(C.K.Courses,a)})()}putCourse(a){var d=this;return(0,m.Z)(function*(){yield d.storage.put(C.K.Courses,a)})()}deleteCourse(a){var d=this;return(0,m.Z)(function*(){yield d.storage.delete(C.K.Courses,a)})()}deleteCourseDefinitivement(a){var d=this;return(0,m.Z)(function*(){yield d.storage.deleteDefinitivement(C.K.Courses,a)})()}getCourseById(a){var d=this;return(0,m.Z)(function*(){return yield(yield d.getCourse()).find(h=>h.id==a)})()}getCourseDetails(a){var d=this;return(0,m.Z)(function*(){return(yield d.storage.get(C.K.CourseDetails)).filter(h=>h.courseId===a&&void 0!==h.deletedOn)})()}generateOrdreCourse(){var a=this;return(0,m.Z)(function*(){const d=yield a.getCourse(),y=yield a.sortByOrdreDesc(d).pop();return Number(null==y?void 0:y.ordre)+1})()}setAllCoursesIsFocusFalse(){var a=this;return(0,m.Z)(function*(){yield(yield a.getCourse()).map(function(){var y=(0,m.Z)(function*(h){h.isFocus=!1,yield a.putCourse(h)});return function(h){return y.apply(this,arguments)}}())})()}getCourseIsFocus(){var a=this;return(0,m.Z)(function*(){const d=yield a.getCourse(),y=yield d.filter(h=>h.isFocus);return y.length>0?y:(yield a.postCourse({id:0,ordre:yield a.generateOrdreCourse(),magasinId:0,montantTheorique:0,montantReel:0,ecart:0,date:new Date,actif:!0,isFirebase:!1,isFocus:!0}),yield d.filter(h=>h.isFocus))})()}sortByOrdre(a){return a.sort((d,y)=>d.ordre<y.ordre?-1:1)}postCourseDetails(a){var d=this;return(0,m.Z)(function*(){var y=yield d.getCourseDetails(a.courseId),h=d.sortByOrdre(y);h.length>0&&(a.ordre=h[h.length-1].ordre+1),yield d.storage.post(C.K.CourseDetails,a)})()}putCourseDetails(a){var d=this;return(0,m.Z)(function*(){yield d.storage.put(C.K.CourseDetails,a)})()}deleteCourseDetails(a){var d=this;return(0,m.Z)(function*(){yield d.storage.delete(C.K.CourseDetails,a)})()}deleteDefinitivementCourseDetails(a){var d=this;return(0,m.Z)(function*(){yield d.storage.deleteDefinitivement(C.K.CourseDetails,a)})()}}return(e=q).\u0275fac=function(a){return new(a||e)(p.LFG(I.V))},e.\u0275prov=p.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),q})()}}]);